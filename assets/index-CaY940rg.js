function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
var Ni=Object.defineProperty;var Ui=(n,e,t)=>e in n?Ni(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var ye=(n,e,t)=>(Ui(n,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();const Ve="4.4.0";class Di{constructor(e,t){this.response=e,this.controller=t,this.decoder=new Mi}async*iterMessages(){if(!this.response.body)throw this.controller.abort(),new Error("Attempted to iterate over a response with no body");const e=new We,t=zi(this.response.body);for await(const r of t)for(const s of e.decode(r)){const i=this.decoder.decode(s);i&&(yield i)}for(const r of e.flush()){const s=this.decoder.decode(r);s&&(yield s)}}async*[Symbol.asyncIterator](){let e=!1;try{for await(const t of this.iterMessages())if(!e){if(t.data.startsWith("[DONE]")){e=!0;continue}if(t.event===null)try{yield JSON.parse(t.data)}catch(r){throw console.error("Could not parse message into JSON:",t.data),console.error("From chunk:",t.raw),r}}e=!0}catch(t){if(t instanceof Error&&t.name==="AbortError")return;throw t}finally{e||this.controller.abort()}}}class Mi{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,s]=Bi(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}}class We{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const r=We.NEWLINE_CHARS.has(t[t.length-1]||"");let s=t.split(We.NEWLINE_REGEXP);return s.length===1&&!r?(this.buffer.push(s[0]),[]):(this.buffer.length>0&&(s=[this.buffer.join("")+s[0],...s.slice(1)],this.buffer=[]),r||(this.buffer=[s.pop()||""]),s)}decodeText(e){var t;if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new Error(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return(t=this.textDecoder)!==null&&t!==void 0||(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new Error(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new Error("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}We.NEWLINE_CHARS=new Set([`
`,"\r","\v","\f","","","","Â…","\u2028","\u2029"]);We.NEWLINE_REGEXP=/\r\n|[\n\r\x0b\x0c\x1c\x1d\x1e\x85\u2028\u2029]/g;function Bi(n,e){const t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}function zi(n){if(n[Symbol.asyncIterator])return n;const e=n.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}let X=class Hr extends Error{constructor(e,t,r,s){super(Hr.makeMessage(t,r)),this.status=e,this.headers=s;const i=t;this.error=i,this.code=i==null?void 0:i.code,this.param=i==null?void 0:i.param,this.type=i==null?void 0:i.type}static makeMessage(e,t){return e!=null&&e.message?typeof e.message=="string"?e.message:JSON.stringify(e.message):e?JSON.stringify(e):t||"Unknown error occurred"}static generate(e,t,r,s){if(!e)return new gt({cause:Us(t)});const i=t==null?void 0:t.error;return e===400?new gn(e,i,r,s):e===401?new yn(e,i,r,s):e===403?new _n(e,i,r,s):e===404?new bn(e,i,r,s):e===409?new vn(e,i,r,s):e===422?new wn(e,i,r,s):e===429?new En(e,i,r,s):e>=500?new xn(e,i,r,s):new Hr(e,i,r,s)}},Ct=class extends X{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0),this.status=void 0}},gt=class extends X{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),this.status=void 0,t&&(this.cause=t)}},mn=class extends gt{constructor(){super({message:"Request timed out."})}},gn=class extends X{constructor(){super(...arguments),this.status=400}},yn=class extends X{constructor(){super(...arguments),this.status=401}},_n=class extends X{constructor(){super(...arguments),this.status=403}},bn=class extends X{constructor(){super(...arguments),this.status=404}},vn=class extends X{constructor(){super(...arguments),this.status=409}},wn=class extends X{constructor(){super(...arguments),this.status=422}},En=class extends X{constructor(){super(...arguments),this.status=429}},xn=class extends X{};const qi=Object.freeze(Object.defineProperty({__proto__:null,APIConnectionError:gt,APIConnectionTimeoutError:mn,APIError:X,APIUserAbortError:Ct,AuthenticationError:yn,BadRequestError:gn,ConflictError:vn,InternalServerError:xn,NotFoundError:bn,PermissionDeniedError:_n,RateLimitError:En,UnprocessableEntityError:wn},Symbol.toStringTag,{value:"Module"})),Fi=n=>{},Vi=fetch.bind(void 0),Hi=!1,Zi=FormData,Fn=typeof File<"u"?File:class extends Blob{constructor(){throw new Error("file uploads aren't supported in this environment yet as 'File' is not defined")}};async function Ki(n,e){return{...e,body:new ra(n)}}async function Ji(){throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")}function Gi(n){return!1}const Rs=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function",Wi=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&Cs(n),Cs=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",Xi=n=>Wi(n)||Rs(n)||Gi();async function js(n,e,t={}){var r,s,i;if(n=await n,Rs(n)){const o=await n.blob();return e||(e=(r=new URL(n.url).pathname.split(/[\\/]/).pop())!==null&&r!==void 0?r:"unknown_file"),new Fn([o],e,t)}const a=await Qi(n);if(e||(e=(s=ea(n))!==null&&s!==void 0?s:"unknown_file"),!t.type){const o=(i=a[0])===null||i===void 0?void 0:i.type;typeof o=="string"&&(t={...t,type:o})}return new Fn(a,e,t)}async function Qi(n){var e;let t=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)t.push(n);else if(Cs(n))t.push(await n.arrayBuffer());else if(ta(n))for await(const r of n)t.push(r);else throw new Error(`Unexpected data type: ${typeof n}; constructor: ${(e=n==null?void 0:n.constructor)===null||e===void 0?void 0:e.name}; props: ${Yi(n)}`);return t}function Yi(n){return`[${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}function ea(n){var e;return Ar(n.name)||Ar(n.filename)||((e=Ar(n.path))===null||e===void 0?void 0:e.split(/[\\/]/).pop())}const Ar=n=>{if(typeof n=="string")return n;if(typeof Buffer<"u"&&n instanceof Buffer)return String(n)},ta=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function";class ra{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}const Vn=n=>n&&typeof n=="object"&&n.body&&n[Symbol.toStringTag]==="MultipartBody",ht=async n=>{const e=await na(n.body);return Ki(e,n)},na=async n=>{const e=new Zi;return await Promise.all(Object.entries(n||{}).map(([t,r])=>Zr(e,t,r))),e},Zr=async(n,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")n.append(e,String(t));else if(Xi(t)){const r=await js(t);n.append(e,r)}else if(Array.isArray(t))await Promise.all(t.map(r=>Zr(n,e+"[]",r)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([r,s])=>Zr(n,`${e}[${r}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var $s={},sa=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},ia=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Et;const aa=2;async function Ls(n){const{response:e}=n;if(n.options.stream)return new Di(e,n.controller);const t=e.headers.get("content-type");if(t!=null&&t.includes("application/json")){const s=await e.json();return jt("response",e.status,e.url,e.headers,s),s}const r=await e.text();return jt("response",e.status,e.url,e.headers,r),r}class pr extends Promise{constructor(e,t=Ls){super(r=>{r(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new pr(this.responsePromise,async t=>e(await this.parseResponse(t)))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class oa{constructor({baseURL:e,maxRetries:t,timeout:r=6e5,httpAgent:s,fetch:i}){this.baseURL=e,this.maxRetries=kr("maxRetries",t??aa),this.timeout=kr("timeout",r),this.httpAgent=s,this.fetch=i??Vi}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...fa(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${ba()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(s=>({method:e,path:t,...s})))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}return null}buildRequest(e){var t,r,s,i,a,o;const{method:c,path:u,query:l,headers:h={}}=e,d=Vn(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,f=this.calculateContentLength(d),p=this.buildURL(u,l);"timeout"in e&&kr("timeout",e.timeout);const b=(t=e.timeout)!==null&&t!==void 0?t:this.timeout,m=(s=(r=e.httpAgent)!==null&&r!==void 0?r:this.httpAgent)!==null&&s!==void 0?s:Fi(),S=b+1e3;typeof((i=m==null?void 0:m.options)===null||i===void 0?void 0:i.timeout)=="number"&&S>((a=m.options.timeout)!==null&&a!==void 0?a:0)&&(m.options.timeout=S),this.idempotencyHeader&&c!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),h[this.idempotencyHeader]=e.idempotencyKey);const R={...f&&{"Content-Length":f},...this.defaultHeaders(e),...h};Vn(e.body)&&!Hi&&delete R["Content-Type"],Object.keys(R).forEach(j=>R[j]===null&&delete R[j]);const A={method:c,...d&&{body:d},headers:R,...m&&{agent:m},signal:(o=e.signal)!==null&&o!==void 0?o:null};return this.validateHeaders(R,h),{req:A,url:p,timeout:b}}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,r,s){return X.generate(e,t,r,s)}request(e,t=null){return new pr(this.makeRequest(e,t))}async makeRequest(e,t){var r,s,i;const a=await e;t==null&&(t=(r=a.maxRetries)!==null&&r!==void 0?r:this.maxRetries);const{req:o,url:c,timeout:u}=this.buildRequest(a);if(await this.prepareRequest(o,{url:c,options:a}),jt("request",c,a,o.headers),!((s=a.signal)===null||s===void 0)&&s.aborted)throw new Ct;const l=new AbortController,h=await this.fetchWithTimeout(c,o,u,l).catch(Us);if(h instanceof Error){if(!((i=a.signal)===null||i===void 0)&&i.aborted)throw new Ct;if(t)return this.retryRequest(a,t);throw h.name==="AbortError"?new mn:new gt({cause:h})}const d=ua(h.headers);if(!h.ok){if(t&&this.shouldRetry(h))return this.retryRequest(a,t,d);const f=await h.text().catch(()=>"Unknown"),p=pa(f),b=p?void 0:f;throw jt("response",h.status,c,d,b),this.makeStatusError(h.status,p,b,d)}return{response:h,options:a,controller:l}}requestAPIList(e,t){const r=this.makeRequest(t,null);return new ca(this,r,e)}buildURL(e,t){const r=ga(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return Ds(s)||(t={...s,...t}),t&&(r.search=this.stringifyQuery(t)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,r])=>typeof r<"u").map(([t,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(t)}=`;throw new Error(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,r,s){const{signal:i,...a}=t||{};i&&i.addEventListener("abort",()=>s.abort());const o=setTimeout(()=>s.abort(),r);return this.getRequestClient().fetch(e,{signal:s.signal,...a}).finally(()=>{clearTimeout(o)})}getRequestClient(){return{fetch:this.fetch}}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r){var s;t-=1;const i=parseInt((r==null?void 0:r["retry-after"])||""),a=(s=e.maxRetries)!==null&&s!==void 0?s:this.maxRetries,o=this.calculateRetryTimeoutSeconds(t,i,a)*1e3;return await ya(o),this.makeRequest(e,t)}calculateRetryTimeoutSeconds(e,t,r){if(Number.isInteger(t)&&t<=60)return t;const a=r-e,o=Math.min(.5*Math.pow(a-1,2),2),c=Math.random()-.5;return o+c}getUserAgent(){return`${this.constructor.name}/JS ${Ve}`}}class Ns{constructor(e,t,r,s){Et.set(this,void 0),sa(this,Et,e,"f"),this.options=s,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new Error("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e)t.query={...t.query,...e.params};else if("url"in e){const r=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[s,i]of r)e.url.searchParams.set(s,i);t.query=void 0,t.path=e.url.toString()}return await ia(this,Et,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Et=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class ca extends pr{constructor(e,t,r){super(t,async s=>new r(e,s.response,await Ls(s),s.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}}const ua=n=>new Proxy(Object.fromEntries(n.entries()),{get(e,t){const r=t.toString();return e[r.toLowerCase()]||e[r]}}),la={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0},Hn=n=>typeof n=="object"&&n!==null&&!Ds(n)&&Object.keys(n).every(e=>_a(la,e)),ha=()=>{if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ve,"X-Stainless-OS":Kn(Deno.build.os),"X-Stainless-Arch":Zn(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":Deno.version};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ve,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ve,"X-Stainless-OS":Kn(process.platform),"X-Stainless-Arch":Zn(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const n=da();return n?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ve,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${n.browser}`,"X-Stainless-Runtime-Version":n.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ve,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function da(){if(typeof navigator>"u"||!navigator)return null;const n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of n){const r=t.exec(navigator.userAgent);if(r){const s=r[1]||0,i=r[2]||0,a=r[3]||0;return{browser:e,version:`${s}.${i}.${a}`}}}return null}const Zn=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",Kn=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown");let xt;const fa=()=>xt??(xt=ha()),pa=n=>{try{return JSON.parse(n)}catch{return}},ma=new RegExp("^(?:[a-z]+:)?//","i"),ga=n=>ma.test(n),ya=n=>new Promise(e=>setTimeout(e,n)),kr=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new Error(`${n} must be an integer`);if(e<0)throw new Error(`${n} must be a positive integer`);return e},Us=n=>n instanceof Error?n:new Error(n),Jn=n=>{var e,t,r,s;if(typeof process<"u")return(t=(e=$s)===null||e===void 0?void 0:e[n])!==null&&t!==void 0?t:void 0;if(typeof Deno<"u")return(s=(r=Deno.env)===null||r===void 0?void 0:r.get)===null||s===void 0?void 0:s.call(r,n)};function Ds(n){if(!n)return!0;for(const e in n)return!1;return!0}function _a(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function jt(n,...e){typeof process<"u"&&$s.DEBUG==="true"&&console.log(`OpenAI:DEBUG:${n}`,...e)}const ba=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)}),va=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";class mr extends Ns{constructor(e,t,r,s){super(e,t,r,s),this.object=r.object,this.data=r.data}getPaginatedItems(){return this.data}nextPageParams(){return null}nextPageInfo(){return null}}class An extends Ns{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data}getPaginatedItems(){return this.data}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var e,t;if(!(!((e=this.data)===null||e===void 0)&&e.length))return null;const r=(t=this.data[this.data.length-1])===null||t===void 0?void 0:t.id;return r?{params:{after:r}}:null}}class Z{constructor(e){this.client=e,this.get=e.get.bind(e),this.post=e.post.bind(e),this.patch=e.patch.bind(e),this.put=e.put.bind(e),this.delete=e.delete.bind(e),this.getAPIList=e.getAPIList.bind(e)}}class $t extends Z{create(e,t){return this.post("/audio/transcriptions",ht({body:e,...t}))}}$t||($t={});class Lt extends Z{create(e,t){return this.post("/audio/translations",ht({body:e,...t}))}}Lt||(Lt={});class Nt extends Z{constructor(){super(...arguments),this.transcriptions=new $t(this.client),this.translations=new Lt(this.client)}}(function(n){n.Transcriptions=$t,n.Translations=Lt})(Nt||(Nt={}));let Ut=class extends Z{create(e,t){var r;return this.post("/chat/completions",{body:e,...t,stream:(r=e.stream)!==null&&r!==void 0?r:!1})}};Ut||(Ut={});class Dt extends Z{constructor(){super(...arguments),this.completions=new Ut(this.client)}}(function(n){n.Completions=Ut})(Dt||(Dt={}));class Mt extends Z{create(e,t){var r;return this.post("/completions",{body:e,...t,stream:(r=e.stream)!==null&&r!==void 0?r:!1})}}Mt||(Mt={});let Bt=class extends Z{create(e,t){return this.post("/embeddings",{body:e,...t})}};Bt||(Bt={});class zt extends Z{create(e,t){return this.post("/edits",{body:e,...t})}}zt||(zt={});class qt extends Z{create(e,t){return this.post("/files",ht({body:e,...t}))}retrieve(e,t){return this.get(`/files/${e}`,t)}list(e){return this.getAPIList("/files",Ms,e)}del(e,t){return this.delete(`/files/${e}`,t)}retrieveContent(e,t){return this.get(`/files/${e}/content`,{...t,headers:{Accept:"application/json",...t==null?void 0:t.headers}})}}class Ms extends mr{}qt||(qt={});class Ft extends Z{create(e,t){return this.post("/fine-tunes",{body:e,...t})}retrieve(e,t){return this.get(`/fine-tunes/${e}`,t)}list(e){return this.getAPIList("/fine-tunes",Bs,e)}cancel(e,t){return this.post(`/fine-tunes/${e}/cancel`,t)}listEvents(e,t,r){var s;return this.get(`/fine-tunes/${e}/events`,{query:t,timeout:864e5,...r,stream:(s=t==null?void 0:t.stream)!==null&&s!==void 0?s:!1})}}class Bs extends mr{}Ft||(Ft={});class Vt extends Z{create(e,t){return this.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return Hn(e)?this.list({},e):this.getAPIList("/fine_tuning/jobs",zs,{query:e,...t})}cancel(e,t){return this.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},r){return Hn(t)?this.listEvents(e,{},t):this.getAPIList(`/fine_tuning/jobs/${e}/events`,qs,{query:t,...r})}}class zs extends An{}class qs extends An{}Vt||(Vt={});class Ht extends Z{constructor(){super(...arguments),this.jobs=new Vt(this.client)}}(function(n){n.Jobs=Vt,n.FineTuningJobsPage=zs,n.FineTuningJobEventsPage=qs})(Ht||(Ht={}));class Zt extends Z{createVariation(e,t){return this.post("/images/variations",ht({body:e,...t}))}edit(e,t){return this.post("/images/edits",ht({body:e,...t}))}generate(e,t){return this.post("/images/generations",{body:e,...t})}}Zt||(Zt={});class Kt extends Z{retrieve(e,t){return this.get(`/models/${e}`,t)}list(e){return this.getAPIList("/models",Fs,e)}del(e,t){return this.delete(`/models/${e}`,t)}}class Fs extends mr{}Kt||(Kt={});class Jt extends Z{create(e,t){return this.post("/moderations",{body:e,...t})}}Jt||(Jt={});var Vs;class D extends oa{constructor(e){var t,r,{apiKey:s=Jn("OPENAI_API_KEY"),organization:i=(t=Jn("OPENAI_ORG_ID"))!==null&&t!==void 0?t:null,...a}=e===void 0?{}:e;if(s===void 0)throw new Error("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'my apiKey' }).");const o={apiKey:s,organization:i,baseURL:"https://api.openai.com/v1",...a};if(!o.dangerouslyAllowBrowser&&va())throw new Error(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:o.baseURL,timeout:(r=o.timeout)!==null&&r!==void 0?r:6e5,httpAgent:o.httpAgent,maxRetries:o.maxRetries,fetch:o.fetch}),this.completions=new Mt(this),this.chat=new Dt(this),this.edits=new zt(this),this.embeddings=new Bt(this),this.files=new qt(this),this.images=new Zt(this),this.audio=new Nt(this),this.moderations=new Jt(this),this.models=new Kt(this),this.fineTuning=new Ht(this),this.fineTunes=new Ft(this),this._options=o,this.apiKey=s,this.organization=i}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}}Vs=D;D.OpenAI=Vs;D.APIError=X;D.APIConnectionError=gt;D.APIConnectionTimeoutError=mn;D.APIUserAbortError=Ct;D.NotFoundError=bn;D.ConflictError=vn;D.RateLimitError=En;D.BadRequestError=gn;D.AuthenticationError=yn;D.InternalServerError=xn;D.PermissionDeniedError=_n;D.UnprocessableEntityError=wn;const{APIError:Wh,APIConnectionError:Xh,APIConnectionTimeoutError:wa,APIUserAbortError:Ea,NotFoundError:Qh,ConflictError:Yh,RateLimitError:ed,BadRequestError:td,AuthenticationError:rd,InternalServerError:nd,PermissionDeniedError:sd,UnprocessableEntityError:id}=qi;(function(n){n.toFile=js,n.fileFromPath=Ji,n.Page=mr,n.CursorPage=An,n.Completions=Mt,n.Chat=Dt,n.Edits=zt,n.Embeddings=Bt,n.Files=qt,n.FileObjectsPage=Ms,n.Images=Zt,n.Audio=Nt,n.Moderations=Jt,n.Models=Kt,n.ModelsPage=Fs,n.FineTuning=Ht,n.FineTunes=Ft,n.FineTunesPage=Bs})(D||(D={}));function kn(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var gr={};gr.byteLength=ka;gr.toByteArray=Pa;gr.fromByteArray=Ia;var ie=[],Y=[],xa=typeof Uint8Array<"u"?Uint8Array:Array,Sr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var De=0,Aa=Sr.length;De<Aa;++De)ie[De]=Sr[De],Y[Sr.charCodeAt(De)]=De;Y[45]=62;Y[95]=63;function Hs(n){var e=n.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=n.indexOf("=");t===-1&&(t=e);var r=t===e?0:4-t%4;return[t,r]}function ka(n){var e=Hs(n),t=e[0],r=e[1];return(t+r)*3/4-r}function Sa(n,e,t){return(e+t)*3/4-t}function Pa(n){var e,t=Hs(n),r=t[0],s=t[1],i=new xa(Sa(n,r,s)),a=0,o=s>0?r-4:r,c;for(c=0;c<o;c+=4)e=Y[n.charCodeAt(c)]<<18|Y[n.charCodeAt(c+1)]<<12|Y[n.charCodeAt(c+2)]<<6|Y[n.charCodeAt(c+3)],i[a++]=e>>16&255,i[a++]=e>>8&255,i[a++]=e&255;return s===2&&(e=Y[n.charCodeAt(c)]<<2|Y[n.charCodeAt(c+1)]>>4,i[a++]=e&255),s===1&&(e=Y[n.charCodeAt(c)]<<10|Y[n.charCodeAt(c+1)]<<4|Y[n.charCodeAt(c+2)]>>2,i[a++]=e>>8&255,i[a++]=e&255),i}function Ta(n){return ie[n>>18&63]+ie[n>>12&63]+ie[n>>6&63]+ie[n&63]}function Oa(n,e,t){for(var r,s=[],i=e;i<t;i+=3)r=(n[i]<<16&16711680)+(n[i+1]<<8&65280)+(n[i+2]&255),s.push(Ta(r));return s.join("")}function Ia(n){for(var e,t=n.length,r=t%3,s=[],i=16383,a=0,o=t-r;a<o;a+=i)s.push(Oa(n,a,a+i>o?o:a+i));return r===1?(e=n[t-1],s.push(ie[e>>2]+ie[e<<4&63]+"==")):r===2&&(e=(n[t-2]<<8)+n[t-1],s.push(ie[e>>10]+ie[e>>4&63]+ie[e<<2&63]+"=")),s.join("")}var Ra=Object.defineProperty,Ca=(n,e,t)=>e in n?Ra(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,ja=(n,e,t)=>(Ca(n,typeof e!="symbol"?e+"":e,t),t);function $a(n,e){let t=Array.from({length:n.length},(r,s)=>({start:s,end:s+1}));for(;t.length>1;){let r=null;for(let s=0;s<t.length-1;s++){const i=n.slice(t[s].start,t[s+1].end),a=e.get(i.join(","));a!=null&&(r==null||a<r[0])&&(r=[a,s])}if(r!=null){const s=r[1];t[s]={start:t[s].start,end:t[s+1].end},t.splice(s+1,1)}else break}return t}function La(n,e){return n.length===1?[e.get(n.join(","))]:$a(n,e).map(t=>e.get(n.slice(t.start,t.end).join(","))).filter(t=>t!=null)}function Na(n){return n.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var Kr=class{constructor(n,e){ye(this,"specialTokens");ye(this,"inverseSpecialTokens");ye(this,"patStr");ye(this,"textEncoder",new TextEncoder);ye(this,"textDecoder",new TextDecoder("utf-8"));ye(this,"rankMap",new Map);ye(this,"textMap",new Map);this.patStr=n.pat_str;const t=n.bpe_ranks.split(`
`).filter(Boolean).reduce((r,s)=>{const[i,a,...o]=s.split(" "),c=Number.parseInt(a,10);return o.forEach((u,l)=>r[u]=c+l),r},{});for(const[r,s]of Object.entries(t)){const i=gr.toByteArray(r);this.rankMap.set(i.join(","),s),this.textMap.set(s,i)}this.specialTokens={...n.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((r,[s,i])=>(r[i]=this.textEncoder.encode(s),r),{})}encode(n,e=[],t="all"){const r=new RegExp(this.patStr,"ug"),s=Kr.specialTokenRegex(Object.keys(this.specialTokens)),i=[],a=new Set(e==="all"?Object.keys(this.specialTokens):e),o=new Set(t==="all"?Object.keys(this.specialTokens).filter(u=>!a.has(u)):t);if(o.size>0){const u=Kr.specialTokenRegex([...o]),l=n.match(u);if(l!=null)throw new Error(`The text contains a special token that is not allowed: ${l[0]}`)}let c=0;for(;;){let u=null,l=c;for(;s.lastIndex=l,u=s.exec(n),!(u==null||a.has(u[0]));)l=u.index+1;const h=(u==null?void 0:u.index)??n.length;for(const f of n.substring(c,h).matchAll(r)){const p=this.textEncoder.encode(f[0]),b=this.rankMap.get(p.join(","));if(b!=null){i.push(b);continue}i.push(...La(p,this.rankMap))}if(u==null)break;let d=this.specialTokens[u[0]];i.push(d),c=u.index+u[0].length}return i}decode(n){const e=[];let t=0;for(let i=0;i<n.length;++i){const a=n[i],o=this.textMap.get(a)??this.inverseSpecialTokens[a];o!=null&&(e.push(o),t+=o.length)}const r=new Uint8Array(t);let s=0;for(const i of e)r.set(i,s),s+=i.length;return this.textDecoder.decode(r)}},Zs=Kr;ja(Zs,"specialTokenRegex",n=>new RegExp(n.map(e=>Na(e)).join("|"),"g"));function Ua(n){switch(n){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":return"cl100k_base";default:throw new Error("Unknown model")}}var yr={exports:{}},Ks={};function ee(n,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(n)),this._timeouts=n,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}var Da=ee;ee.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};ee.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};ee.prototype.retry=function(n){if(this._timeout&&clearTimeout(this._timeout),!n)return!1;var e=new Date().getTime();if(n&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(n),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(n);var t=this._timeouts.shift();if(t===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),t=this._cachedTimeouts.slice(-1);else return!1;var r=this;return this._timer=setTimeout(function(){r._attempts++,r._operationTimeoutCb&&(r._timeout=setTimeout(function(){r._operationTimeoutCb(r._attempts)},r._operationTimeout),r._options.unref&&r._timeout.unref()),r._fn(r._attempts)},t),this._options.unref&&this._timer.unref(),!0};ee.prototype.attempt=function(n,e){this._fn=n,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var t=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){t._operationTimeoutCb()},t._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};ee.prototype.try=function(n){console.log("Using RetryOperation.try() is deprecated"),this.attempt(n)};ee.prototype.start=function(n){console.log("Using RetryOperation.start() is deprecated"),this.attempt(n)};ee.prototype.start=ee.prototype.try;ee.prototype.errors=function(){return this._errors};ee.prototype.attempts=function(){return this._attempts};ee.prototype.mainError=function(){if(this._errors.length===0)return null;for(var n={},e=null,t=0,r=0;r<this._errors.length;r++){var s=this._errors[r],i=s.message,a=(n[i]||0)+1;n[i]=a,a>=t&&(e=s,t=a)}return e};(function(n){var e=Da;n.operation=function(t){var r=n.timeouts(t);return new e(r,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},n.timeouts=function(t){if(t instanceof Array)return[].concat(t);var r={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var s in t)r[s]=t[s];if(r.minTimeout>r.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var i=[],a=0;a<r.retries;a++)i.push(this.createTimeout(a,r));return t&&t.forever&&!i.length&&i.push(this.createTimeout(a,r)),i.sort(function(o,c){return o-c}),i},n.createTimeout=function(t,r){var s=r.randomize?Math.random()+1:1,i=Math.round(s*Math.max(r.minTimeout,1)*Math.pow(r.factor,t));return i=Math.min(i,r.maxTimeout),i},n.wrap=function(t,r,s){if(r instanceof Array&&(s=r,r=null),!s){s=[];for(var i in t)typeof t[i]=="function"&&s.push(i)}for(var a=0;a<s.length;a++){var o=s[a],c=t[o];t[o]=(function(l){var h=n.operation(r),d=Array.prototype.slice.call(arguments,1),f=d.pop();d.push(function(p){h.retry(p)||(p&&(arguments[0]=h.mainError()),f.apply(this,arguments))}),h.attempt(function(){l.apply(t,d)})}).bind(t,c),t[o].options=r}}})(Ks);var Ma=Ks;const Ba=Ma,za=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class Js extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const qa=(n,e,t)=>{const r=t.retries-(e-1);return n.attemptNumber=e,n.retriesLeft=r,n},Fa=n=>za.includes(n),Gs=(n,e)=>new Promise((t,r)=>{e={onFailedAttempt:()=>{},retries:10,...e};const s=Ba.operation(e);s.attempt(async i=>{try{t(await n(i))}catch(a){if(!(a instanceof Error)){r(new TypeError(`Non-error was thrown: "${a}". You should only throw errors.`));return}if(a instanceof Js)s.stop(),r(a.originalError);else if(a instanceof TypeError&&!Fa(a.message))s.stop(),r(a);else{qa(a,i,e);try{await e.onFailedAttempt(a)}catch(o){r(o);return}s.retry(a)||r(s.mainError())}}})});yr.exports=Gs;yr.exports.default=Gs;yr.exports.AbortError=Js;var Va=yr.exports;const Gt=kn(Va);var Ws={},Xs={exports:{}};(function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function s(c,u,l){this.fn=c,this.context=u,this.once=l||!1}function i(c,u,l,h,d){if(typeof l!="function")throw new TypeError("The listener must be a function");var f=new s(l,h||c,d),p=t?t+u:u;return c._events[p]?c._events[p].fn?c._events[p]=[c._events[p],f]:c._events[p].push(f):(c._events[p]=f,c._eventsCount++),c}function a(c,u){--c._eventsCount===0?c._events=new r:delete c._events[u]}function o(){this._events=new r,this._eventsCount=0}o.prototype.eventNames=function(){var u=[],l,h;if(this._eventsCount===0)return u;for(h in l=this._events)e.call(l,h)&&u.push(t?h.slice(1):h);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(l)):u},o.prototype.listeners=function(u){var l=t?t+u:u,h=this._events[l];if(!h)return[];if(h.fn)return[h.fn];for(var d=0,f=h.length,p=new Array(f);d<f;d++)p[d]=h[d].fn;return p},o.prototype.listenerCount=function(u){var l=t?t+u:u,h=this._events[l];return h?h.fn?1:h.length:0},o.prototype.emit=function(u,l,h,d,f,p){var b=t?t+u:u;if(!this._events[b])return!1;var m=this._events[b],S=arguments.length,R,A;if(m.fn){switch(m.once&&this.removeListener(u,m.fn,void 0,!0),S){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,l),!0;case 3:return m.fn.call(m.context,l,h),!0;case 4:return m.fn.call(m.context,l,h,d),!0;case 5:return m.fn.call(m.context,l,h,d,f),!0;case 6:return m.fn.call(m.context,l,h,d,f,p),!0}for(A=1,R=new Array(S-1);A<S;A++)R[A-1]=arguments[A];m.fn.apply(m.context,R)}else{var j=m.length,se;for(A=0;A<j;A++)switch(m[A].once&&this.removeListener(u,m[A].fn,void 0,!0),S){case 1:m[A].fn.call(m[A].context);break;case 2:m[A].fn.call(m[A].context,l);break;case 3:m[A].fn.call(m[A].context,l,h);break;case 4:m[A].fn.call(m[A].context,l,h,d);break;default:if(!R)for(se=1,R=new Array(S-1);se<S;se++)R[se-1]=arguments[se];m[A].fn.apply(m[A].context,R)}}return!0},o.prototype.on=function(u,l,h){return i(this,u,l,h,!1)},o.prototype.once=function(u,l,h){return i(this,u,l,h,!0)},o.prototype.removeListener=function(u,l,h,d){var f=t?t+u:u;if(!this._events[f])return this;if(!l)return a(this,f),this;var p=this._events[f];if(p.fn)p.fn===l&&(!d||p.once)&&(!h||p.context===h)&&a(this,f);else{for(var b=0,m=[],S=p.length;b<S;b++)(p[b].fn!==l||d&&!p[b].once||h&&p[b].context!==h)&&m.push(p[b]);m.length?this._events[f]=m.length===1?m[0]:m:a(this,f)}return this},o.prototype.removeAllListeners=function(u){var l;return u?(l=t?t+u:u,this._events[l]&&a(this,l)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,n.exports=o})(Xs);var Ha=Xs.exports,_r={exports:{}},Za=(n,e)=>(e=e||(()=>{}),n.then(t=>new Promise(r=>{r(e())}).then(()=>t),t=>new Promise(r=>{r(e())}).then(()=>{throw t})));const Ka=Za;class Qs extends Error{constructor(e){super(e),this.name="TimeoutError"}}const Ys=(n,e,t)=>new Promise((r,s)=>{if(typeof e!="number"||e<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(e===1/0){r(n);return}const i=setTimeout(()=>{if(typeof t=="function"){try{r(t())}catch(c){s(c)}return}const a=typeof t=="string"?t:`Promise timed out after ${e} milliseconds`,o=t instanceof Error?t:new Qs(a);typeof n.cancel=="function"&&n.cancel(),s(o)},e);Ka(n.then(r,s),()=>{clearTimeout(i)})});_r.exports=Ys;_r.exports.default=Ys;_r.exports.TimeoutError=Qs;var Ja=_r.exports,Sn={},Pn={};Object.defineProperty(Pn,"__esModule",{value:!0});function Ga(n,e,t){let r=0,s=n.length;for(;s>0;){const i=s/2|0;let a=r+i;t(n[a],e)<=0?(r=++a,s-=i+1):s=i}return r}Pn.default=Ga;Object.defineProperty(Sn,"__esModule",{value:!0});const Wa=Pn;class Xa{constructor(){this._queue=[]}enqueue(e,t){t=Object.assign({priority:0},t);const r={priority:t.priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority){this._queue.push(r);return}const s=Wa.default(this._queue,r,(i,a)=>a.priority-i.priority);this._queue.splice(s,0,r)}dequeue(){const e=this._queue.shift();return e==null?void 0:e.run}filter(e){return this._queue.filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return this._queue.length}}Sn.default=Xa;Object.defineProperty(Ws,"__esModule",{value:!0});const Qa=Ha,ei=Ja,Ya=Sn,At=()=>{},eo=new ei.TimeoutError;class to extends Qa{constructor(e){var t,r,s,i;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=At,this._resolveIdle=At,e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:Ya.default},e),!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(r=(t=e.intervalCap)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(i=(s=e.interval)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||e.interval===0,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=e.throwOnTimeout===!0,this._isPaused=e.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=At,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=At,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const e=Date.now();if(this._intervalId===void 0){const t=this._intervalEnd-e;if(t<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},t)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const t=this._queue.dequeue();return t?(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise((r,s)=>{const i=async()=>{this._pendingCount++,this._intervalCount++;try{const a=this._timeout===void 0&&t.timeout===void 0?e():ei.default(Promise.resolve(e()),t.timeout===void 0?this._timeout:t.timeout,()=>{(t.throwOnTimeout===void 0?this._throwOnTimeout:t.throwOnTimeout)&&s(eo)});r(await a)}catch(a){s(a)}this._next()};this._queue.enqueue(i,t),this._tryToStartAnother(),this.emit("add")})}async addAll(e,t){return Promise.all(e.map(async r=>this.add(r,t)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(e=>{const t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(e=>{const t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}}var pe=Ws.default=to;const ro=[400,401,402,403,404,405,406,407,408,409],no=n=>{var t,r;if(n.message.startsWith("Cancel")||n.message.startsWith("TimeoutError")||n.name==="TimeoutError"||n.message.startsWith("AbortError")||n.name==="AbortError"||(n==null?void 0:n.code)==="ECONNABORTED")throw n;const e=((t=n==null?void 0:n.response)==null?void 0:t.status)??(n==null?void 0:n.status);if(e&&ro.includes(+e))throw n;if(((r=n==null?void 0:n.error)==null?void 0:r.code)==="insufficient_quota"){const s=new Error(n==null?void 0:n.message);throw s.name="InsufficientQuotaError",s}};let br=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??no;const t="default"in pe?pe.default:pe;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>Gt(()=>e(...t).catch(r=>{throw r instanceof Error?r:new Error(r)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((s,i)=>{var a;(a=e.signal)==null||a.addEventListener("abort",()=>{i(new Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}};const kt={},so=new br({});async function io(n,e){return n in kt||(kt[n]=so.fetch(`https://tiktoken.pages.dev/js/${n}.json`,{signal:e==null?void 0:e.signal}).then(t=>t.json()).catch(t=>{throw delete kt[n],t})),new Zs(await kt[n],e==null?void 0:e.extendedSpecialTokens)}async function ao(n,e){return io(Ua(n),e)}const Jr=n=>n.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":n.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":n.startsWith("gpt-4-32k")?"gpt-4-32k":n.startsWith("gpt-4-")?"gpt-4":n;var oo=function(n,e){if(typeof n!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,n.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()};const co=kn(oo);var ti={exports:{}};const uo=/[\p{Lu}]/u,lo=/[\p{Ll}]/u,Gn=/^[\p{Lu}](?![\p{Lu}])/gu,ri=/([\p{Alpha}\p{N}_]|$)/u,ni=/[_.\- ]+/,ho=new RegExp("^"+ni.source),Wn=new RegExp(ni.source+ri.source,"gu"),Xn=new RegExp("\\d+"+ri.source,"gu"),fo=(n,e,t)=>{let r=!1,s=!1,i=!1;for(let a=0;a<n.length;a++){const o=n[a];r&&uo.test(o)?(n=n.slice(0,a)+"-"+n.slice(a),r=!1,i=s,s=!0,a++):s&&i&&lo.test(o)?(n=n.slice(0,a-1)+"-"+n.slice(a-1),i=s,s=!1,r=!0):(r=e(o)===o&&t(o)!==o,i=s,s=t(o)===o&&e(o)!==o)}return n},po=(n,e)=>(Gn.lastIndex=0,n.replace(Gn,t=>e(t))),mo=(n,e)=>(Wn.lastIndex=0,Xn.lastIndex=0,n.replace(Wn,(t,r)=>e(r)).replace(Xn,t=>e(t))),si=(n,e)=>{if(!(typeof n=="string"||Array.isArray(n)))throw new TypeError("Expected the input to be `string | string[]`");if(e={pascalCase:!1,preserveConsecutiveUppercase:!1,...e},Array.isArray(n)?n=n.map(i=>i.trim()).filter(i=>i.length).join("-"):n=n.trim(),n.length===0)return"";const t=e.locale===!1?i=>i.toLowerCase():i=>i.toLocaleLowerCase(e.locale),r=e.locale===!1?i=>i.toUpperCase():i=>i.toLocaleUpperCase(e.locale);return n.length===1?e.pascalCase?r(n):t(n):(n!==t(n)&&(n=fo(n,t,r)),n=n.replace(ho,""),e.preserveConsecutiveUppercase?n=po(n,t):n=t(n),e.pascalCase&&(n=r(n.charAt(0))+n.slice(1)),mo(n,r))};ti.exports=si;ti.exports.default=si;function go(n,e){return(e==null?void 0:e[n])||co(n)}function yo(n,e,t){const r={};for(const s in n)Object.hasOwn(n,s)&&(r[e(s,t)]=n[s]);return r}function Qn(n){return Array.isArray(n)?[...n]:{...n}}function _o(n,e){const t=Qn(n);for(const[r,s]of Object.entries(e)){const[i,...a]=r.split(".").reverse();let o=t;for(const c of a.reverse()){if(o[c]===void 0)break;o[c]=Qn(o[c]),o=o[c]}o[i]!==void 0&&(o[i]={lc:1,type:"secret",id:[s]})}return t}function ii(n){const e=Object.getPrototypeOf(n);return typeof n.lc_name=="function"&&(typeof e.lc_name!="function"||n.lc_name()!==e.lc_name())?n.lc_name():n.name}class ke{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,ii(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_kwargs=e||{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof ke||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const e={},t={},r=Object.keys(this.lc_kwargs).reduce((s,i)=>(s[i]=i in this?this[i]:this.lc_kwargs[i],s),{});for(let s=Object.getPrototypeOf(this);s;s=Object.getPrototypeOf(s))Object.assign(e,Reflect.get(s,"lc_aliases",this)),Object.assign(t,Reflect.get(s,"lc_secrets",this)),Object.assign(r,Reflect.get(s,"lc_attributes",this));return Object.keys(t).forEach(s=>{let i=this,a=r;const[o,...c]=s.split(".").reverse();for(const u of c.reverse()){if(!(u in i)||i[u]===void 0)return;(!(u in a)||a[u]===void 0)&&(typeof i[u]=="object"&&i[u]!=null?a[u]={}:Array.isArray(i[u])&&(a[u]=[])),i=i[u],a=a[u]}o in i&&i[o]!==void 0&&(a[o]=a[o]||i[o])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:yo(Object.keys(t).length?_o(r,t):r,go,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}const bo="__run";class Tn{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new Tn({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}}class yt extends ke{get text(){return this.content}constructor(e,t){typeof e=="string"&&(e={content:e,additional_kwargs:t}),e.additional_kwargs||(e.additional_kwargs={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","schema"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}}class _t extends yt{static _mergeAdditionalKwargs(e,t){const r={...e};for(const[s,i]of Object.entries(t))if(r[s]===void 0)r[s]=i;else{if(typeof r[s]!=typeof i)throw new Error(`additional_kwargs[${s}] already exists in the message chunk, but with a different type.`);if(typeof r[s]=="string")r[s]=r[s]+i;else if(!Array.isArray(r[s])&&typeof r[s]=="object")r[s]=this._mergeAdditionalKwargs(r[s],i);else throw new Error(`additional_kwargs[${s}] already exists in this message chunk.`)}return r}}class dt extends yt{static lc_name(){return"HumanMessage"}_getType(){return"human"}}class Wt extends _t{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}concat(e){return new Wt({content:this.content+e.content,additional_kwargs:Wt._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs)})}}class ai extends yt{static lc_name(){return"AIMessage"}_getType(){return"ai"}}class Xt extends _t{static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}concat(e){return new Xt({content:this.content+e.content,additional_kwargs:Xt._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs)})}}class oi extends yt{static lc_name(){return"SystemMessage"}_getType(){return"system"}}class Qt extends _t{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}concat(e){return new Qt({content:this.content+e.content,additional_kwargs:Qt._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs)})}}class Yt extends _t{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new Yt({content:this.content+e.content,additional_kwargs:Yt._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs),name:this.name??""})}}class ci extends yt{static lc_name(){return"ChatMessage"}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return e._getType()==="generic"}}function vo(n){return typeof n._getType=="function"}function Gr(n){if(typeof n=="string")return new dt(n);if(vo(n))return n;const[e,t]=n;if(e==="human"||e==="user")return new dt({content:t});if(e==="ai"||e==="assistant")return new ai({content:t});if(e==="system")return new oi({content:t});throw new Error("Unable to coerce message from array: only human, AI, or system message coercion is currently supported.")}class er extends _t{static lc_name(){return"ChatMessageChunk"}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new er({content:this.content+e.content,additional_kwargs:er._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs),role:this.role})}}class On extends Tn{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new On({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}}class ui extends ke{}function li(n,e,t,r){r!=null&&r.errorMessages&&t&&(n.errorMessage={...n.errorMessage,[e]:t})}function C(n,e,t,r,s){n[e]=t,li(n,e,r,s)}const Yn={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"string",mapStrategy:"entries",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",emailStrategy:"format:email"},wo=n=>typeof n=="string"?{...Yn,name:n}:{...Yn,...n};var O;(function(n){n.assertEqual=s=>s;function e(s){}n.assertIs=e;function t(s){throw new Error}n.assertNever=t,n.arrayToEnum=s=>{const i={};for(const a of s)i[a]=a;return i},n.getValidEnumValues=s=>{const i=n.objectKeys(s).filter(o=>typeof s[s[o]]!="number"),a={};for(const o of i)a[o]=s[o];return n.objectValues(a)},n.objectValues=s=>n.objectKeys(s).map(function(i){return s[i]}),n.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{const i=[];for(const a in s)Object.prototype.hasOwnProperty.call(s,a)&&i.push(a);return i},n.find=(s,i)=>{for(const a of s)if(i(a))return a},n.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&isFinite(s)&&Math.floor(s)===s;function r(s,i=" | "){return s.map(a=>typeof a=="string"?`'${a}'`:a).join(i)}n.joinValues=r,n.jsonStringifyReplacer=(s,i)=>typeof i=="bigint"?i.toString():i})(O||(O={}));var es;(function(n){n.mergeShapes=(e,t)=>({...e,...t})})(es||(es={}));const _=O.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Re=n=>{switch(typeof n){case"undefined":return _.undefined;case"string":return _.string;case"number":return isNaN(n)?_.nan:_.number;case"boolean":return _.boolean;case"function":return _.function;case"bigint":return _.bigint;case"symbol":return _.symbol;case"object":return Array.isArray(n)?_.array:n===null?_.null:n.then&&typeof n.then=="function"&&n.catch&&typeof n.catch=="function"?_.promise:typeof Map<"u"&&n instanceof Map?_.map:typeof Set<"u"&&n instanceof Set?_.set:typeof Date<"u"&&n instanceof Date?_.date:_.object;default:return _.unknown}},y=O.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class ae extends Error{constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const t=e||function(i){return i.message},r={_errors:[]},s=i=>{for(const a of i.issues)if(a.code==="invalid_union")a.unionErrors.map(s);else if(a.code==="invalid_return_type")s(a.returnTypeError);else if(a.code==="invalid_arguments")s(a.argumentsError);else if(a.path.length===0)r._errors.push(t(a));else{let o=r,c=0;for(;c<a.path.length;){const u=a.path[c];c===a.path.length-1?(o[u]=o[u]||{_errors:[]},o[u]._errors.push(t(a))):o[u]=o[u]||{_errors:[]},o=o[u],c++}}};return s(this),r}toString(){return this.message}get message(){return JSON.stringify(this.issues,O.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},r=[];for(const s of this.issues)s.path.length>0?(t[s.path[0]]=t[s.path[0]]||[],t[s.path[0]].push(e(s))):r.push(e(s));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}ae.create=n=>new ae(n);const tr=(n,e)=>{let t;switch(n.code){case y.invalid_type:n.received===_.undefined?t="Required":t=`Expected ${n.expected}, received ${n.received}`;break;case y.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(n.expected,O.jsonStringifyReplacer)}`;break;case y.unrecognized_keys:t=`Unrecognized key(s) in object: ${O.joinValues(n.keys,", ")}`;break;case y.invalid_union:t="Invalid input";break;case y.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${O.joinValues(n.options)}`;break;case y.invalid_enum_value:t=`Invalid enum value. Expected ${O.joinValues(n.options)}, received '${n.received}'`;break;case y.invalid_arguments:t="Invalid function arguments";break;case y.invalid_return_type:t="Invalid function return type";break;case y.invalid_date:t="Invalid date";break;case y.invalid_string:typeof n.validation=="object"?"includes"in n.validation?(t=`Invalid input: must include "${n.validation.includes}"`,typeof n.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${n.validation.position}`)):"startsWith"in n.validation?t=`Invalid input: must start with "${n.validation.startsWith}"`:"endsWith"in n.validation?t=`Invalid input: must end with "${n.validation.endsWith}"`:O.assertNever(n.validation):n.validation!=="regex"?t=`Invalid ${n.validation}`:t="Invalid";break;case y.too_small:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(n.minimum))}`:t="Invalid input";break;case y.too_big:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="bigint"?t=`BigInt must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly":n.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(n.maximum))}`:t="Invalid input";break;case y.custom:t="Invalid input";break;case y.invalid_intersection_types:t="Intersection results could not be merged";break;case y.not_multiple_of:t=`Number must be a multiple of ${n.multipleOf}`;break;case y.not_finite:t="Number must be finite";break;default:t=e.defaultError,O.assertNever(n)}return{message:t}};let Eo=tr;function Wr(){return Eo}const Xr=n=>{const{data:e,path:t,errorMaps:r,issueData:s}=n,i=[...t,...s.path||[]],a={...s,path:i};let o="";const c=r.filter(u=>!!u).slice().reverse();for(const u of c)o=u(a,{data:e,defaultError:o}).message;return{...s,path:i,message:s.message||o}};function v(n,e){const t=Xr({issueData:e,data:n.data,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,Wr(),tr].filter(r=>!!r)});n.common.issues.push(t)}class H{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const r=[];for(const s of t){if(s.status==="aborted")return x;s.status==="dirty"&&e.dirty(),r.push(s.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){const r=[];for(const s of t)r.push({key:await s.key,value:await s.value});return H.mergeObjectSync(e,r)}static mergeObjectSync(e,t){const r={};for(const s of t){const{key:i,value:a}=s;if(i.status==="aborted"||a.status==="aborted")return x;i.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof a.value<"u"||s.alwaysSet)&&(r[i.value]=a.value)}return{status:e.value,value:r}}}const x=Object.freeze({status:"aborted"}),xo=n=>({status:"dirty",value:n}),J=n=>({status:"valid",value:n}),ts=n=>n.status==="aborted",rs=n=>n.status==="dirty",rr=n=>n.status==="valid",Qr=n=>typeof Promise<"u"&&n instanceof Promise;var w;(function(n){n.errToObj=e=>typeof e=="string"?{message:e}:e||{},n.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(w||(w={}));class ue{constructor(e,t,r,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=s}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const ns=(n,e)=>{if(rr(e))return{success:!0,data:e.value};if(!n.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new ae(n.common.issues);return this._error=t,this._error}}};function E(n){if(!n)return{};const{errorMap:e,invalid_type_error:t,required_error:r,description:s}=n;if(e&&(t||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(a,o)=>a.code!=="invalid_type"?{message:o.defaultError}:typeof o.data>"u"?{message:r??o.defaultError}:{message:t??o.defaultError},description:s}}class k{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return Re(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Re(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new H,ctx:{common:e.parent.common,data:e.data,parsedType:Re(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(Qr(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;const s={common:{issues:[],async:(r=t==null?void 0:t.async)!==null&&r!==void 0?r:!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Re(e)},i=this._parseSync({data:e,path:s.path,parent:s});return ns(s,i)}async parseAsync(e,t){const r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){const r={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Re(e)},s=this._parse({data:e,path:r.path,parent:r}),i=await(Qr(s)?s:Promise.resolve(s));return ns(r,i)}refine(e,t){const r=s=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(s):t;return this._refinement((s,i)=>{const a=e(s),o=()=>i.addIssue({code:y.custom,...r(s)});return typeof Promise<"u"&&a instanceof Promise?a.then(c=>c?!0:(o(),!1)):a?!0:(o(),!1)})}refinement(e,t){return this._refinement((r,s)=>e(r)?!0:(s.addIssue(typeof t=="function"?t(r,s):t),!1))}_refinement(e){return new ge({schema:this,typeName:g.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return Ae.create(this,this._def)}nullable(){return et.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return oe.create(this,this._def)}promise(){return pt.create(this,this._def)}or(e){return ir.create([this,e],this._def)}and(e){return ar.create(this,e,this._def)}transform(e){return new ge({...E(this._def),schema:this,typeName:g.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new hr({...E(this._def),innerType:this,defaultValue:t,typeName:g.ZodDefault})}brand(){return new Lo({typeName:g.ZodBranded,type:this,...E(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new an({...E(this._def),innerType:this,catchValue:t,typeName:g.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return vr.create(this,e)}readonly(){return cn.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const Ao=/^c[^\s-]{8,}$/i,ko=/^[a-z][a-z0-9]*$/,So=/^[0-9A-HJKMNP-TV-Z]{26}$/,Po=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,To=/^(?!\.)(?!.*\.\.)([A-Z0-9_+-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Oo="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let Pr;const Io=/^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$/,Ro=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,Co=n=>n.precision?n.offset?new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${n.precision}}(([+-]\\d{2}(:?\\d{2})?)|Z)$`):new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${n.precision}}Z$`):n.precision===0?n.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"):n.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?Z$");function jo(n,e){return!!((e==="v4"||!e)&&Io.test(n)||(e==="v6"||!e)&&Ro.test(n))}class fe extends k{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==_.string){const i=this._getOrReturnCtx(e);return v(i,{code:y.invalid_type,expected:_.string,received:i.parsedType}),x}const r=new H;let s;for(const i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(s=this._getOrReturnCtx(e,s),v(s,{code:y.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if(i.kind==="max")e.data.length>i.value&&(s=this._getOrReturnCtx(e,s),v(s,{code:y.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if(i.kind==="length"){const a=e.data.length>i.value,o=e.data.length<i.value;(a||o)&&(s=this._getOrReturnCtx(e,s),a?v(s,{code:y.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):o&&v(s,{code:y.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),r.dirty())}else if(i.kind==="email")To.test(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{validation:"email",code:y.invalid_string,message:i.message}),r.dirty());else if(i.kind==="emoji")Pr||(Pr=new RegExp(Oo,"u")),Pr.test(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{validation:"emoji",code:y.invalid_string,message:i.message}),r.dirty());else if(i.kind==="uuid")Po.test(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{validation:"uuid",code:y.invalid_string,message:i.message}),r.dirty());else if(i.kind==="cuid")Ao.test(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{validation:"cuid",code:y.invalid_string,message:i.message}),r.dirty());else if(i.kind==="cuid2")ko.test(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{validation:"cuid2",code:y.invalid_string,message:i.message}),r.dirty());else if(i.kind==="ulid")So.test(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{validation:"ulid",code:y.invalid_string,message:i.message}),r.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),v(s,{validation:"url",code:y.invalid_string,message:i.message}),r.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{validation:"regex",code:y.invalid_string,message:i.message}),r.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(s=this._getOrReturnCtx(e,s),v(s,{code:y.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),r.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(s=this._getOrReturnCtx(e,s),v(s,{code:y.invalid_string,validation:{startsWith:i.value},message:i.message}),r.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(s=this._getOrReturnCtx(e,s),v(s,{code:y.invalid_string,validation:{endsWith:i.value},message:i.message}),r.dirty()):i.kind==="datetime"?Co(i).test(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{code:y.invalid_string,validation:"datetime",message:i.message}),r.dirty()):i.kind==="ip"?jo(e.data,i.version)||(s=this._getOrReturnCtx(e,s),v(s,{validation:"ip",code:y.invalid_string,message:i.message}),r.dirty()):O.assertNever(i);return{status:r.value,value:e.data}}_regex(e,t,r){return this.refinement(s=>e.test(s),{validation:t,code:y.invalid_string,...w.errToObj(r)})}_addCheck(e){return new fe({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...w.errToObj(e)})}url(e){return this._addCheck({kind:"url",...w.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...w.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...w.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...w.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...w.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...w.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...w.errToObj(e)})}datetime(e){var t;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(t=e==null?void 0:e.offset)!==null&&t!==void 0?t:!1,...w.errToObj(e==null?void 0:e.message)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...w.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...w.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...w.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...w.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...w.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...w.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...w.errToObj(t)})}nonempty(e){return this.min(1,w.errToObj(e))}trim(){return new fe({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new fe({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new fe({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}fe.create=n=>{var e;return new fe({checks:[],typeName:g.ZodString,coerce:(e=n==null?void 0:n.coerce)!==null&&e!==void 0?e:!1,...E(n)})};function $o(n,e){const t=(n.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,s=t>r?t:r,i=parseInt(n.toFixed(s).replace(".","")),a=parseInt(e.toFixed(s).replace(".",""));return i%a/Math.pow(10,s)}class Xe extends k{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==_.number){const i=this._getOrReturnCtx(e);return v(i,{code:y.invalid_type,expected:_.number,received:i.parsedType}),x}let r;const s=new H;for(const i of this._def.checks)i.kind==="int"?O.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),v(r,{code:y.invalid_type,expected:"integer",received:"float",message:i.message}),s.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(r=this._getOrReturnCtx(e,r),v(r,{code:y.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(r=this._getOrReturnCtx(e,r),v(r,{code:y.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="multipleOf"?$o(e.data,i.value)!==0&&(r=this._getOrReturnCtx(e,r),v(r,{code:y.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),v(r,{code:y.not_finite,message:i.message}),s.dirty()):O.assertNever(i);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,w.toString(t))}gt(e,t){return this.setLimit("min",e,!1,w.toString(t))}lte(e,t){return this.setLimit("max",e,!0,w.toString(t))}lt(e,t){return this.setLimit("max",e,!1,w.toString(t))}setLimit(e,t,r,s){return new Xe({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:w.toString(s)}]})}_addCheck(e){return new Xe({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:w.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:w.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:w.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:w.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:w.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:w.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:w.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:w.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:w.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&O.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(t===null||r.value>t)&&(t=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}Xe.create=n=>new Xe({checks:[],typeName:g.ZodNumber,coerce:(n==null?void 0:n.coerce)||!1,...E(n)});class Qe extends k{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==_.bigint){const i=this._getOrReturnCtx(e);return v(i,{code:y.invalid_type,expected:_.bigint,received:i.parsedType}),x}let r;const s=new H;for(const i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(r=this._getOrReturnCtx(e,r),v(r,{code:y.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(r=this._getOrReturnCtx(e,r),v(r,{code:y.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),v(r,{code:y.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):O.assertNever(i);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,w.toString(t))}gt(e,t){return this.setLimit("min",e,!1,w.toString(t))}lte(e,t){return this.setLimit("max",e,!0,w.toString(t))}lt(e,t){return this.setLimit("max",e,!1,w.toString(t))}setLimit(e,t,r,s){return new Qe({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:w.toString(s)}]})}_addCheck(e){return new Qe({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:w.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:w.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:w.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:w.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:w.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}Qe.create=n=>{var e;return new Qe({checks:[],typeName:g.ZodBigInt,coerce:(e=n==null?void 0:n.coerce)!==null&&e!==void 0?e:!1,...E(n)})};class Yr extends k{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==_.boolean){const r=this._getOrReturnCtx(e);return v(r,{code:y.invalid_type,expected:_.boolean,received:r.parsedType}),x}return J(e.data)}}Yr.create=n=>new Yr({typeName:g.ZodBoolean,coerce:(n==null?void 0:n.coerce)||!1,...E(n)});class ft extends k{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==_.date){const i=this._getOrReturnCtx(e);return v(i,{code:y.invalid_type,expected:_.date,received:i.parsedType}),x}if(isNaN(e.data.getTime())){const i=this._getOrReturnCtx(e);return v(i,{code:y.invalid_date}),x}const r=new H;let s;for(const i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(s=this._getOrReturnCtx(e,s),v(s,{code:y.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),r.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(s=this._getOrReturnCtx(e,s),v(s,{code:y.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),r.dirty()):O.assertNever(i);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new ft({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:w.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:w.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}ft.create=n=>new ft({checks:[],coerce:(n==null?void 0:n.coerce)||!1,typeName:g.ZodDate,...E(n)});class en extends k{_parse(e){if(this._getType(e)!==_.symbol){const r=this._getOrReturnCtx(e);return v(r,{code:y.invalid_type,expected:_.symbol,received:r.parsedType}),x}return J(e.data)}}en.create=n=>new en({typeName:g.ZodSymbol,...E(n)});class nr extends k{_parse(e){if(this._getType(e)!==_.undefined){const r=this._getOrReturnCtx(e);return v(r,{code:y.invalid_type,expected:_.undefined,received:r.parsedType}),x}return J(e.data)}}nr.create=n=>new nr({typeName:g.ZodUndefined,...E(n)});class sr extends k{_parse(e){if(this._getType(e)!==_.null){const r=this._getOrReturnCtx(e);return v(r,{code:y.invalid_type,expected:_.null,received:r.parsedType}),x}return J(e.data)}}sr.create=n=>new sr({typeName:g.ZodNull,...E(n)});class tn extends k{constructor(){super(...arguments),this._any=!0}_parse(e){return J(e.data)}}tn.create=n=>new tn({typeName:g.ZodAny,...E(n)});class Je extends k{constructor(){super(...arguments),this._unknown=!0}_parse(e){return J(e.data)}}Je.create=n=>new Je({typeName:g.ZodUnknown,...E(n)});class Se extends k{_parse(e){const t=this._getOrReturnCtx(e);return v(t,{code:y.invalid_type,expected:_.never,received:t.parsedType}),x}}Se.create=n=>new Se({typeName:g.ZodNever,...E(n)});class rn extends k{_parse(e){if(this._getType(e)!==_.undefined){const r=this._getOrReturnCtx(e);return v(r,{code:y.invalid_type,expected:_.void,received:r.parsedType}),x}return J(e.data)}}rn.create=n=>new rn({typeName:g.ZodVoid,...E(n)});class oe extends k{_parse(e){const{ctx:t,status:r}=this._processInputParams(e),s=this._def;if(t.parsedType!==_.array)return v(t,{code:y.invalid_type,expected:_.array,received:t.parsedType}),x;if(s.exactLength!==null){const a=t.data.length>s.exactLength.value,o=t.data.length<s.exactLength.value;(a||o)&&(v(t,{code:a?y.too_big:y.too_small,minimum:o?s.exactLength.value:void 0,maximum:a?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),r.dirty())}if(s.minLength!==null&&t.data.length<s.minLength.value&&(v(t,{code:y.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),r.dirty()),s.maxLength!==null&&t.data.length>s.maxLength.value&&(v(t,{code:y.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((a,o)=>s.type._parseAsync(new ue(t,a,t.path,o)))).then(a=>H.mergeArray(r,a));const i=[...t.data].map((a,o)=>s.type._parseSync(new ue(t,a,t.path,o)));return H.mergeArray(r,i)}get element(){return this._def.type}min(e,t){return new oe({...this._def,minLength:{value:e,message:w.toString(t)}})}max(e,t){return new oe({...this._def,maxLength:{value:e,message:w.toString(t)}})}length(e,t){return new oe({...this._def,exactLength:{value:e,message:w.toString(t)}})}nonempty(e){return this.min(1,e)}}oe.create=(n,e)=>new oe({type:n,minLength:null,maxLength:null,exactLength:null,typeName:g.ZodArray,...E(e)});function He(n){if(n instanceof U){const e={};for(const t in n.shape){const r=n.shape[t];e[t]=Ae.create(He(r))}return new U({...n._def,shape:()=>e})}else return n instanceof oe?new oe({...n._def,type:He(n.element)}):n instanceof Ae?Ae.create(He(n.unwrap())):n instanceof et?et.create(He(n.unwrap())):n instanceof me?me.create(n.items.map(e=>He(e))):n}class U extends k{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=O.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==_.object){const u=this._getOrReturnCtx(e);return v(u,{code:y.invalid_type,expected:_.object,received:u.parsedType}),x}const{status:r,ctx:s}=this._processInputParams(e),{shape:i,keys:a}=this._getCached(),o=[];if(!(this._def.catchall instanceof Se&&this._def.unknownKeys==="strip"))for(const u in s.data)a.includes(u)||o.push(u);const c=[];for(const u of a){const l=i[u],h=s.data[u];c.push({key:{status:"valid",value:u},value:l._parse(new ue(s,h,s.path,u)),alwaysSet:u in s.data})}if(this._def.catchall instanceof Se){const u=this._def.unknownKeys;if(u==="passthrough")for(const l of o)c.push({key:{status:"valid",value:l},value:{status:"valid",value:s.data[l]}});else if(u==="strict")o.length>0&&(v(s,{code:y.unrecognized_keys,keys:o}),r.dirty());else if(u!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const u=this._def.catchall;for(const l of o){const h=s.data[l];c.push({key:{status:"valid",value:l},value:u._parse(new ue(s,h,s.path,l)),alwaysSet:l in s.data})}}return s.common.async?Promise.resolve().then(async()=>{const u=[];for(const l of c){const h=await l.key;u.push({key:h,value:await l.value,alwaysSet:l.alwaysSet})}return u}).then(u=>H.mergeObjectSync(r,u)):H.mergeObjectSync(r,c)}get shape(){return this._def.shape()}strict(e){return w.errToObj,new U({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,r)=>{var s,i,a,o;const c=(a=(i=(s=this._def).errorMap)===null||i===void 0?void 0:i.call(s,t,r).message)!==null&&a!==void 0?a:r.defaultError;return t.code==="unrecognized_keys"?{message:(o=w.errToObj(e).message)!==null&&o!==void 0?o:c}:{message:c}}}:{}})}strip(){return new U({...this._def,unknownKeys:"strip"})}passthrough(){return new U({...this._def,unknownKeys:"passthrough"})}extend(e){return new U({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new U({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:g.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new U({...this._def,catchall:e})}pick(e){const t={};return O.objectKeys(e).forEach(r=>{e[r]&&this.shape[r]&&(t[r]=this.shape[r])}),new U({...this._def,shape:()=>t})}omit(e){const t={};return O.objectKeys(this.shape).forEach(r=>{e[r]||(t[r]=this.shape[r])}),new U({...this._def,shape:()=>t})}deepPartial(){return He(this)}partial(e){const t={};return O.objectKeys(this.shape).forEach(r=>{const s=this.shape[r];e&&!e[r]?t[r]=s:t[r]=s.optional()}),new U({...this._def,shape:()=>t})}required(e){const t={};return O.objectKeys(this.shape).forEach(r=>{if(e&&!e[r])t[r]=this.shape[r];else{let i=this.shape[r];for(;i instanceof Ae;)i=i._def.innerType;t[r]=i}}),new U({...this._def,shape:()=>t})}keyof(){return hi(O.objectKeys(this.shape))}}U.create=(n,e)=>new U({shape:()=>n,unknownKeys:"strip",catchall:Se.create(),typeName:g.ZodObject,...E(e)});U.strictCreate=(n,e)=>new U({shape:()=>n,unknownKeys:"strict",catchall:Se.create(),typeName:g.ZodObject,...E(e)});U.lazycreate=(n,e)=>new U({shape:n,unknownKeys:"strip",catchall:Se.create(),typeName:g.ZodObject,...E(e)});class ir extends k{_parse(e){const{ctx:t}=this._processInputParams(e),r=this._def.options;function s(i){for(const o of i)if(o.result.status==="valid")return o.result;for(const o of i)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;const a=i.map(o=>new ae(o.ctx.common.issues));return v(t,{code:y.invalid_union,unionErrors:a}),x}if(t.common.async)return Promise.all(r.map(async i=>{const a={...t,common:{...t.common,issues:[]},parent:null};return{result:await i._parseAsync({data:t.data,path:t.path,parent:a}),ctx:a}})).then(s);{let i;const a=[];for(const c of r){const u={...t,common:{...t.common,issues:[]},parent:null},l=c._parseSync({data:t.data,path:t.path,parent:u});if(l.status==="valid")return l;l.status==="dirty"&&!i&&(i={result:l,ctx:u}),u.common.issues.length&&a.push(u.common.issues)}if(i)return t.common.issues.push(...i.ctx.common.issues),i.result;const o=a.map(c=>new ae(c));return v(t,{code:y.invalid_union,unionErrors:o}),x}}get options(){return this._def.options}}ir.create=(n,e)=>new ir({options:n,typeName:g.ZodUnion,...E(e)});const It=n=>n instanceof cr?It(n.schema):n instanceof ge?It(n.innerType()):n instanceof ur?[n.value]:n instanceof Ne?n.options:n instanceof lr?Object.keys(n.enum):n instanceof hr?It(n._def.innerType):n instanceof nr?[void 0]:n instanceof sr?[null]:null;class In extends k{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==_.object)return v(t,{code:y.invalid_type,expected:_.object,received:t.parsedType}),x;const r=this.discriminator,s=t.data[r],i=this.optionsMap.get(s);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(v(t,{code:y.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),x)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){const s=new Map;for(const i of t){const a=It(i.shape[e]);if(!a)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const o of a){if(s.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);s.set(o,i)}}return new In({typeName:g.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:s,...E(r)})}}function nn(n,e){const t=Re(n),r=Re(e);if(n===e)return{valid:!0,data:n};if(t===_.object&&r===_.object){const s=O.objectKeys(e),i=O.objectKeys(n).filter(o=>s.indexOf(o)!==-1),a={...n,...e};for(const o of i){const c=nn(n[o],e[o]);if(!c.valid)return{valid:!1};a[o]=c.data}return{valid:!0,data:a}}else if(t===_.array&&r===_.array){if(n.length!==e.length)return{valid:!1};const s=[];for(let i=0;i<n.length;i++){const a=n[i],o=e[i],c=nn(a,o);if(!c.valid)return{valid:!1};s.push(c.data)}return{valid:!0,data:s}}else return t===_.date&&r===_.date&&+n==+e?{valid:!0,data:n}:{valid:!1}}class ar extends k{_parse(e){const{status:t,ctx:r}=this._processInputParams(e),s=(i,a)=>{if(ts(i)||ts(a))return x;const o=nn(i.value,a.value);return o.valid?((rs(i)||rs(a))&&t.dirty(),{status:t.value,value:o.data}):(v(r,{code:y.invalid_intersection_types}),x)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([i,a])=>s(i,a)):s(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}ar.create=(n,e,t)=>new ar({left:n,right:e,typeName:g.ZodIntersection,...E(t)});class me extends k{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==_.array)return v(r,{code:y.invalid_type,expected:_.array,received:r.parsedType}),x;if(r.data.length<this._def.items.length)return v(r,{code:y.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),x;!this._def.rest&&r.data.length>this._def.items.length&&(v(r,{code:y.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const i=[...r.data].map((a,o)=>{const c=this._def.items[o]||this._def.rest;return c?c._parse(new ue(r,a,r.path,o)):null}).filter(a=>!!a);return r.common.async?Promise.all(i).then(a=>H.mergeArray(t,a)):H.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new me({...this._def,rest:e})}}me.create=(n,e)=>{if(!Array.isArray(n))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new me({items:n,typeName:g.ZodTuple,rest:null,...E(e)})};class or extends k{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==_.object)return v(r,{code:y.invalid_type,expected:_.object,received:r.parsedType}),x;const s=[],i=this._def.keyType,a=this._def.valueType;for(const o in r.data)s.push({key:i._parse(new ue(r,o,r.path,o)),value:a._parse(new ue(r,r.data[o],r.path,o))});return r.common.async?H.mergeObjectAsync(t,s):H.mergeObjectSync(t,s)}get element(){return this._def.valueType}static create(e,t,r){return t instanceof k?new or({keyType:e,valueType:t,typeName:g.ZodRecord,...E(r)}):new or({keyType:fe.create(),valueType:e,typeName:g.ZodRecord,...E(t)})}}class sn extends k{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==_.map)return v(r,{code:y.invalid_type,expected:_.map,received:r.parsedType}),x;const s=this._def.keyType,i=this._def.valueType,a=[...r.data.entries()].map(([o,c],u)=>({key:s._parse(new ue(r,o,r.path,[u,"key"])),value:i._parse(new ue(r,c,r.path,[u,"value"]))}));if(r.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const c of a){const u=await c.key,l=await c.value;if(u.status==="aborted"||l.status==="aborted")return x;(u.status==="dirty"||l.status==="dirty")&&t.dirty(),o.set(u.value,l.value)}return{status:t.value,value:o}})}else{const o=new Map;for(const c of a){const u=c.key,l=c.value;if(u.status==="aborted"||l.status==="aborted")return x;(u.status==="dirty"||l.status==="dirty")&&t.dirty(),o.set(u.value,l.value)}return{status:t.value,value:o}}}}sn.create=(n,e,t)=>new sn({valueType:e,keyType:n,typeName:g.ZodMap,...E(t)});class Ye extends k{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==_.set)return v(r,{code:y.invalid_type,expected:_.set,received:r.parsedType}),x;const s=this._def;s.minSize!==null&&r.data.size<s.minSize.value&&(v(r,{code:y.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),s.maxSize!==null&&r.data.size>s.maxSize.value&&(v(r,{code:y.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());const i=this._def.valueType;function a(c){const u=new Set;for(const l of c){if(l.status==="aborted")return x;l.status==="dirty"&&t.dirty(),u.add(l.value)}return{status:t.value,value:u}}const o=[...r.data.values()].map((c,u)=>i._parse(new ue(r,c,r.path,u)));return r.common.async?Promise.all(o).then(c=>a(c)):a(o)}min(e,t){return new Ye({...this._def,minSize:{value:e,message:w.toString(t)}})}max(e,t){return new Ye({...this._def,maxSize:{value:e,message:w.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}Ye.create=(n,e)=>new Ye({valueType:n,minSize:null,maxSize:null,typeName:g.ZodSet,...E(e)});class at extends k{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==_.function)return v(t,{code:y.invalid_type,expected:_.function,received:t.parsedType}),x;function r(o,c){return Xr({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Wr(),tr].filter(u=>!!u),issueData:{code:y.invalid_arguments,argumentsError:c}})}function s(o,c){return Xr({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Wr(),tr].filter(u=>!!u),issueData:{code:y.invalid_return_type,returnTypeError:c}})}const i={errorMap:t.common.contextualErrorMap},a=t.data;if(this._def.returns instanceof pt){const o=this;return J(async function(...c){const u=new ae([]),l=await o._def.args.parseAsync(c,i).catch(f=>{throw u.addIssue(r(c,f)),u}),h=await Reflect.apply(a,this,l);return await o._def.returns._def.type.parseAsync(h,i).catch(f=>{throw u.addIssue(s(h,f)),u})})}else{const o=this;return J(function(...c){const u=o._def.args.safeParse(c,i);if(!u.success)throw new ae([r(c,u.error)]);const l=Reflect.apply(a,this,u.data),h=o._def.returns.safeParse(l,i);if(!h.success)throw new ae([s(l,h.error)]);return h.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new at({...this._def,args:me.create(e).rest(Je.create())})}returns(e){return new at({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new at({args:e||me.create([]).rest(Je.create()),returns:t||Je.create(),typeName:g.ZodFunction,...E(r)})}}class cr extends k{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}cr.create=(n,e)=>new cr({getter:n,typeName:g.ZodLazy,...E(e)});class ur extends k{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return v(t,{received:t.data,code:y.invalid_literal,expected:this._def.value}),x}return{status:"valid",value:e.data}}get value(){return this._def.value}}ur.create=(n,e)=>new ur({value:n,typeName:g.ZodLiteral,...E(e)});function hi(n,e){return new Ne({values:n,typeName:g.ZodEnum,...E(e)})}class Ne extends k{_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),r=this._def.values;return v(t,{expected:O.joinValues(r),received:t.parsedType,code:y.invalid_type}),x}if(this._def.values.indexOf(e.data)===-1){const t=this._getOrReturnCtx(e),r=this._def.values;return v(t,{received:t.data,code:y.invalid_enum_value,options:r}),x}return J(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e){return Ne.create(e)}exclude(e){return Ne.create(this.options.filter(t=>!e.includes(t)))}}Ne.create=hi;class lr extends k{_parse(e){const t=O.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==_.string&&r.parsedType!==_.number){const s=O.objectValues(t);return v(r,{expected:O.joinValues(s),received:r.parsedType,code:y.invalid_type}),x}if(t.indexOf(e.data)===-1){const s=O.objectValues(t);return v(r,{received:r.data,code:y.invalid_enum_value,options:s}),x}return J(e.data)}get enum(){return this._def.values}}lr.create=(n,e)=>new lr({values:n,typeName:g.ZodNativeEnum,...E(e)});class pt extends k{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==_.promise&&t.common.async===!1)return v(t,{code:y.invalid_type,expected:_.promise,received:t.parsedType}),x;const r=t.parsedType===_.promise?t.data:Promise.resolve(t.data);return J(r.then(s=>this._def.type.parseAsync(s,{path:t.path,errorMap:t.common.contextualErrorMap})))}}pt.create=(n,e)=>new pt({type:n,typeName:g.ZodPromise,...E(e)});class ge extends k{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===g.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:r}=this._processInputParams(e),s=this._def.effect||null,i={addIssue:a=>{v(r,a),a.fatal?t.abort():t.dirty()},get path(){return r.path}};if(i.addIssue=i.addIssue.bind(i),s.type==="preprocess"){const a=s.transform(r.data,i);return r.common.issues.length?{status:"dirty",value:r.data}:r.common.async?Promise.resolve(a).then(o=>this._def.schema._parseAsync({data:o,path:r.path,parent:r})):this._def.schema._parseSync({data:a,path:r.path,parent:r})}if(s.type==="refinement"){const a=o=>{const c=s.refinement(o,i);if(r.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(r.common.async===!1){const o=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return o.status==="aborted"?x:(o.status==="dirty"&&t.dirty(),a(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(o=>o.status==="aborted"?x:(o.status==="dirty"&&t.dirty(),a(o.value).then(()=>({status:t.value,value:o.value}))))}if(s.type==="transform")if(r.common.async===!1){const a=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!rr(a))return a;const o=s.transform(a.value,i);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(a=>rr(a)?Promise.resolve(s.transform(a.value,i)).then(o=>({status:t.value,value:o})):a);O.assertNever(s)}}ge.create=(n,e,t)=>new ge({schema:n,typeName:g.ZodEffects,effect:e,...E(t)});ge.createWithPreprocess=(n,e,t)=>new ge({schema:e,effect:{type:"preprocess",transform:n},typeName:g.ZodEffects,...E(t)});class Ae extends k{_parse(e){return this._getType(e)===_.undefined?J(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Ae.create=(n,e)=>new Ae({innerType:n,typeName:g.ZodOptional,...E(e)});class et extends k{_parse(e){return this._getType(e)===_.null?J(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}et.create=(n,e)=>new et({innerType:n,typeName:g.ZodNullable,...E(e)});class hr extends k{_parse(e){const{ctx:t}=this._processInputParams(e);let r=t.data;return t.parsedType===_.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}hr.create=(n,e)=>new hr({innerType:n,typeName:g.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...E(e)});class an extends k{_parse(e){const{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return Qr(s)?s.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new ae(r.common.issues)},input:r.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new ae(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}an.create=(n,e)=>new an({innerType:n,typeName:g.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...E(e)});class on extends k{_parse(e){if(this._getType(e)!==_.nan){const r=this._getOrReturnCtx(e);return v(r,{code:y.invalid_type,expected:_.nan,received:r.parsedType}),x}return{status:"valid",value:e.data}}}on.create=n=>new on({typeName:g.ZodNaN,...E(n)});class Lo extends k{_parse(e){const{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class vr extends k{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{const i=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return i.status==="aborted"?x:i.status==="dirty"?(t.dirty(),xo(i.value)):this._def.out._parseAsync({data:i.value,path:r.path,parent:r})})();{const s=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?x:s.status==="dirty"?(t.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:r.path,parent:r})}}static create(e,t){return new vr({in:e,out:t,typeName:g.ZodPipeline})}}class cn extends k{_parse(e){const t=this._def.innerType._parse(e);return rr(t)&&(t.value=Object.freeze(t.value)),t}}cn.create=(n,e)=>new cn({innerType:n,typeName:g.ZodReadonly,...E(e)});U.lazycreate;var g;(function(n){n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline",n.ZodReadonly="ZodReadonly"})(g||(g={}));fe.create;Xe.create;on.create;Qe.create;Yr.create;ft.create;en.create;nr.create;sr.create;tn.create;Je.create;Se.create;rn.create;oe.create;U.create;U.strictCreate;ir.create;In.create;ar.create;me.create;or.create;sn.create;Ye.create;at.create;cr.create;ur.create;Ne.create;lr.create;pt.create;ge.create;Ae.create;et.create;ge.createWithPreprocess;vr.create;function No(){return{}}function Uo(n,e){var r,s;const t={type:"array"};return((s=(r=n.type)==null?void 0:r._def)==null?void 0:s.typeName)!==g.ZodAny&&(t.items=I(n.type._def,{...e,currentPath:[...e.currentPath,"items"]})),n.minLength&&C(t,"minItems",n.minLength.value,n.minLength.message,e),n.maxLength&&C(t,"maxItems",n.maxLength.value,n.maxLength.message,e),n.exactLength&&(C(t,"minItems",n.exactLength.value,n.exactLength.message,e),C(t,"maxItems",n.exactLength.value,n.exactLength.message,e)),t}function Do(n,e){const t={type:"integer",format:"int64"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"min":e.target==="jsonSchema7"?r.inclusive?C(t,"minimum",r.value,r.message,e):C(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),C(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?C(t,"maximum",r.value,r.message,e):C(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),C(t,"maximum",r.value,r.message,e));break;case"multipleOf":C(t,"multipleOf",r.value,r.message,e);break}return t}function Mo(){return{type:"boolean"}}function Bo(n,e){return I(n.type._def,e)}const zo=(n,e)=>I(n.innerType._def,e);function qo(n,e){return e.dateStrategy=="integer"?Fo(n,e):{type:"string",format:"date-time"}}const Fo=(n,e)=>{const t={type:"integer",format:"unix-time"};for(const r of n.checks)switch(r.kind){case"min":e.target==="jsonSchema7"&&C(t,"minimum",r.value,r.message,e);break;case"max":e.target==="jsonSchema7"&&C(t,"maximum",r.value,r.message,e);break}return t};function Vo(n,e){return{...I(n.innerType._def,e),default:n.defaultValue()}}function Ho(n,e){return e.effectStrategy==="input"?I(n.schema._def,e):{}}function Zo(n){return{type:"string",enum:n.values}}const Ko=n=>"type"in n&&n.type==="string"?!1:"allOf"in n;function Jo(n,e){const t=[I(n.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),I(n.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(i=>!!i);let r=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const s=[];return t.forEach(i=>{if(Ko(i))s.push(...i.allOf),i.unevaluatedProperties===void 0&&(r=void 0);else{let a=i;if("additionalProperties"in i&&i.additionalProperties===!1){const{additionalProperties:o,...c}=i;a=c}else r=void 0;s.push(a)}}),s.length?{allOf:s,...r}:void 0}function Go(n,e){const t=typeof n.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(n.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[n.value]}:{type:t==="bigint"?"integer":t,const:n.value}}const nt={cuid:"^[cC][^\\s-]{8,}$",cuid2:"^[a-z][a-z0-9]*$",ulid:"^[0-9A-HJKMNP-TV-Z]{26}$",email:"^(?!\\.)(?!.*\\.\\.)([a-zA-Z0-9_+-\\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\\-]*\\.)+[a-zA-Z]{2,}$",emoji:"^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",uuid:"^[0-9a-fA-F]{8}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{12}$",ipv4:"^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$",ipv6:"^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$"};function di(n,e){const t={type:"string"};function r(s){return e.patternStrategy==="escape"?Wo(s):s}if(n.checks)for(const s of n.checks)switch(s.kind){case"min":C(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,s.value):s.value,s.message,e);break;case"max":C(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,s.value):s.value,s.message,e);break;case"email":switch(e.emailStrategy){case"format:email":Pe(t,"email",s.message,e);break;case"format:idn-email":Pe(t,"idn-email",s.message,e);break;case"pattern:zod":le(t,nt.email,s.message,e);break}break;case"url":Pe(t,"uri",s.message,e);break;case"uuid":Pe(t,"uuid",s.message,e);break;case"regex":le(t,s.regex.source,s.message,e);break;case"cuid":le(t,nt.cuid,s.message,e);break;case"cuid2":le(t,nt.cuid2,s.message,e);break;case"startsWith":le(t,"^"+r(s.value),s.message,e);break;case"endsWith":le(t,r(s.value)+"$",s.message,e);break;case"datetime":Pe(t,"date-time",s.message,e);break;case"length":C(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,s.value):s.value,s.message,e),C(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,s.value):s.value,s.message,e);break;case"includes":{le(t,r(s.value),s.message,e);break}case"ip":{s.version!=="v6"&&Pe(t,"ipv4",s.message,e),s.version!=="v4"&&Pe(t,"ipv6",s.message,e);break}case"emoji":le(t,nt.emoji,s.message,e);break;case"ulid":{le(t,nt.ulid,s.message,e);break}}return t}const Wo=n=>Array.from(n).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),Pe=(n,e,t,r)=>{var s;n.format||(s=n.anyOf)!=null&&s.some(i=>i.format)?(n.anyOf||(n.anyOf=[]),n.format&&(n.anyOf.push({format:n.format,...n.errorMessage&&r.errorMessages&&{errorMessage:{format:n.errorMessage.format}}}),delete n.format,n.errorMessage&&(delete n.errorMessage.format,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.anyOf.push({format:e,...t&&r.errorMessages&&{errorMessage:{format:t}}})):C(n,"format",e,t,r)},le=(n,e,t,r)=>{var s;n.pattern||(s=n.allOf)!=null&&s.some(i=>i.pattern)?(n.allOf||(n.allOf=[]),n.pattern&&(n.allOf.push({pattern:n.pattern,...n.errorMessage&&r.errorMessages&&{errorMessage:{pattern:n.errorMessage.pattern}}}),delete n.pattern,n.errorMessage&&(delete n.errorMessage.pattern,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.allOf.push({pattern:e,...t&&r.errorMessages&&{errorMessage:{pattern:t}}})):C(n,"pattern",e,t,r)};function fi(n,e){var r,s,i,a;if(e.target==="openApi3"&&((r=n.keyType)==null?void 0:r._def.typeName)===g.ZodEnum)return{type:"object",required:n.keyType._def.values,properties:n.keyType._def.values.reduce((o,c)=>({...o,[c]:I(n.valueType._def,{...e,currentPath:[...e.currentPath,"properties",c]})??{}}),{}),additionalProperties:!1};const t={type:"object",additionalProperties:I(n.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??{}};if(e.target==="openApi3")return t;if(((s=n.keyType)==null?void 0:s._def.typeName)===g.ZodString&&((i=n.keyType._def.checks)!=null&&i.length)){const o=Object.entries(di(n.keyType._def,e)).reduce((c,[u,l])=>u==="type"?c:{...c,[u]:l},{});return{...t,propertyNames:o}}else if(((a=n.keyType)==null?void 0:a._def.typeName)===g.ZodEnum)return{...t,propertyNames:{enum:n.keyType._def.values}};return t}function Xo(n,e){if(e.mapStrategy==="record")return fi(n,e);const t=I(n.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},r=I(n.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[t,r],minItems:2,maxItems:2}}}function Qo(n){const e=n.values,r=Object.keys(n.values).filter(i=>typeof e[e[i]]!="number").map(i=>e[i]),s=Array.from(new Set(r.map(i=>typeof i)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:r}}function Yo(){return{not:{}}}function ec(n){return n.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const dr={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function tc(n,e){if(e.target==="openApi3")return ss(n,e);const t=n.options instanceof Map?Array.from(n.options.values()):n.options;if(t.every(r=>r._def.typeName in dr&&(!r._def.checks||!r._def.checks.length))){const r=t.reduce((s,i)=>{const a=dr[i._def.typeName];return a&&!s.includes(a)?[...s,a]:s},[]);return{type:r.length>1?r:r[0]}}else if(t.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=t.reduce((s,i)=>{const a=typeof i._def.value;switch(a){case"string":case"number":case"boolean":return[...s,a];case"bigint":return[...s,"integer"];case"object":if(i._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(r.length===t.length){const s=r.filter((i,a,o)=>o.indexOf(i)===a);return{type:s.length>1?s:s[0],enum:t.reduce((i,a)=>i.includes(a._def.value)?i:[...i,a._def.value],[])}}}else if(t.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((r,s)=>[...r,...s._def.values.filter(i=>!r.includes(i))],[])};return ss(n,e)}const ss=(n,e)=>{const t=(n.options instanceof Map?Array.from(n.options.values()):n.options).map((r,s)=>I(r._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return t.length?{anyOf:t}:void 0};function rc(n,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(n.innerType._def.typeName)&&(!n.innerType._def.checks||!n.innerType._def.checks.length))return e.target==="openApi3"?{type:dr[n.innerType._def.typeName],nullable:!0}:{type:[dr[n.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const r=I(n.innerType._def,{...e,currentPath:[...e.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}const t=I(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function nc(n,e){const t={type:"number"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"int":t.type="integer",li(t,"type",r.message,e);break;case"min":e.target==="jsonSchema7"?r.inclusive?C(t,"minimum",r.value,r.message,e):C(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),C(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?C(t,"maximum",r.value,r.message,e):C(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),C(t,"maximum",r.value,r.message,e));break;case"multipleOf":C(t,"multipleOf",r.value,r.message,e);break}return t}function sc(n,e){const t={type:"object",...Object.entries(n.shape()).reduce((r,[s,i])=>{if(i===void 0||i._def===void 0)return r;const a=I(i._def,{...e,currentPath:[...e.currentPath,"properties",s],propertyPath:[...e.currentPath,"properties",s]});return a===void 0?r:{properties:{...r.properties,[s]:a},required:i.isOptional()?r.required:[...r.required,s]}},{properties:{},required:[]}),additionalProperties:n.catchall._def.typeName==="ZodNever"?n.unknownKeys==="passthrough":I(n.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0};return t.required.length||delete t.required,t}const ic=(n,e)=>{var r;if(e.currentPath.toString()===((r=e.propertyPath)==null?void 0:r.toString()))return I(n.innerType._def,e);const t=I(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:{}},t]}:{}},ac=(n,e)=>{if(e.pipeStrategy==="input")return I(n.in._def,e);if(e.pipeStrategy==="output")return I(n.out._def,e);const t=I(n.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),r=I(n.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,r].filter(s=>s!==void 0)}};function oc(n,e){return I(n.type._def,e)}function cc(n,e){const r={type:"array",uniqueItems:!0,items:I(n.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return n.minSize&&C(r,"minItems",n.minSize.value,n.minSize.message,e),n.maxSize&&C(r,"maxItems",n.maxSize.value,n.maxSize.message,e),r}function uc(n,e){return n.rest?{type:"array",minItems:n.items.length,items:n.items.map((t,r)=>I(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[]),additionalItems:I(n.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:n.items.length,maxItems:n.items.length,items:n.items.map((t,r)=>I(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[])}}function lc(){return{not:{}}}function hc(){return{}}const dc=(n,e)=>I(n.innerType._def,e);function I(n,e,t=!1){const r=e.seen.get(n);if(r&&!t){const a=fc(r,e);if(a!==void 0)return a}const s={def:n,path:e.currentPath,jsonSchema:void 0};e.seen.set(n,s);const i=mc(n,n.typeName,e);return i&&gc(n,e,i),s.jsonSchema=i,i}const fc=(n,e)=>{switch(e.$refStrategy){case"root":return{$ref:n.path.join("/")};case"relative":return{$ref:pc(e.currentPath,n.path)};case"none":case"seen":return n.path.length<e.currentPath.length&&n.path.every((t,r)=>e.currentPath[r]===t)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},pc=(n,e)=>{let t=0;for(;t<n.length&&t<e.length&&n[t]===e[t];t++);return[(n.length-t).toString(),...e.slice(t)].join("/")},mc=(n,e,t)=>{switch(e){case g.ZodString:return di(n,t);case g.ZodNumber:return nc(n,t);case g.ZodObject:return sc(n,t);case g.ZodBigInt:return Do(n,t);case g.ZodBoolean:return Mo();case g.ZodDate:return qo(n,t);case g.ZodUndefined:return lc();case g.ZodNull:return ec(t);case g.ZodArray:return Uo(n,t);case g.ZodUnion:case g.ZodDiscriminatedUnion:return tc(n,t);case g.ZodIntersection:return Jo(n,t);case g.ZodTuple:return uc(n,t);case g.ZodRecord:return fi(n,t);case g.ZodLiteral:return Go(n,t);case g.ZodEnum:return Zo(n);case g.ZodNativeEnum:return Qo(n);case g.ZodNullable:return rc(n,t);case g.ZodOptional:return ic(n,t);case g.ZodMap:return Xo(n,t);case g.ZodSet:return cc(n,t);case g.ZodLazy:return I(n.getter()._def,t);case g.ZodPromise:return oc(n,t);case g.ZodNaN:case g.ZodNever:return Yo();case g.ZodEffects:return Ho(n,t);case g.ZodAny:return No();case g.ZodUnknown:return hc();case g.ZodDefault:return Vo(n,t);case g.ZodBranded:return Bo(n,t);case g.ZodReadonly:return dc(n,t);case g.ZodCatch:return zo(n,t);case g.ZodPipeline:return ac(n,t);case g.ZodFunction:case g.ZodVoid:case g.ZodSymbol:return;default:return(r=>{})()}},gc=(n,e,t)=>(n.description&&(t.description=n.description,e.markdownDescription&&(t.markdownDescription=n.description)),t),yc=n=>{const e=wo(n),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:t,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([r,s])=>[s._def,{def:s._def,path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))}},_c=(n,e)=>{const t=yc(e),r=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((o,[c,u])=>({...o,[c]:I(u._def,{...t,currentPath:[...t.basePath,t.definitionPath,c]},!0)??{}}),{}):void 0,s=typeof e=="string"?e:e==null?void 0:e.name,i=I(n._def,s===void 0?t:{...t,currentPath:[...t.basePath,t.definitionPath,s]},!1)??{},a=s===void 0?r?{...i,[t.definitionPath]:r}:i:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,s].join("/"),[t.definitionPath]:{...r,[s]:i}};return t.target==="jsonSchema7"?a.$schema="http://json-schema.org/draft-07/schema#":t.target==="jsonSchema2019-09"&&(a.$schema="https://json-schema.org/draft/2019-09/schema#"),a};function bc(n){return{name:n.name,description:n.description,parameters:_c(n.schema)}}function pi(n){const{azureOpenAIApiDeploymentName:e,azureOpenAIApiInstanceName:t,azureOpenAIApiKey:r,azureOpenAIBasePath:s,baseURL:i}=n;if(r&&s&&e)return`${s}/${e}`;if(r){if(!t)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!e)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${t}.openai.azure.com/openai/deployments/${e}`}return i}var Tr={};const vc=()=>typeof window<"u"&&typeof window.document<"u",wc=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",Ec=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),mi=()=>typeof Deno<"u",xc=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!mi(),Ac=()=>{let n;return vc()?n="browser":xc()?n="node":wc()?n="webworker":Ec()?n="jsdom":mi()?n="deno":n="other",n};let Or;async function kc(){return Or===void 0&&(Or={library:"langchain-js",runtime:Ac()}),Or}function L(n){try{return typeof process<"u"?Tr==null?void 0:Tr[n]:void 0}catch{return}}const Sc=async(n,e,t,r,s,i,a,o)=>(await n.call(fetch,"https://api.promptlayer.com/track-request",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({function_name:e,provider:"langchain",kwargs:t,tags:r,request_response:s,request_start_time:Math.floor(i/1e3),request_end_time:Math.floor(a/1e3),api_key:o})})).json(),Pc="modulepreload",Tc=function(n){return"/"+n},is={},ce=function(e,t,r){let s=Promise.resolve();if(t&&t.length>0){const i=document.getElementsByTagName("link"),a=document.querySelector("meta[property=csp-nonce]"),o=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));s=Promise.all(t.map(c=>{if(c=Tc(c),c in is)return;is[c]=!0;const u=c.endsWith(".css"),l=u?'[rel="stylesheet"]':"";if(!!r)for(let f=i.length-1;f>=0;f--){const p=i[f];if(p.href===c&&(!u||p.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${c}"]${l}`))return;const d=document.createElement("link");if(d.rel=u?"stylesheet":Pc,u||(d.as="script",d.crossOrigin=""),d.href=c,o&&d.setAttribute("nonce",o),document.head.appendChild(d),u)return new Promise((f,p)=>{d.addEventListener("load",f),d.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${c}`)))})}))}return s.then(()=>e()).catch(i=>{const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=i,window.dispatchEvent(a),!a.defaultPrevented)throw i})};let St;const Oc=new Uint8Array(16);function Ic(){if(!St&&(St=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!St))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return St(Oc)}const Rc=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Cc(n){return typeof n=="string"&&Rc.test(n)}const M=[];for(let n=0;n<256;++n)M.push((n+256).toString(16).slice(1));function jc(n,e=0){return M[n[e+0]]+M[n[e+1]]+M[n[e+2]]+M[n[e+3]]+"-"+M[n[e+4]]+M[n[e+5]]+"-"+M[n[e+6]]+M[n[e+7]]+"-"+M[n[e+8]]+M[n[e+9]]+"-"+M[n[e+10]]+M[n[e+11]]+M[n[e+12]]+M[n[e+13]]+M[n[e+14]]+M[n[e+15]]}const $c=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),as={randomUUID:$c};function de(n,e,t){if(as.randomUUID&&!e&&!n)return as.randomUUID();n=n||{};const r=n.random||(n.rng||Ic)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let s=0;s<16;++s)e[t+s]=r[s];return e}return jc(r)}var Ir={};class Lc{}class bt extends Lc{get lc_namespace(){return["langchain","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,ii(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:typeof process<"u"?(Ir==null?void 0:Ir.LANGCHAIN_CALLBACKS_BACKGROUND)!=="true":!0}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever)}copy(){return new this.constructor(this)}toJSON(){return ke.prototype.toJSON.call(this)}toJSONNotImplemented(){return ke.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class t extends bt{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:de()}),Object.assign(this,e)}}return new t}}var Rn={exports:{}};Rn.exports;(function(n){const t=(i=0)=>a=>`\x1B[${38+i};5;${a}m`,r=(i=0)=>(a,o,c)=>`\x1B[${38+i};2;${a};${o};${c}m`;function s(){const i=new Map,a={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};a.color.gray=a.color.blackBright,a.bgColor.bgGray=a.bgColor.bgBlackBright,a.color.grey=a.color.blackBright,a.bgColor.bgGrey=a.bgColor.bgBlackBright;for(const[o,c]of Object.entries(a)){for(const[u,l]of Object.entries(c))a[u]={open:`\x1B[${l[0]}m`,close:`\x1B[${l[1]}m`},c[u]=a[u],i.set(l[0],l[1]);Object.defineProperty(a,o,{value:c,enumerable:!1})}return Object.defineProperty(a,"codes",{value:i,enumerable:!1}),a.color.close="\x1B[39m",a.bgColor.close="\x1B[49m",a.color.ansi256=t(),a.color.ansi16m=r(),a.bgColor.ansi256=t(10),a.bgColor.ansi16m=r(10),Object.defineProperties(a,{rgbToAnsi256:{value:(o,c,u)=>o===c&&c===u?o<8?16:o>248?231:Math.round((o-8)/247*24)+232:16+36*Math.round(o/255*5)+6*Math.round(c/255*5)+Math.round(u/255*5),enumerable:!1},hexToRgb:{value:o=>{const c=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(o.toString(16));if(!c)return[0,0,0];let{colorString:u}=c.groups;u.length===3&&(u=u.split("").map(h=>h+h).join(""));const l=Number.parseInt(u,16);return[l>>16&255,l>>8&255,l&255]},enumerable:!1},hexToAnsi256:{value:o=>a.rgbToAnsi256(...a.hexToRgb(o)),enumerable:!1}}),a}Object.defineProperty(n,"exports",{enumerable:!0,get:s})})(Rn);var Nc=Rn.exports;const gi=kn(Nc);function Rr(n,e){return n&&!Array.isArray(n)&&typeof n=="object"?n:{[e]:n}}class Cn extends bt{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}_addChildRun(e,t){e.child_runs.push(t)}_startTrace(e){if(e.parent_run_id!==void 0){const t=this.runMap.get(e.parent_run_id);t&&(this._addChildRun(t,e),t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order))}this.runMap.set(e.id,e)}async _endTrace(e){const t=e.parent_run_id!==void 0&&this.runMap.get(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id)}_getExecutionOrder(e){const t=e!==void 0&&this.runMap.get(e);return t?t.child_execution_order+1:1}async handleLLMStart(e,t,r,s,i,a,o){var d;const c=this._getExecutionOrder(s),u=Date.now(),l=o?{...i,metadata:o}:i,h={id:r,name:e.id[e.id.length-1],parent_run_id:s,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{prompts:t},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:l??{},tags:a||[]};this._startTrace(h),await((d=this.onLLMStart)==null?void 0:d.call(this,h))}async handleChatModelStart(e,t,r,s,i,a,o){var d;const c=this._getExecutionOrder(s),u=Date.now(),l=o?{...i,metadata:o}:i,h={id:r,name:e.id[e.id.length-1],parent_run_id:s,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{messages:t},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:l??{},tags:a||[]};this._startTrace(h),await((d=this.onLLMStart)==null?void 0:d.call(this,h))}async handleLLMEnd(e,t){var s;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="llm")throw new Error("No LLM run to end.");r.end_time=Date.now(),r.outputs=e,r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((s=this.onLLMEnd)==null?void 0:s.call(this,r)),await this._endTrace(r)}async handleLLMError(e,t){var s;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="llm")throw new Error("No LLM run to end.");r.end_time=Date.now(),r.error=e.message,r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((s=this.onLLMError)==null?void 0:s.call(this,r)),await this._endTrace(r)}async handleChainStart(e,t,r,s,i,a,o){var h;const c=this._getExecutionOrder(s),u=Date.now(),l={id:r,name:e.id[e.id.length-1],parent_run_id:s,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:t,execution_order:c,child_execution_order:c,run_type:o??"chain",child_runs:[],extra:a?{metadata:a}:{},tags:i||[]};this._startTrace(l),await((h=this.onChainStart)==null?void 0:h.call(this,l))}async handleChainEnd(e,t,r,s,i){var o;const a=this.runMap.get(t);if(!a)throw new Error("No chain run to end.");a.end_time=Date.now(),a.outputs=Rr(e,"output"),a.events.push({name:"end",time:new Date(a.end_time).toISOString()}),(i==null?void 0:i.inputs)!==void 0&&(a.inputs=Rr(i.inputs,"input")),await((o=this.onChainEnd)==null?void 0:o.call(this,a)),await this._endTrace(a)}async handleChainError(e,t,r,s,i){var o;const a=this.runMap.get(t);if(!a)throw new Error("No chain run to end.");a.end_time=Date.now(),a.error=e.message,a.events.push({name:"error",time:new Date(a.end_time).toISOString()}),(i==null?void 0:i.inputs)!==void 0&&(a.inputs=Rr(i.inputs,"input")),await((o=this.onChainError)==null?void 0:o.call(this,a)),await this._endTrace(a)}async handleToolStart(e,t,r,s,i,a){var l;const o=this._getExecutionOrder(s),c=Date.now(),u={id:r,name:e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{input:t},execution_order:o,child_execution_order:o,run_type:"tool",child_runs:[],extra:a?{metadata:a}:{},tags:i||[]};this._startTrace(u),await((l=this.onToolStart)==null?void 0:l.call(this,u))}async handleToolEnd(e,t){var s;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="tool")throw new Error("No tool run to end");r.end_time=Date.now(),r.outputs={output:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((s=this.onToolEnd)==null?void 0:s.call(this,r)),await this._endTrace(r)}async handleToolError(e,t){var s;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="tool")throw new Error("No tool run to end");r.end_time=Date.now(),r.error=e.message,r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((s=this.onToolError)==null?void 0:s.call(this,r)),await this._endTrace(r)}async handleAgentAction(e,t){var i;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="chain")return;const s=r;s.actions=s.actions||[],s.actions.push(e),s.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await((i=this.onAgentAction)==null?void 0:i.call(this,r))}async handleAgentEnd(e,t){var s;const r=this.runMap.get(t);!r||(r==null?void 0:r.run_type)!=="chain"||(r.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await((s=this.onAgentEnd)==null?void 0:s.call(this,r)))}async handleRetrieverStart(e,t,r,s,i,a){var l;const o=this._getExecutionOrder(s),c=Date.now(),u={id:r,name:e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{query:t},execution_order:o,child_execution_order:o,run_type:"retriever",child_runs:[],extra:a?{metadata:a}:{},tags:i||[]};this._startTrace(u),await((l=this.onRetrieverStart)==null?void 0:l.call(this,u))}async handleRetrieverEnd(e,t){var s;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="retriever")throw new Error("No retriever run to end");r.end_time=Date.now(),r.outputs={documents:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((s=this.onRetrieverEnd)==null?void 0:s.call(this,r)),await this._endTrace(r)}async handleRetrieverError(e,t){var s;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="retriever")throw new Error("No retriever run to end");r.end_time=Date.now(),r.error=e.message,r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((s=this.onRetrieverError)==null?void 0:s.call(this,r)),await this._endTrace(r)}async handleText(e,t){var s;const r=this.runMap.get(t);!r||(r==null?void 0:r.run_type)!=="chain"||(r.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await((s=this.onText)==null?void 0:s.call(this,r)))}async handleLLMNewToken(e,t,r,s,i,a){var c;const o=this.runMap.get(r);!o||(o==null?void 0:o.run_type)!=="llm"||(o.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:a==null?void 0:a.chunk}}),await((c=this.onLLMNewToken)==null?void 0:c.call(this,o)))}}function V(n,e){return`${n.open}${e}${n.close}`}function te(n,e){try{return JSON.stringify(n,null,2)}catch{return e}}function _e(n){if(!n.end_time)return"";const e=n.end_time-n.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}const{color:K}=gi;class os extends Cn{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){const t=[];let r=e;for(;r.parent_run_id;){const s=this.runMap.get(r.parent_run_id);if(s)t.push(s),r=s;else break}return t}getBreadcrumbs(e){const r=[...this.getParents(e).reverse(),e].map((s,i,a)=>{const o=`${s.execution_order}:${s.run_type}:${s.name}`;return i===a.length-1?V(gi.bold,o):o}).join(" > ");return V(K.grey,r)}onChainStart(e){const t=this.getBreadcrumbs(e);console.log(`${V(K.green,"[chain/start]")} [${t}] Entering Chain run with input: ${te(e.inputs,"[inputs]")}`)}onChainEnd(e){const t=this.getBreadcrumbs(e);console.log(`${V(K.cyan,"[chain/end]")} [${t}] [${_e(e)}] Exiting Chain run with output: ${te(e.outputs,"[outputs]")}`)}onChainError(e){const t=this.getBreadcrumbs(e);console.log(`${V(K.red,"[chain/error]")} [${t}] [${_e(e)}] Chain run errored with error: ${te(e.error,"[error]")}`)}onLLMStart(e){const t=this.getBreadcrumbs(e),r="prompts"in e.inputs?{prompts:e.inputs.prompts.map(s=>s.trim())}:e.inputs;console.log(`${V(K.green,"[llm/start]")} [${t}] Entering LLM run with input: ${te(r,"[inputs]")}`)}onLLMEnd(e){const t=this.getBreadcrumbs(e);console.log(`${V(K.cyan,"[llm/end]")} [${t}] [${_e(e)}] Exiting LLM run with output: ${te(e.outputs,"[response]")}`)}onLLMError(e){const t=this.getBreadcrumbs(e);console.log(`${V(K.red,"[llm/error]")} [${t}] [${_e(e)}] LLM run errored with error: ${te(e.error,"[error]")}`)}onToolStart(e){var r;const t=this.getBreadcrumbs(e);console.log(`${V(K.green,"[tool/start]")} [${t}] Entering Tool run with input: "${(r=e.inputs.input)==null?void 0:r.trim()}"`)}onToolEnd(e){var r,s;const t=this.getBreadcrumbs(e);console.log(`${V(K.cyan,"[tool/end]")} [${t}] [${_e(e)}] Exiting Tool run with output: "${(s=(r=e.outputs)==null?void 0:r.output)==null?void 0:s.trim()}"`)}onToolError(e){const t=this.getBreadcrumbs(e);console.log(`${V(K.red,"[tool/error]")} [${t}] [${_e(e)}] Tool run errored with error: ${te(e.error,"[error]")}`)}onRetrieverStart(e){const t=this.getBreadcrumbs(e);console.log(`${V(K.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${te(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const t=this.getBreadcrumbs(e);console.log(`${V(K.cyan,"[retriever/end]")} [${t}] [${_e(e)}] Exiting Retriever run with output: ${te(e.outputs,"[outputs]")}`)}onRetrieverError(e){const t=this.getBreadcrumbs(e);console.log(`${V(K.red,"[retriever/error]")} [${t}] [${_e(e)}] Retriever run errored with error: ${te(e.error,"[error]")}`)}onAgentAction(e){const t=e,r=this.getBreadcrumbs(e);console.log(`${V(K.blue,"[agent/action]")} [${r}] Agent selected action: ${te(t.actions[t.actions.length-1],"[action]")}`)}}const Uc=[400,401,403,404,405,406,407,408],Dc=[409];class Mc{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6;const t="default"in pe?pe.default:pe;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>Gt(()=>e(...t).catch(r=>{throw r instanceof Error?r:new Error(r)}),{onFailedAttempt(r){var i;if(r.message.startsWith("Cancel")||r.message.startsWith("TimeoutError")||r.message.startsWith("AbortError")||(r==null?void 0:r.code)==="ECONNABORTED")throw r;const s=(i=r==null?void 0:r.response)==null?void 0:i.status;if(s){if(Uc.includes(+s))throw r;if(Dc.includes(+s))return}},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((s,i)=>{var a;(a=e.signal)==null||a.addEventListener("abort",()=>{i(new Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}}function cs(n){return typeof(n==null?void 0:n._getType)=="function"}function us(n){const e={type:n._getType(),data:{content:n.content}};return n!=null&&n.additional_kwargs&&Object.keys(n.additional_kwargs).length>0&&(e.data.additional_kwargs={...n.additional_kwargs}),e}var ot={};let he;const Bc=()=>typeof window<"u"&&typeof window.document<"u",zc=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",qc=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),yi=()=>typeof Deno<"u",Fc=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!yi(),Vc=()=>he||(Bc()?he="browser":Fc()?he="node":zc()?he="webworker":qc()?he="jsdom":yi()?he="deno":he="other",he);let Cr;async function Hc(){if(Cr===void 0){const n=Vc(),e=Jc();Cr={library:"langsmith",runtime:n,sdk:"langsmith-js",sdk_version:_i,...e}}return Cr}function Zc(){const n=Kc()||{},e={},t=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION"];for(const[r,s]of Object.entries(n))r.startsWith("LANGCHAIN_")&&typeof s=="string"&&!t.includes(r)&&!r.toLowerCase().includes("key")&&!r.toLowerCase().includes("secret")&&!r.toLowerCase().includes("token")&&(r==="LANGCHAIN_REVISION_ID"?e.revision_id=s:e[r]=s);return e}function Kc(){try{return typeof process<"u"&&ot?Object.entries(ot).reduce((n,[e,t])=>(n[e]=String(t),n),{}):void 0}catch{return}}function Ce(n){try{return typeof process<"u"?ot==null?void 0:ot[n]:void 0}catch{return}}let jr;function Jc(){if(jr!==void 0)return jr;const n=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(const t of n){const r=Ce(t);r!==void 0&&(e[t]=r)}return jr=e,e}async function ls(n){const e=await Hc(),t=Zc();return n.map(r=>{const s=r.extra??{},i=s.metadata;return r.extra={...s,runtime:{...e,...s==null?void 0:s.runtime},metadata:{...t,...t.revision_id||r.revision_id?{revision_id:r.revision_id??t.revision_id}:{},...i}},r})}const Gc=()=>{const n=Ce("LANGCHAIN_TRACING_SAMPLING_RATE");if(n===void 0)return;const e=parseFloat(n);if(e<0||e>1)throw new Error(`LANGCHAIN_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${e}`);return e},hs=n=>{const t=n.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return t==="localhost"||t==="127.0.0.1"||t==="::1"},be=async(n,e)=>{const t=await n.text();if(!n.ok)throw new Error(`Failed to ${e}: ${n.status} ${n.statusText} ${t}`)};async function Wc(n){const e=[];for await(const t of n)e.push(t);return e}function $r(n){if(n!==void 0)return n.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}function N(n){if(!Cc(n))throw new Error(`Invalid UUID: ${n}`)}class jn{constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sampledPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"batchEndpointSupported",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pendingAutoBatchedRuns",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"pendingAutoBatchedRunLimit",{enumerable:!0,configurable:!0,writable:!0,value:100}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchInitialDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:50});const t=jn.getDefaultClientConfig();this.tracingSampleRate=Gc(),this.apiUrl=$r(e.apiUrl??t.apiUrl)??"",this.apiKey=$r(e.apiKey??t.apiKey),this.webUrl=$r(e.webUrl??t.webUrl),this.validateApiKeyIfHosted(),this.timeout_ms=e.timeout_ms??12e3,this.caller=new Mc(e.callerOptions??{}),this.hideInputs=e.hideInputs??t.hideInputs,this.hideOutputs=e.hideOutputs??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.pendingAutoBatchedRunLimit=e.pendingAutoBatchedRunLimit??this.pendingAutoBatchedRunLimit}static getDefaultClientConfig(){const e=Ce("LANGCHAIN_API_KEY"),t=Ce("LANGCHAIN_ENDPOINT")??"https://api.smith.langchain.com",r=Ce("LANGCHAIN_HIDE_INPUTS")==="true",s=Ce("LANGCHAIN_HIDE_OUTPUTS")==="true";return{apiUrl:t,apiKey:e,webUrl:void 0,hideInputs:r,hideOutputs:s}}validateApiKeyIfHosted(){if(!hs(this.apiUrl)&&!this.apiKey)throw new Error("API key must be provided when using hosted LangSmith API")}getHostUrl(){return this.webUrl?this.webUrl:hs(this.apiUrl)?(this.webUrl="http://localhost","http://localhost"):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com","https://dev.smith.langchain.com"):(this.webUrl="https://smith.langchain.com","https://smith.langchain.com")}get headers(){const e={"User-Agent":`langsmith-js/${_i}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}processInputs(e){return this.hideInputs?{}:e}processOutputs(e){return this.hideOutputs?{}:e}prepareRunCreateOrUpdateInputs(e){const t={...e};return t.inputs!==void 0&&(t.inputs=this.processInputs(t.inputs)),t.outputs!==void 0&&(t.outputs=this.processOutputs(t.outputs)),t}async _getResponse(e,t){const r=(t==null?void 0:t.toString())??"",s=`${this.apiUrl}${e}?${r}`,i=await this.caller.call(fetch,s,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!i.ok)throw new Error(`Failed to fetch ${e}: ${i.status} ${i.statusText}`);return i}async _get(e,t){return(await this._getResponse(e,t)).json()}async*_getPaginated(e,t=new URLSearchParams){let r=Number(t.get("offset"))||0;const s=Number(t.get("limit"))||100;for(;;){t.set("offset",String(r)),t.set("limit",String(s));const i=`${this.apiUrl}${e}?${t}`,a=await this.caller.call(fetch,i,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!a.ok)throw new Error(`Failed to fetch ${e}: ${a.status} ${a.statusText}`);const o=await a.json();if(o.length===0||(yield o,o.length<s))break;r+=o.length}}async*_getCursorPaginatedList(e,t=null,r="POST",s="runs"){const i=t?{...t}:{};for(;;){const o=await(await this.caller.call(fetch,`${this.apiUrl}${e}`,{method:r,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),body:JSON.stringify(i)})).json();if(!o||!o[s])break;yield o[s];const c=o.cursors;if(!c||!c.next)break;i.cursor=c.next}}_filterForSampling(e,t=!1){if(this.tracingSampleRate===void 0)return e;if(t){const r=[];for(const s of e)this.sampledPostUuids.has(s.id)&&(r.push(s),this.sampledPostUuids.delete(s.id));return r}else{const r=[];for(const s of e)Math.random()<this.tracingSampleRate&&(r.push(s),this.sampledPostUuids.add(s.id));return r}}async triggerAutoBatchSend(e){let t=e;t===void 0&&(t=this.pendingAutoBatchedRuns.slice(0,this.pendingAutoBatchedRunLimit),this.pendingAutoBatchedRuns=this.pendingAutoBatchedRuns.slice(this.pendingAutoBatchedRunLimit)),await this.batchIngestRuns({runCreates:t.filter(r=>r.action==="create").map(r=>r.item),runUpdates:t.filter(r=>r.action==="update").map(r=>r.item)})}appendRunCreateToAutoBatchQueue(e){const t=this.autoBatchTimeout;for(clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,this.pendingAutoBatchedRuns.push(e);this.pendingAutoBatchedRuns.length>=this.pendingAutoBatchedRunLimit;){const r=this.pendingAutoBatchedRuns.slice(0,this.pendingAutoBatchedRunLimit);this.pendingAutoBatchedRuns=this.pendingAutoBatchedRuns.slice(this.pendingAutoBatchedRunLimit),this.triggerAutoBatchSend(r)}this.pendingAutoBatchedRuns.length>0&&(t?this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.triggerAutoBatchSend()},this.autoBatchAggregationDelayMs):this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.triggerAutoBatchSend()},this.autoBatchInitialDelayMs))}async batchEndpointIsSupported(){const e=await fetch(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms)});return e.ok?!0:(await e.text(),!1)}async createRun(e){if(!this._filterForSampling([e]).length)return;const t={...this.headers,"Content-Type":"application/json"},r=e.project_name;delete e.project_name;const s=this.prepareRunCreateOrUpdateInputs({session_name:r,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&s.trace_id!==void 0&&s.dotted_order!==void 0){this.appendRunCreateToAutoBatchQueue({action:"create",item:s});return}const i=await ls([s]),a=await this.caller.call(fetch,`${this.apiUrl}/runs`,{method:"POST",headers:t,body:JSON.stringify(i[0]),signal:AbortSignal.timeout(this.timeout_ms)});await be(a,"create run")}async batchIngestRuns({runCreates:e,runUpdates:t}){if(e===void 0&&t===void 0)return;let r=(e==null?void 0:e.map(c=>this.prepareRunCreateOrUpdateInputs(c)))??[],s=(t==null?void 0:t.map(c=>this.prepareRunCreateOrUpdateInputs(c)))??[];if(r.length>0&&s.length>0){const c=r.reduce((l,h)=>(h.id&&(l[h.id]=h),l),{}),u=[];for(const l of s)l.id!==void 0&&c[l.id]?c[l.id]={...c[l.id],...l}:u.push(l);r=Object.values(c),s=u}const i={post:this._filterForSampling(r),patch:this._filterForSampling(s,!0)};if(!i.post.length&&!i.patch.length)return;if(r=await ls(r),this.batchEndpointSupported===void 0&&(this.batchEndpointSupported=await this.batchEndpointIsSupported()),!this.batchEndpointSupported){this.autoBatchTracing=!1;for(const c of i.post)await this.createRun(c);for(const c of i.patch)c.id!==void 0&&await this.updateRun(c.id,c);return}const a={...this.headers,"Content-Type":"application/json",Accept:"application/json"},o=await this.caller.call(fetch,`${this.apiUrl}/runs/batch`,{method:"POST",headers:a,body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms)});await be(o,"batch create run")}async updateRun(e,t){N(e),t.inputs&&(t.inputs=this.processInputs(t.inputs)),t.outputs&&(t.outputs=this.processOutputs(t.outputs));const r={...t,id:e};if(!this._filterForSampling([r],!0).length)return;if(this.autoBatchTracing&&r.trace_id!==void 0&&r.dotted_order!==void 0){this.appendRunCreateToAutoBatchQueue({action:"update",item:r});return}const s={...this.headers,"Content-Type":"application/json"},i=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:s,body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms)});await be(i,"update run")}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){N(e);let r=await this._get(`/runs/${e}`);return t&&r.child_run_ids&&(r=await this._loadChildRuns(r)),r}async getRunUrl({runId:e,run:t,projectOpts:r}){if(t!==void 0){let s;t.session_id?s=t.session_id:r!=null&&r.projectName?s=(await this.readProject({projectName:r==null?void 0:r.projectName})).id:r!=null&&r.projectId?s=r==null?void 0:r.projectId:s=(await this.readProject({projectName:Ce("LANGCHAIN_PROJECT")||"default"})).id;const i=await this._getTenantId();return`${this.getHostUrl()}/o/${i}/projects/p/${s}/r/${t.id}?poll=true`}else if(e!==void 0){const s=await this.readRun(e);if(!s.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${s.app_path}`}else throw new Error("Must provide either runId or run")}async _loadChildRuns(e){const t=await Wc(this.listRuns({id:e.child_run_ids})),r={},s={};t.sort((i,a)=>((i==null?void 0:i.dotted_order)??"").localeCompare((a==null?void 0:a.dotted_order)??""));for(const i of t){if(i.parent_run_id===null||i.parent_run_id===void 0)throw new Error(`Child run ${i.id} has no parent`);i.parent_run_id in r||(r[i.parent_run_id]=[]),r[i.parent_run_id].push(i),s[i.id]=i}e.child_runs=r[e.id]||[];for(const i in r)i!==e.id&&(s[i].child_runs=r[i]);return e}async*listRuns({projectId:e,projectName:t,parentRunId:r,traceId:s,referenceExampleId:i,startTime:a,executionOrder:o,runType:c,error:u,id:l,query:h,filter:d,limit:f}){let p=[];if(e&&(p=Array.isArray(e)?e:[e]),t){const m=Array.isArray(t)?t:[t],S=await Promise.all(m.map(R=>this.readProject({projectName:R}).then(A=>A.id)));p.push(...S)}const b={session:p.length?p:null,run_type:c,reference_example:i,query:h,filter:d,execution_order:o,parent_run:r?[r]:null,start_time:a?a.toISOString():null,error:u,id:l,limit:f,trace:s};for await(const m of this._getCursorPaginatedList("/runs/query",b))yield*m}async shareRun(e,{shareId:t}={}){const r={run_id:e,share_token:t||de()};N(e);const i=await(await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms)})).json();if(i===null||!("share_token"in i))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${i.share_token}/r`}async unshareRun(e){N(e);const t=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});await be(t,"unshare run")}async readRunSharedLink(e){N(e);const r=await(await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)})).json();if(!(r===null||!("share_token"in r)))return`${this.getHostUrl()}/public/${r.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){const r=new URLSearchParams({share_token:e});if(t!==void 0)for(const a of t)r.append("id",a);return N(e),await(await this.caller.call(fetch,`${this.apiUrl}/public/${e}/runs${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)})).json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),N(e);const s=await(await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)})).json();return s.url=`${this.getHostUrl()}/public/${s.share_token}/d`,s}async shareDataset(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);const r={dataset_id:e};N(e);const i=await(await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms)})).json();return i.url=`${this.getHostUrl()}/public/${i.share_token}/d`,i}async unshareDataset(e){N(e);const t=await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});await be(t,"unshare dataset")}async readSharedDataset(e){return N(e),await(await this.caller.call(fetch,`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)})).json()}async createProject({projectName:e,description:t=null,metadata:r=null,upsert:s=!1,projectExtra:i=null,referenceDatasetId:a=null}){const o=s?"?upsert=true":"",c=`${this.apiUrl}/sessions${o}`,u=i||{};r&&(u.metadata=r);const l={name:e,extra:u,description:t};a!==null&&(l.reference_dataset_id=a);const h=await this.caller.call(fetch,c,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms)}),d=await h.json();if(!h.ok)throw new Error(`Failed to create session ${e}: ${h.status} ${h.statusText}`);return d}async updateProject(e,{name:t=null,description:r=null,metadata:s=null,projectExtra:i=null,endTime:a=null}){const o=`${this.apiUrl}/sessions/${e}`;let c=i;s&&(c={...c||{},metadata:s});const u={name:t,extra:c,description:r,end_time:a?new Date(a).toISOString():null},l=await this.caller.call(fetch,o,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms)}),h=await l.json();if(!l.ok)throw new Error(`Failed to update project ${e}: ${l.status} ${l.statusText}`);return h}async hasProject({projectId:e,projectName:t}){let r="/sessions";const s=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)N(e),r+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide projectName or projectId");const i=await this.caller.call(fetch,`${this.apiUrl}${r}?${s}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});try{const a=await i.json();return i.ok?Array.isArray(a)?a.length>0:!0:!1}catch{return!1}}async readProject({projectId:e,projectName:t,includeStats:r}){let s="/sessions";const i=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)N(e),s+=`/${e}`;else if(t!==void 0)i.append("name",t);else throw new Error("Must provide projectName or projectId");r!==void 0&&i.append("include_stats",r.toString());const a=await this._get(s,i);let o;if(Array.isArray(a)){if(a.length===0)throw new Error(`Project[id=${e}, name=${t}] not found`);o=a[0]}else o=a;return o}async _getTenantId(){if(this._tenantId!==null)return this._tenantId;const e=new URLSearchParams({limit:"1"});for await(const t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:t,nameContains:r,referenceDatasetId:s,referenceDatasetName:i,referenceFree:a}={}){const o=new URLSearchParams;if(e!==void 0)for(const c of e)o.append("id",c);if(t!==void 0&&o.append("name",t),r!==void 0&&o.append("name_contains",r),s!==void 0)o.append("reference_dataset",s);else if(i!==void 0){const c=await this.readDataset({datasetName:i});o.append("reference_dataset",c.id)}a!==void 0&&o.append("reference_free",a.toString());for await(const c of this._getPaginated("/sessions",o))yield*c}async deleteProject({projectId:e,projectName:t}){let r;if(e===void 0&&t===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?r=(await this.readProject({projectName:t})).id:r=e,N(r);const s=await this.caller.call(fetch,`${this.apiUrl}/sessions/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});await be(s,`delete session ${r} (${t})`)}async uploadCsv({csvFile:e,fileName:t,inputKeys:r,outputKeys:s,description:i,dataType:a,name:o}){const c=`${this.apiUrl}/datasets/upload`,u=new FormData;u.append("file",e,t),r.forEach(d=>{u.append("input_keys",d)}),s.forEach(d=>{u.append("output_keys",d)}),i&&u.append("description",i),a&&u.append("data_type",a),o&&u.append("name",o);const l=await this.caller.call(fetch,c,{method:"POST",headers:this.headers,body:u,signal:AbortSignal.timeout(this.timeout_ms)});if(!l.ok){const d=await l.json();throw d.detail&&d.detail.includes("already exists")?new Error(`Dataset ${t} already exists`):new Error(`Failed to upload CSV: ${l.status} ${l.statusText}`)}return await l.json()}async createDataset(e,{description:t,dataType:r}={}){const s={name:e,description:t};r&&(s.data_type=r);const i=await this.caller.call(fetch,`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms)});if(!i.ok){const o=await i.json();throw o.detail&&o.detail.includes("already exists")?new Error(`Dataset ${e} already exists`):new Error(`Failed to create dataset ${i.status} ${i.statusText}`)}return await i.json()}async readDataset({datasetId:e,datasetName:t}){let r="/datasets";const s=new URLSearchParams({limit:"1"});if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)N(e),r+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide datasetName or datasetId");const i=await this._get(r,s);let a;if(Array.isArray(i)){if(i.length===0)throw new Error(`Dataset[id=${e}, name=${t}] not found`);a=i[0]}else a=i;return a}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){const r="/datasets";if(e===void 0)if(t!==void 0)e=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide datasetName or datasetId");return(await(await this._getResponse(`${r}/${e}/openai_ft`)).text()).trim().split(`
`).map(o=>JSON.parse(o))}async*listDatasets({limit:e=100,offset:t=0,datasetIds:r,datasetName:s,datasetNameContains:i}={}){const a="/datasets",o=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(r!==void 0)for(const c of r)o.append("id",c);s!==void 0&&o.append("name",s),i!==void 0&&o.append("name_contains",i);for await(const c of this._getPaginated(a,o))yield*c}async deleteDataset({datasetId:e,datasetName:t}){let r="/datasets",s=e;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(t!==void 0&&(s=(await this.readDataset({datasetName:t})).id),s!==void 0)N(s),r+=`/${s}`;else throw new Error("Must provide datasetName or datasetId");const i=await this.caller.call(fetch,this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!i.ok)throw new Error(`Failed to delete ${r}: ${i.status} ${i.statusText}`);await i.json()}async createExample(e,t,{datasetId:r,datasetName:s,createdAt:i,exampleId:a}){let o=r;if(o===void 0&&s===void 0)throw new Error("Must provide either datasetName or datasetId");if(o!==void 0&&s!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");o===void 0&&(o=(await this.readDataset({datasetName:s})).id);const c=i||new Date,u={dataset_id:o,inputs:e,outputs:t,created_at:c==null?void 0:c.toISOString(),id:a},l=await this.caller.call(fetch,`${this.apiUrl}/examples`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms)});if(!l.ok)throw new Error(`Failed to create example: ${l.status} ${l.statusText}`);return await l.json()}async createExamples(e){const{inputs:t,outputs:r,sourceRunIds:s,exampleIds:i,datasetId:a,datasetName:o}=e;let c=a;if(c===void 0&&o===void 0)throw new Error("Must provide either datasetName or datasetId");if(c!==void 0&&o!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");c===void 0&&(c=(await this.readDataset({datasetName:o})).id);const u=t.map((d,f)=>({dataset_id:c,inputs:d,outputs:r?r[f]:void 0,id:i?i[f]:void 0,source_run_id:s?s[f]:void 0})),l=await this.caller.call(fetch,`${this.apiUrl}/examples/bulk`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms)});if(!l.ok)throw new Error(`Failed to create examples: ${l.status} ${l.statusText}`);return await l.json()}async createLLMExample(e,t,r){return this.createExample({input:e},{output:t},r)}async createChatExample(e,t,r){const s=e.map(a=>cs(a)?us(a):a),i=cs(t)?us(t):t;return this.createExample({input:s},{output:i},r)}async readExample(e){N(e);const t=`/examples/${e}`;return await this._get(t)}async*listExamples({datasetId:e,datasetName:t,exampleIds:r}={}){let s;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)s=e;else if(t!==void 0)s=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide a datasetName or datasetId");const i=new URLSearchParams({dataset:s});if(r!==void 0)for(const a of r)i.append("id",a);for await(const a of this._getPaginated("/examples",i))yield*a}async deleteExample(e){N(e);const t=`/examples/${e}`,r=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!r.ok)throw new Error(`Failed to delete ${t}: ${r.status} ${r.statusText}`);await r.json()}async updateExample(e,t){N(e);const r=await this.caller.call(fetch,`${this.apiUrl}/examples/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms)});if(!r.ok)throw new Error(`Failed to update example ${e}: ${r.status} ${r.statusText}`);return await r.json()}async evaluateRun(e,t,{sourceInfo:r,loadChildRuns:s,referenceExample:i}={loadChildRuns:!1}){let a;if(typeof e=="string")a=await this.readRun(e,{loadChildRuns:s});else if(typeof e=="object"&&"id"in e)a=e;else throw new Error(`Invalid run type: ${typeof e}`);a.reference_example_id!==null&&a.reference_example_id!==void 0&&(i=await this.readExample(a.reference_example_id));const o=await t.evaluateRun(a,i);let c=r??{};o.evaluatorInfo&&(c={...c,...o.evaluatorInfo});const u=o.targetRunId??a.id;return await this.createFeedback(u,o.key,{score:o==null?void 0:o.score,value:o==null?void 0:o.value,comment:o==null?void 0:o.comment,correction:o==null?void 0:o.correction,sourceInfo:c,feedbackSourceType:"model",sourceRunId:o==null?void 0:o.sourceRunId})}async createFeedback(e,t,{score:r,value:s,correction:i,comment:a,sourceInfo:o,feedbackSourceType:c="api",sourceRunId:u,feedbackId:l,eager:h=!1}){var m;const d={type:c??"api",metadata:o??{}};u!==void 0&&(d==null?void 0:d.metadata)!==void 0&&!d.metadata.__run&&(d.metadata.__run={run_id:u}),(d==null?void 0:d.metadata)!==void 0&&((m=d.metadata.__run)==null?void 0:m.run_id)!==void 0&&N(d.metadata.__run.run_id);const f={id:l??de(),run_id:e,key:t,score:r,value:s,correction:i,comment:a,feedback_source:d},p=`${this.apiUrl}/feedback`+(h?"/eager":""),b=await this.caller.call(fetch,p,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(f),signal:AbortSignal.timeout(this.timeout_ms)});return await be(b,"create feedback"),f}async updateFeedback(e,{score:t,value:r,correction:s,comment:i}){const a={};t!=null&&(a.score=t),r!=null&&(a.value=r),s!=null&&(a.correction=s),i!=null&&(a.comment=i),N(e);const o=await this.caller.call(fetch,`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms)});await be(o,"update feedback")}async readFeedback(e){N(e);const t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){N(e);const t=`/feedback/${e}`,r=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!r.ok)throw new Error(`Failed to delete ${t}: ${r.status} ${r.statusText}`);await r.json()}async*listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:r}={}){const s=new URLSearchParams;if(e&&s.append("run",e.join(",")),t)for(const i of t)s.append("key",i);if(r)for(const i of r)s.append("source",i);for await(const i of this._getPaginated("/feedback",s))yield*i}}const _i="0.0.70";class Xc extends Cn{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{exampleId:t,projectName:r,client:s}=e;this.projectName=r??L("LANGCHAIN_PROJECT")??L("LANGCHAIN_SESSION"),this.exampleId=t,this.client=s??new jn({})}async _convertToCreate(e,t=void 0){return{...e,extra:{...e.extra,runtime:await kc()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:t}}async persistRun(e){}async _persistRunSingle(e){const t=await this._convertToCreate(e,this.exampleId);await this.client.createRun(t)}async _updateRunSingle(e){const t={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs};await this.client.updateRun(e.id,t)}async onRetrieverStart(e){await this._persistRunSingle(e)}async onRetrieverEnd(e){await this._updateRunSingle(e)}async onRetrieverError(e){await this._updateRunSingle(e)}async onLLMStart(e){await this._persistRunSingle(e)}async onLLMEnd(e){await this._updateRunSingle(e)}async onLLMError(e){await this._updateRunSingle(e)}async onChainStart(e){await this._persistRunSingle(e)}async onChainEnd(e){await this._updateRunSingle(e)}async onChainError(e){await this._updateRunSingle(e)}async onToolStart(e){await this._persistRunSingle(e)}async onToolEnd(e){await this._updateRunSingle(e)}async onToolError(e){await this._updateRunSingle(e)}}function bi(n,e="Human",t="AI"){const r=[];for(const s of n){let i;if(s._getType()==="human")i=e;else if(s._getType()==="ai")i=t;else if(s._getType()==="system")i="System";else if(s._getType()==="function")i="Function";else if(s._getType()==="generic")i=s.role;else throw new Error(`Got unsupported message type: ${s}`);const a=s.name?`${s.name}, `:"";r.push(`${i}: ${a}${s.content}`)}return r.join(`
`)}class Qc extends Cn{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"endpoint",{enumerable:!0,configurable:!0,writable:!0,value:L("LANGCHAIN_ENDPOINT")||"http://localhost:1984"}),Object.defineProperty(this,"headers",{enumerable:!0,configurable:!0,writable:!0,value:{"Content-Type":"application/json"}}),Object.defineProperty(this,"session",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const e=L("LANGCHAIN_API_KEY");e&&(this.headers["x-api-key"]=e)}async newSession(e){const t={start_time:Date.now(),name:e},r=await this.persistSession(t);return this.session=r,r}async loadSession(e){const t=`${this.endpoint}/sessions?name=${e}`;return this._handleSessionResponse(t)}async loadDefaultSession(){const e=`${this.endpoint}/sessions?name=default`;return this._handleSessionResponse(e)}async convertV2RunToRun(e){var i;const t=this.session??await this.loadDefaultSession(),r=e.serialized;let s;if(e.run_type==="llm"){const a=e.inputs.prompts?e.inputs.prompts:e.inputs.messages.map(c=>bi(c));s={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:r,type:e.run_type,session_id:t.id,prompts:a,response:e.outputs}}else if(e.run_type==="chain"){const a=await Promise.all(e.child_runs.map(c=>this.convertV2RunToRun(c)));s={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:r,type:e.run_type,session_id:t.id,inputs:e.inputs,outputs:e.outputs,child_llm_runs:a.filter(c=>c.type==="llm"),child_chain_runs:a.filter(c=>c.type==="chain"),child_tool_runs:a.filter(c=>c.type==="tool")}}else if(e.run_type==="tool"){const a=await Promise.all(e.child_runs.map(c=>this.convertV2RunToRun(c)));s={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:r,type:e.run_type,session_id:t.id,tool_input:e.inputs.input,output:(i=e.outputs)==null?void 0:i.output,action:JSON.stringify(r),child_llm_runs:a.filter(c=>c.type==="llm"),child_chain_runs:a.filter(c=>c.type==="chain"),child_tool_runs:a.filter(c=>c.type==="tool")}}else throw new Error(`Unknown run type: ${e.run_type}`);return s}async persistRun(e){let t,r;e.run_type!==void 0?r=await this.convertV2RunToRun(e):r=e,r.type==="llm"?t=`${this.endpoint}/llm-runs`:r.type==="chain"?t=`${this.endpoint}/chain-runs`:t=`${this.endpoint}/tool-runs`;const s=await fetch(t,{method:"POST",headers:this.headers,body:JSON.stringify(r)});s.ok||console.error(`Failed to persist run: ${s.status} ${s.statusText}`)}async persistSession(e){const t=`${this.endpoint}/sessions`,r=await fetch(t,{method:"POST",headers:this.headers,body:JSON.stringify(e)});return r.ok?{id:(await r.json()).id,...e}:(console.error(`Failed to persist session: ${r.status} ${r.statusText}, using default session.`),{id:1,...e})}async _handleSessionResponse(e){const t=await fetch(e,{method:"GET",headers:this.headers});let r;if(!t.ok)return console.error(`Failed to load session: ${t.status} ${t.statusText}`),r={id:1,start_time:Date.now()},this.session=r,r;const s=await t.json();return s.length===0?(r={id:1,start_time:Date.now()},this.session=r,r):([r]=s,this.session=r,r)}}async function Yc(n){const e=new Qc;return n?await e.loadSession(n):await e.loadDefaultSession(),e}async function eu(){return new Xc}let Lr;function tu(){const n="default"in pe?pe.default:pe;return new n({autoStart:!0,concurrency:1})}async function B(n,e){e===!0?await n():(typeof Lr>"u"&&(Lr=tu()),Lr.add(n))}function ru(n){return n?Array.isArray(n)||"name"in n?{callbacks:n}:n:{}}class nu{setHandler(e){return this.setHandlers([e])}}class wr{constructor(e,t,r,s,i,a,o,c){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:c})}async handleText(e){await Promise.all(this.handlers.map(t=>B(async()=>{var r;try{await((r=t.handleText)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleText: ${s}`)}},t.awaitHandlers)))}}class su extends wr{getChild(e){const t=new W(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(t=>B(async()=>{var r;if(!t.ignoreRetriever)try{await((r=t.handleRetrieverEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch{console.error(`Error in handler ${t.constructor.name}, handleRetriever`)}},t.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(t=>B(async()=>{var r;if(!t.ignoreRetriever)try{await((r=t.handleRetrieverError)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleRetrieverError: ${s}`)}},t.awaitHandlers)))}}class ds extends wr{async handleLLMNewToken(e,t,r,s,i,a){await Promise.all(this.handlers.map(o=>B(async()=>{var c;if(!o.ignoreLLM)try{await((c=o.handleLLMNewToken)==null?void 0:c.call(o,e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,a))}catch(u){console.error(`Error in handler ${o.constructor.name}, handleLLMNewToken: ${u}`)}},o.awaitHandlers)))}async handleLLMError(e){await Promise.all(this.handlers.map(t=>B(async()=>{var r;if(!t.ignoreLLM)try{await((r=t.handleLLMError)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleLLMError: ${s}`)}},t.awaitHandlers)))}async handleLLMEnd(e){await Promise.all(this.handlers.map(t=>B(async()=>{var r;if(!t.ignoreLLM)try{await((r=t.handleLLMEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleLLMEnd: ${s}`)}},t.awaitHandlers)))}}class iu extends wr{getChild(e){const t=new W(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,r,s,i){await Promise.all(this.handlers.map(a=>B(async()=>{var o;if(!a.ignoreChain)try{await((o=a.handleChainError)==null?void 0:o.call(a,e,this.runId,this._parentRunId,this.tags,i))}catch(c){console.error(`Error in handler ${a.constructor.name}, handleChainError: ${c}`)}},a.awaitHandlers)))}async handleChainEnd(e,t,r,s,i){await Promise.all(this.handlers.map(a=>B(async()=>{var o;if(!a.ignoreChain)try{await((o=a.handleChainEnd)==null?void 0:o.call(a,e,this.runId,this._parentRunId,this.tags,i))}catch(c){console.error(`Error in handler ${a.constructor.name}, handleChainEnd: ${c}`)}},a.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(t=>B(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleAgentAction)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleAgentAction: ${s}`)}},t.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(t=>B(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleAgentEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleAgentEnd: ${s}`)}},t.awaitHandlers)))}}class au extends wr{getChild(e){const t=new W(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map(t=>B(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleToolError)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleToolError: ${s}`)}},t.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(t=>B(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleToolEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${t.constructor.name}, handleToolEnd: ${s}`)}},t.awaitHandlers)))}}class W extends nu{constructor(e){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=[],this.inheritableHandlers=[],this._parentRunId=e}async handleLLMStart(e,t,r=void 0,s=void 0,i=void 0){return Promise.all(t.map(async a=>{const o=de();return await Promise.all(this.handlers.map(c=>B(async()=>{var u;if(!c.ignoreLLM)try{await((u=c.handleLLMStart)==null?void 0:u.call(c,e,[a],o,this._parentRunId,i,this.tags,this.metadata))}catch(l){console.error(`Error in handler ${c.constructor.name}, handleLLMStart: ${l}`)}},c.awaitHandlers))),new ds(o,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,t,r=void 0,s=void 0,i=void 0){return Promise.all(t.map(async a=>{const o=de();return await Promise.all(this.handlers.map(c=>B(async()=>{var u,l;if(!c.ignoreLLM)try{if(c.handleChatModelStart)await((u=c.handleChatModelStart)==null?void 0:u.call(c,e,[a],o,this._parentRunId,i,this.tags,this.metadata));else if(c.handleLLMStart){const h=bi(a);await((l=c.handleLLMStart)==null?void 0:l.call(c,e,[h],o,this._parentRunId,i,this.tags,this.metadata))}}catch(h){console.error(`Error in handler ${c.constructor.name}, handleLLMStart: ${h}`)}},c.awaitHandlers))),new ds(o,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,t,r=de(),s=void 0){return await Promise.all(this.handlers.map(i=>B(async()=>{var a;if(!i.ignoreChain)try{await((a=i.handleChainStart)==null?void 0:a.call(i,e,t,r,this._parentRunId,this.tags,this.metadata,s))}catch(o){console.error(`Error in handler ${i.constructor.name}, handleChainStart: ${o}`)}},i.awaitHandlers))),new iu(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,r=de()){return await Promise.all(this.handlers.map(s=>B(async()=>{var i;if(!s.ignoreAgent)try{await((i=s.handleToolStart)==null?void 0:i.call(s,e,t,r,this._parentRunId,this.tags,this.metadata))}catch(a){console.error(`Error in handler ${s.constructor.name}, handleToolStart: ${a}`)}},s.awaitHandlers))),new au(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,r=de(),s=void 0){return await Promise.all(this.handlers.map(i=>B(async()=>{var a;if(!i.ignoreRetriever)try{await((a=i.handleRetrieverStart)==null?void 0:a.call(i,e,t,r,this._parentRunId,this.tags,this.metadata))}catch(o){console.error(`Error in handler ${i.constructor.name}, handleRetrieverStart: ${o}`)}},i.awaitHandlers))),new su(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(const r of e)this.addHandler(r,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(const t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){const r=new W(this._parentRunId);for(const s of this.handlers){const i=this.inheritableHandlers.includes(s);r.addHandler(s,i)}for(const s of this.tags){const i=this.inheritableTags.includes(s);r.addTags([s],i)}for(const s of Object.keys(this.metadata)){const i=Object.keys(this.inheritableMetadata).includes(s);r.addMetadata({[s]:this.metadata[s]},i)}for(const s of e)r.handlers.filter(i=>i.name==="console_callback_handler").some(i=>i.name===s.name)||r.addHandler(s,t);return r}static fromHandlers(e){class t extends bt{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:de()}),Object.assign(this,e)}}const r=new this;return r.addHandler(new t),r}static async configure(e,t,r,s,i,a,o){let c;(e||t)&&(Array.isArray(e)||!e?(c=new W,c.setHandlers((e==null?void 0:e.map(fs))??[],!0)):c=e,c=c.copy(Array.isArray(t)?t.map(fs):t==null?void 0:t.handlers,!1));const u=L("LANGCHAIN_VERBOSE")||(o==null?void 0:o.verbose),l=L("LANGCHAIN_TRACING_V2")==="true",h=l||(L("LANGCHAIN_TRACING")??!1);if(u||h){if(c||(c=new W),u&&!c.handlers.some(d=>d.name===os.prototype.name)){const d=new os;c.addHandler(d,!0)}if(h&&!c.handlers.some(d=>d.name==="langchain_tracer"))if(l)c.addHandler(await eu(),!0);else{const d=L("LANGCHAIN_PROJECT")&&L("LANGCHAIN_SESSION");c.addHandler(await Yc(d),!0)}}return(r||s)&&c&&(c.addTags(r??[]),c.addTags(s??[],!1)),(i||a)&&c&&(c.addMetadata(i??{}),c.addMetadata(a??{},!1)),c}}function fs(n){return"name"in n?n:bt.fromMethods(n)}class fr extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const e=await this.reader.read();return e.done&&this.reader.releaseLock(),e}catch(e){throw this.reader.releaseLock(),e}}async return(){this.ensureReader();const e=this.reader.cancel();return this.reader.releaseLock(),await e,{done:!0,value:void 0}}[Symbol.asyncIterator](){return this}static fromReadableStream(e){const t=e.getReader();return new fr({start(r){return s();function s(){return t.read().then(({done:i,value:a})=>{if(i){r.close();return}return r.enqueue(a),s()})}}})}static fromAsyncGenerator(e){return new fr({async pull(t){const{value:r,done:s}=await e.next();s?t.close():r&&t.enqueue(r)}})}}async function Le(n){return W.configure(n==null?void 0:n.callbacks,void 0,n==null?void 0:n.tags,void 0,n==null?void 0:n.metadata)}function F(n,e){return n&&!Array.isArray(n)&&typeof n=="object"?n:{[e]:n}}class z extends ke{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}bind(e){return new vt({bound:this,kwargs:e})}map(){return new $n({bound:this})}withRetry(e){return new ou({bound:this,kwargs:{},maxAttemptNumber:e==null?void 0:e.stopAfterAttempt,...e})}withFallbacks(e){return new lu({runnable:this,fallbacks:e.fallbacks})}_getOptionsList(e,t=0){if(Array.isArray(e)){if(e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);return e}return Array.from({length:t},()=>e)}async batch(e,t,r){const s=this._getOptionsList(t??{},e.length),i=new br({maxConcurrency:r==null?void 0:r.maxConcurrency,onFailedAttempt:o=>{throw o}}),a=e.map((o,c)=>i.call(async()=>{try{return await this.invoke(o,s[c])}catch(u){if(r!=null&&r.returnExceptions)return u;throw u}}));return Promise.all(a)}async*_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){return fr.fromAsyncGenerator(this._streamIterator(e,t))}_separateRunnableConfigFromCallOptions(e={}){const t={callbacks:e.callbacks,tags:e.tags,metadata:e.metadata},r={...e};return delete r.callbacks,delete r.tags,delete r.metadata,[t,r]}async _callWithConfig(e,t,r){const s=await Le(r),i=await(s==null?void 0:s.handleChainStart(this.toJSON(),F(t,"input"),void 0,r==null?void 0:r.runType));let a;try{a=await e.bind(this)(t,r,i)}catch(o){throw await(i==null?void 0:i.handleChainError(o)),o}return await(i==null?void 0:i.handleChainEnd(F(a,"output"))),a}async _batchWithConfig(e,t,r,s){const i=this._getOptionsList(r??{},t.length),a=await Promise.all(i.map(Le)),o=await Promise.all(a.map((u,l)=>u==null?void 0:u.handleChainStart(this.toJSON(),F(t[l],"input"))));let c;try{c=await e(t,i,o,s)}catch(u){throw await Promise.all(o.map(l=>l==null?void 0:l.handleChainError(u))),u}return await Promise.all(o.map(u=>u==null?void 0:u.handleChainEnd(F(c,"output")))),c}async*_transformStreamWithConfig(e,t,r){let s,i=!0,a,o=!0;const c=await Le(r);let u;const l=this.toJSON();async function*h(){for await(const f of e){if(u||(u=await(c==null?void 0:c.handleChainStart(l,{input:""},void 0,r==null?void 0:r.runType))),i)if(s===void 0)s=f;else try{s=s.concat(f)}catch{s=void 0,i=!1}yield f}}const d=h();try{const f=t(d,u,r);for await(const p of f)if(yield p,o)if(a===void 0)a=p;else try{a=a.concat(p)}catch{a=void 0,o=!1}}catch(f){throw await(u==null?void 0:u.handleChainError(f,void 0,void 0,void 0,{inputs:F(s,"input")})),f}await(u==null?void 0:u.handleChainEnd(a??{},void 0,void 0,void 0,{inputs:F(s,"input")}))}_patchConfig(e={},t=void 0){return{...e,callbacks:t}}pipe(e){return new Ee({first:this,last:$e(e)})}async*transform(e,t){let r;for await(const s of e)r?r=r.concat(s):r=s;yield*this._streamIterator(r,t)}static isRunnable(e){return e.lc_runnable}}class vt extends z{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","schema","runnable"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs}bind(e){return new vt({bound:this.bound,kwargs:{...this.kwargs,...e}})}async invoke(e,t){return this.bound.invoke(e,{...t,...this.kwargs})}async batch(e,t,r){const s=Array.isArray(t)?t.map(i=>({...i,...this.kwargs})):{...t,...this.kwargs};return this.bound.batch(e,s,r)}async*_streamIterator(e,t){yield*this.bound._streamIterator(e,{...t,...this.kwargs})}async stream(e,t){return this.bound.stream(e,{...t,...this.kwargs})}async*transform(e,t){yield*this.bound.transform(e,t)}static isRunnableBinding(e){return e.bound&&z.isRunnable(e.bound)}}class $n extends z{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","schema","runnable"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new $n({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _invoke(e,t,r){return this.bound.batch(e,this._patchConfig(t,r==null?void 0:r.getChild()))}}class ou extends vt{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","schema","runnable"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,r){const s=e>1?`retry:attempt:${e}`:void 0;return this._patchConfig(t,r==null?void 0:r.getChild(s))}async _invoke(e,t,r){return Gt(s=>super.invoke(e,this._patchConfigForRetry(s,t,r)),{onFailedAttempt:this.onFailedAttempt,retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _batch(e,t,r,s){const i={};try{await Gt(async a=>{const o=e.map((d,f)=>f).filter(d=>i[d.toString()]===void 0||i[d.toString()]instanceof Error),c=o.map(d=>e[d]),u=o.map(d=>this._patchConfigForRetry(a,t==null?void 0:t[d],r==null?void 0:r[d])),l=await super.batch(c,u,{...s,returnExceptions:!0});let h;for(let d=0;d<l.length;d+=1){const f=l[d],p=o[d];f instanceof Error&&h===void 0&&(h=f),i[p.toString()]=f}if(h)throw h;return l},{onFailedAttempt:this.onFailedAttempt,retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(a){if((s==null?void 0:s.returnExceptions)!==!0)throw a}return Object.keys(i).sort((a,o)=>parseInt(a,10)-parseInt(o,10)).map(a=>i[parseInt(a,10)])}async batch(e,t,r){return this._batchWithConfig(this._batch.bind(this),e,t,r)}}class Ee extends z{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","schema","runnable"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){const r=await Le(t),s=await(r==null?void 0:r.handleChainStart(this.toJSON(),F(e,"input")));let i=e,a;try{const o=[this.first,...this.middle];for(let c=0;c<o.length;c+=1)i=await o[c].invoke(i,this._patchConfig(t,s==null?void 0:s.getChild(`seq:step:${c+1}`)));a=await this.last.invoke(i,this._patchConfig(t,s==null?void 0:s.getChild(`seq:step:${this.steps.length}`)))}catch(o){throw await(s==null?void 0:s.handleChainError(o)),o}return await(s==null?void 0:s.handleChainEnd(F(a,"output"))),a}async batch(e,t,r){const s=this._getOptionsList(t??{},e.length),i=await Promise.all(s.map(Le)),a=await Promise.all(i.map((u,l)=>u==null?void 0:u.handleChainStart(this.toJSON(),F(e[l],"input"))));let o=e,c;try{const u=[this.first,...this.middle];for(let l=0;l<u.length;l+=1)o=await u[l].batch(o,a.map((d,f)=>this._patchConfig(s[f],d==null?void 0:d.getChild(`seq:step:${l+1}`))),r);c=await this.last.batch(o,a.map(l=>this._patchConfig(s[this.steps.length-1],l==null?void 0:l.getChild(`seq:step:${this.steps.length}`))),r)}catch(u){throw await Promise.all(a.map(l=>l==null?void 0:l.handleChainError(u))),u}return await Promise.all(a.map((u,l)=>u==null?void 0:u.handleChainEnd(F(c[l],"output")))),c}async*_streamIterator(e,t){const r=await Le(t),s=await(r==null?void 0:r.handleChainStart(this.toJSON(),F(e,"input")));let i=e;const a=[this.first,...this.middle,this.last],o=Math.min(a.length-1,a.length-[...a].reverse().findIndex(l=>{var f;const h=l.transform===z.prototype.transform,d=vt.isRunnableBinding(l)&&((f=l.bound)==null?void 0:f.transform)===z.prototype.transform;return h||d})-1);try{const l=a.slice(0,o);for(let h=0;h<l.length;h+=1)i=await l[h].invoke(i,this._patchConfig(t,s==null?void 0:s.getChild(`seq:step:${h+1}`)))}catch(l){throw await(s==null?void 0:s.handleChainError(l)),l}let c=!0,u;try{let l=await a[o]._streamIterator(i,this._patchConfig(t,s==null?void 0:s.getChild(`seq:step:${o+1}`)));const h=a.slice(o+1);for(let d=0;d<h.length;d+=1)l=await h[d].transform(l,this._patchConfig(t,s==null?void 0:s.getChild(`seq:step:${o+d+2}`)));for await(const d of l)if(yield d,c)if(u===void 0)u=d;else try{u=u.concat(d)}catch{u=void 0,c=!1}}catch(l){throw await(s==null?void 0:s.handleChainError(l)),l}await(s==null?void 0:s.handleChainEnd(F(u,"output")))}pipe(e){return Ee.isRunnableSequence(e)?new Ee({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last}):new Ee({first:this.first,middle:[...this.middle,this.last],last:$e(e)})}static isRunnableSequence(e){return Array.isArray(e.middle)&&z.isRunnable(e)}static from([e,...t]){return new Ee({first:$e(e),middle:t.slice(0,-1).map($e),last:$e(t[t.length-1])})}}class cu extends z{static lc_name(){return"RunnableMap"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","schema","runnable"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(const[t,r]of Object.entries(e.steps))this.steps[t]=$e(r)}async invoke(e,t){const r=await Le(t),s=await(r==null?void 0:r.handleChainStart(this.toJSON(),{input:e})),i={};try{for(const[a,o]of Object.entries(this.steps)){const c=await o.invoke(e,this._patchConfig(t,s==null?void 0:s.getChild()));i[a]=c}}catch(a){throw await(s==null?void 0:s.handleChainError(a)),a}return await(s==null?void 0:s.handleChainEnd(i)),i}}class uu extends z{static lc_name(){return"RunnableLambda"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","schema","runnable"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.func=e.func}async _invoke(e,t,r){let s=await this.func(e);return s&&z.isRunnable(s)&&(s=await s.invoke(e,this._patchConfig(t,r==null?void 0:r.getChild()))),s}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}}class lu extends z{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","schema","runnable"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(const e of this.fallbacks)yield e}async invoke(e,t){const r=await W.configure(t==null?void 0:t.callbacks,void 0,t==null?void 0:t.tags,void 0,t==null?void 0:t.metadata),s=await(r==null?void 0:r.handleChainStart(this.toJSON(),F(e,"input")));let i;for(const a of this.runnables())try{const o=await a.invoke(e,this._patchConfig(t,s==null?void 0:s.getChild()));return await(s==null?void 0:s.handleChainEnd(F(o,"output"))),o}catch(o){i===void 0&&(i=o)}throw i===void 0?new Error("No error stored at end of fallback."):(await(s==null?void 0:s.handleChainError(i)),i)}async batch(e,t,r){if(r!=null&&r.returnExceptions)throw new Error("Not implemented.");const s=this._getOptionsList(t??{},e.length),i=await Promise.all(s.map(c=>W.configure(c==null?void 0:c.callbacks,void 0,c==null?void 0:c.tags,void 0,c==null?void 0:c.metadata))),a=await Promise.all(i.map((c,u)=>c==null?void 0:c.handleChainStart(this.toJSON(),F(e[u],"input"))));let o;for(const c of this.runnables())try{const u=await c.batch(e,a.map((l,h)=>this._patchConfig(s[h],l==null?void 0:l.getChild())),r);return await Promise.all(a.map((l,h)=>l==null?void 0:l.handleChainEnd(F(u[h],"output")))),u}catch(u){o===void 0&&(o=u)}throw o?(await Promise.all(a.map(c=>c==null?void 0:c.handleChainError(o))),o):new Error("No error stored at end of fallbacks.")}}function $e(n){if(typeof n=="function")return new uu({func:n});if(z.isRunnable(n))return n;if(!Array.isArray(n)&&typeof n=="object"){const e={};for(const[t,r]of Object.entries(n))e[t]=$e(r);return new cu({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}class hu extends z{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","schema","runnable"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"RunnablePassthrough"}async invoke(e,t){return this._callWithConfig(r=>Promise.resolve(r),e,t)}}class vi extends ui{constructor(e){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","prompts","base"]}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new dt(this.value)]}}class du extends z{get lc_attributes(){return{partialVariables:void 0}}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","prompts",this._getPromptType()]}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partialVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{inputVariables:t}=e;if(t.includes("stop"))throw new Error("Cannot have an input variable named 'stop', as it is used internally, please rename.");Object.assign(this,e)}async mergePartialAndUserVariables(e){const t=this.partialVariables??{},r={};for(const[i,a]of Object.entries(t))typeof a=="string"?r[i]=a:r[i]=await a();return{...r,...e}}async invoke(e,t){return this._callWithConfig(r=>this.formatPromptValue(r),e,{...t,runType:"prompt"})}serialize(){throw new Error("Use .toJSON() instead")}static async deserialize(e){switch(e._type){case"prompt":{const{PromptTemplate:t}=await ce(()=>Promise.resolve().then(()=>ps),void 0);return t.deserialize(e)}case void 0:{const{PromptTemplate:t}=await ce(()=>Promise.resolve().then(()=>ps),void 0);return t.deserialize({...e,_type:"prompt"})}case"few_shot":{const{FewShotPromptTemplate:t}=await ce(()=>import("./few_shot-BGauc9i4.js"),__vite__mapDeps([]));return t.deserialize(e)}default:throw new Error(`Invalid prompt type in config: ${e._type}`)}}}class fu extends du{async formatPromptValue(e){const t=await this.format(e);return new vi(t)}}const wi=n=>{const e=n.split(""),t=[],r=(i,a)=>{for(let o=a;o<e.length;o+=1)if(i.includes(e[o]))return o;return-1};let s=0;for(;s<e.length;)if(e[s]==="{"&&s+1<e.length&&e[s+1]==="{")t.push({type:"literal",text:"{"}),s+=2;else if(e[s]==="}"&&s+1<e.length&&e[s+1]==="}")t.push({type:"literal",text:"}"}),s+=2;else if(e[s]==="{"){const i=r("}",s);if(i<0)throw new Error("Unclosed '{' in template.");t.push({type:"variable",name:e.slice(s+1,i).join("")}),s=i+1}else{if(e[s]==="}")throw new Error("Single '}' in template.");{const i=r("{}",s),a=(i<0?e.slice(s):e.slice(s,i)).join("");t.push({type:"literal",text:a}),s=i<0?e.length:i}}return t},pu=(n,e)=>wi(n).reduce((t,r)=>{if(r.type==="variable"){if(r.name in e)return t+e[r.name];throw new Error(`Missing value for input ${r.name}`)}return t+r.text},""),un={"f-string":pu,jinja2:(n,e)=>""},mu={"f-string":wi,jinja2:n=>[]},Ei=(n,e,t)=>un[e](n,t),gu=(n,e)=>mu[e](n),yu=(n,e,t)=>{if(!(e in un)){const r=Object.keys(un);throw new Error(`Invalid template format. Got \`${e}\`;
                         should be one of ${r}`)}try{const r=t.reduce((s,i)=>(s[i]="foo",s),{});Ei(n,e,r)}catch(r){throw new Error(`Invalid prompt schema: ${r.message}`)}};class xe extends fu{static lc_name(){return"PromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),this.validateTemplate){let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),yu(this.template,this.templateFormat,t)}}_getPromptType(){return"prompt"}async format(e){const t=await this.mergePartialAndUserVariables(e);return Ei(this.template,this.templateFormat,t)}static fromExamples(e,t,r,s=`

`,i=""){const a=[i,...e,t].join(s);return new xe({inputVariables:r,template:a})}static fromTemplate(e,{templateFormat:t="f-string",...r}={}){if(t==="jinja2")throw new Error("jinja2 templates are not currently supported.");const s=new Set;return gu(e,t).forEach(i=>{i.type==="variable"&&s.add(i.name)}),new xe({inputVariables:[...s],templateFormat:t,template:e,...r})}async partial(e){const t=this.inputVariables.filter(i=>!(i in e)),r={...this.partialVariables??{},...e},s={...this,inputVariables:t,partialVariables:r};return new xe(s)}serialize(){if(this.outputParser!==void 0)throw new Error("Cannot serialize a prompt template with an output parser");return{_type:this._getPromptType(),input_variables:this.inputVariables,template:this.template,template_format:this.templateFormat}}static async deserialize(e){if(!e.template)throw new Error("Prompt template must have a template");return new xe({inputVariables:e.input_variables,template:e.template,templateFormat:e.template_format})}}const ps=Object.freeze(Object.defineProperty({__proto__:null,PromptTemplate:xe},Symbol.toStringTag,{value:"Module"}));class _u extends ui{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return JSON.stringify(this.messages)}toChatMessages(){return this.messages}}const bu=()=>!1;class vu extends z{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??bu(),this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}}class wu extends vu{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:t,...r}){super({callbacks:e??t,...r}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.caller=new br(r??{})}async getNumTokens(e){let t=Math.ceil(e.length/4);if(!this._encoding)try{this._encoding=await ao("modelName"in this?Jr(this.modelName):"gpt2")}catch(r){console.warn("Failed to calculate number of tokens, falling back to approximate count",r)}return this._encoding&&(t=this._encoding.encode(e).length),t}static _convertInputToPromptValue(e){return typeof e=="string"?new vi(e):Array.isArray(e)?new _u(e.map(Gr)):e}_identifyingParams(){return{}}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){const{_type:t,_model:r,...s}=e;if(r&&r!=="base_chat_model")throw new Error(`Cannot load LLM with model ${r}`);const i={openai:(await ce(()=>Promise.resolve().then(()=>Su),void 0)).ChatOpenAI}[t];if(i===void 0)throw new Error(`Cannot load LLM with type ${t}`);return new i(s)}}class ct extends wu{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]})}_separateRunnableConfigFromCallOptions(e){const[t,r]=super._separateRunnableConfigFromCallOptions(e);return r!=null&&r.timeout&&!r.signal&&(r.signal=AbortSignal.timeout(r.timeout)),[t,r]}async invoke(e,t){const r=ct._convertInputToPromptValue(e);return(await this.generatePrompt([r],t,t==null?void 0:t.callbacks)).generations[0][0].message}async*_streamResponseChunks(e,t,r){throw new Error("Not implemented.")}async*_streamIterator(e,t){if(this._streamResponseChunks===ct.prototype._streamResponseChunks)yield this.invoke(e,t);else{const s=ct._convertInputToPromptValue(e).toChatMessages(),[i,a]=this._separateRunnableConfigFromCallOptions(t),o=await W.configure(i.callbacks,this.callbacks,i.tags,this.tags,i.metadata,this.metadata,{verbose:this.verbose}),c={options:a,invocation_params:this==null?void 0:this.invocationParams(a)},u=await(o==null?void 0:o.handleChatModelStart(this.toJSON(),[s],void 0,void 0,c));let l;try{for await(const h of this._streamResponseChunks(s,a,u==null?void 0:u[0]))yield h.message,l?l=l.concat(h):l=h}catch(h){throw await Promise.all((u??[]).map(d=>d==null?void 0:d.handleLLMError(h))),h}await Promise.all((u??[]).map(h=>h==null?void 0:h.handleLLMEnd({generations:[[l]]})))}}async generate(e,t,r){var b;let s;Array.isArray(t)?s={stop:t}:s=t;const i=e.map(m=>m.map(Gr)),[a,o]=this._separateRunnableConfigFromCallOptions(s),c=await W.configure(a.callbacks??r,this.callbacks,a.tags,this.tags,a.metadata,this.metadata,{verbose:this.verbose}),u={options:o,invocation_params:this==null?void 0:this.invocationParams(s)},l=await(c==null?void 0:c.handleChatModelStart(this.toJSON(),i,void 0,void 0,u)),h=await Promise.allSettled(i.map((m,S)=>this._generate(m,{...o,promptIndex:S},l==null?void 0:l[S]))),d=[],f=[];await Promise.all(h.map(async(m,S)=>{var R,A;if(m.status==="fulfilled"){const j=m.value;return d[S]=j.generations,f[S]=j.llmOutput,(R=l==null?void 0:l[S])==null?void 0:R.handleLLMEnd({generations:[j.generations],llmOutput:j.llmOutput})}else return await((A=l==null?void 0:l[S])==null?void 0:A.handleLLMError(m.reason)),Promise.reject(m.reason)}));const p={generations:d,llmOutput:f.length?(b=this._combineLLMOutput)==null?void 0:b.call(this,...f):void 0};return Object.defineProperty(p,bo,{value:l?{runIds:l==null?void 0:l.map(m=>m.runId)}:void 0,configurable:!0}),p}invocationParams(e){return{}}_modelType(){return"base_chat_model"}async generatePrompt(e,t,r){const s=e.map(i=>i.toChatMessages());return this.generate(s,t,r)}async call(e,t,r){return(await this.generate([e.map(Gr)],t,r)).generations[0][0].message}async callPrompt(e,t,r){const s=e.toChatMessages();return this.call(s,t,r)}async predictMessages(e,t,r){return this.call(e,t,r)}async predict(e,t,r){const s=new dt(e);return(await this.call([s],t,r)).content}}function xi(n){let e;return n.constructor.name===wa.name?(e=new Error(n.message),e.name="TimeoutError"):n.constructor.name===Ea.name?(e=new Error(n.message),e.name="AbortError"):e=n,e}var Nr={};function Eu(n){return n.role!=="system"&&n.role!=="assistant"&&n.role!=="user"&&n.role!=="function"&&console.warn(`Unknown message role: ${n.role}`),n.role}function Rt(n){const e=n._getType();switch(e){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"generic":{if(!ci.isInstance(n))throw new Error("Invalid generic chat message");return Eu(n)}default:throw new Error(`Unknown message type: ${e}`)}}function xu(n){switch(n.role){case"user":return new dt(n.content||"");case"assistant":return new ai(n.content||"",{function_call:n.function_call});case"system":return new oi(n.content||"");default:return new ci(n.content||"",n.role??"unknown")}}function Au(n,e){const t=n.role??e,r=n.content??"";let s;return n.function_call?s={function_call:n.function_call}:s={},t==="user"?new Wt({content:r}):t==="assistant"?new Xt({content:r,additional_kwargs:s}):t==="system"?new Qt({content:r}):t==="function"?new Yt({content:r,additional_kwargs:s,name:n.name}):new er({content:r,role:t})}class Ln extends ct{static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","promptIndex"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",azureOpenAIApiKey:"AZURE_OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",azureOpenAIApiVersion:"azure_openai_api_version",azureOpenAIApiKey:"azure_openai_api_key",azureOpenAIApiInstanceName:"azure_openai_api_instance_name",azureOpenAIApiDeploymentName:"azure_openai_api_deployment_name"}}constructor(e,t){var r,s,i,a,o,c,u,l;if(super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=(e==null?void 0:e.openAIApiKey)??L("OPENAI_API_KEY"),this.azureOpenAIApiKey=(e==null?void 0:e.azureOpenAIApiKey)??L("AZURE_OPENAI_API_KEY"),!this.azureOpenAIApiKey&&!this.openAIApiKey)throw new Error("OpenAI or Azure OpenAI API key not found");if(this.azureOpenAIApiInstanceName=(e==null?void 0:e.azureOpenAIApiInstanceName)??L("AZURE_OPENAI_API_INSTANCE_NAME"),this.azureOpenAIApiDeploymentName=(e==null?void 0:e.azureOpenAIApiDeploymentName)??L("AZURE_OPENAI_API_DEPLOYMENT_NAME"),this.azureOpenAIApiVersion=(e==null?void 0:e.azureOpenAIApiVersion)??L("AZURE_OPENAI_API_VERSION"),this.azureOpenAIBasePath=(e==null?void 0:e.azureOpenAIBasePath)??L("AZURE_OPENAI_BASE_PATH"),this.organization=((r=e==null?void 0:e.configuration)==null?void 0:r.organization)??L("OPENAI_ORGANIZATION"),this.modelName=(e==null?void 0:e.modelName)??this.modelName,this.modelKwargs=(e==null?void 0:e.modelKwargs)??{},this.timeout=e==null?void 0:e.timeout,this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.topP=(e==null?void 0:e.topP)??this.topP,this.frequencyPenalty=(e==null?void 0:e.frequencyPenalty)??this.frequencyPenalty,this.presencePenalty=(e==null?void 0:e.presencePenalty)??this.presencePenalty,this.maxTokens=e==null?void 0:e.maxTokens,this.n=(e==null?void 0:e.n)??this.n,this.logitBias=e==null?void 0:e.logitBias,this.stop=e==null?void 0:e.stop,this.user=e==null?void 0:e.user,this.streaming=(e==null?void 0:e.streaming)??!1,this.azureOpenAIApiKey){if(!this.azureOpenAIApiInstanceName&&!this.azureOpenAIBasePath)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found");this.openAIApiKey=this.openAIApiKey??""}this.clientConfig={apiKey:this.openAIApiKey,organization:this.organization,baseURL:(t==null?void 0:t.basePath)??((s=e==null?void 0:e.configuration)==null?void 0:s.basePath),dangerouslyAllowBrowser:!0,defaultHeaders:((i=t==null?void 0:t.baseOptions)==null?void 0:i.headers)??((o=(a=e==null?void 0:e.configuration)==null?void 0:a.baseOptions)==null?void 0:o.headers),defaultQuery:((c=t==null?void 0:t.baseOptions)==null?void 0:c.params)??((l=(u=e==null?void 0:e.configuration)==null?void 0:u.baseOptions)==null?void 0:l.params),...t,...e==null?void 0:e.configuration}}invocationParams(e){return{model:this.modelName,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,max_tokens:this.maxTokens===-1?void 0:this.maxTokens,n:this.n,logit_bias:this.logitBias,stop:(e==null?void 0:e.stop)??this.stop,user:this.user,stream:this.streaming,functions:(e==null?void 0:e.functions)??(e!=null&&e.tools?e==null?void 0:e.tools.map(bc):void 0),function_call:e==null?void 0:e.function_call,...this.modelKwargs}}_identifyingParams(){return{model_name:this.modelName,...this.invocationParams(),...this.clientConfig}}async*_streamResponseChunks(e,t,r){var c;const s=e.map(u=>({role:Rt(u),content:u.content,name:u.name,function_call:u.additional_kwargs.function_call})),i={...this.invocationParams(t),messages:s,stream:!0};let a;const o=await this.completionWithRetry(i,t);for await(const u of o){const l=u==null?void 0:u.choices[0];if(!l)continue;const{delta:h}=l,d=Au(h,a);a=h.role??a;const f={prompt:t.promptIndex??0,completion:l.index??0},p=new On({message:d,text:d.content,generationInfo:f});yield p,r==null||r.handleLLMNewToken(p.text??"",f,void 0,void 0,void 0,{chunk:p})}if((c=t.signal)!=null&&c.aborted)throw new Error("AbortError")}identifyingParams(){return this._identifyingParams()}async _generate(e,t,r){var o,c;const s={},i=this.invocationParams(t),a=e.map(u=>({role:Rt(u),content:u.content,name:u.name,function_call:u.additional_kwargs.function_call}));if(i.stream){const u=await this._streamResponseChunks(e,t,r),l={};for await(const d of u){const f=((o=d.generationInfo)==null?void 0:o.completion)??0;l[f]===void 0?l[f]=d:l[f]=l[f].concat(d)}return{generations:Object.entries(l).sort(([d],[f])=>parseInt(d,10)-parseInt(f,10)).map(([d,f])=>f)}}else{const u=await this.completionWithRetry({...i,stream:!1,messages:a},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options}),{completion_tokens:l,prompt_tokens:h,total_tokens:d}=(u==null?void 0:u.usage)??{};l&&(s.completionTokens=(s.completionTokens??0)+l),h&&(s.promptTokens=(s.promptTokens??0)+h),d&&(s.totalTokens=(s.totalTokens??0)+d);const f=[];for(const p of(u==null?void 0:u.choices)??[]){const m={text:((c=p.message)==null?void 0:c.content)??"",message:xu(p.message??{role:"assistant"})};p.finish_reason&&(m.generationInfo={finish_reason:p.finish_reason}),f.push(m)}return{generations:f,llmOutput:{tokenUsage:s}}}}async getNumTokensFromMessages(e){let t=0,r=0,s=0;Jr(this.modelName)==="gpt-3.5-turbo"?(r=4,s=-1):Jr(this.modelName).startsWith("gpt-4")&&(r=3,s=1);const i=await Promise.all(e.map(async a=>{const o=await this.getNumTokens(a.content),c=await this.getNumTokens(Rt(a)),u=a.name!==void 0?s+await this.getNumTokens(a.name):0,l=o+r+c+u;return t+=l,l}));return t+=3,{totalCount:t,countPerMessage:i}}async completionWithRetry(e,t){const r=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.chat.completions.create(e,r)}catch(s){throw xi(s)}})}_getClientOptions(e){if(!this.client){const r={azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,baseURL:this.clientConfig.baseURL},s=pi(r),i={...this.clientConfig,baseURL:s,timeout:this.timeout,maxRetries:0};i.baseURL||delete i.baseURL,this.client=new D(i)}const t={...this.clientConfig,...e};return this.azureOpenAIApiKey&&(t.headers={"api-key":this.azureOpenAIApiKey,...t.headers},t.query={"api-version":this.azureOpenAIApiVersion,...t.query}),t}_llmType(){return"openai"}_combineLLMOutput(...e){return e.reduce((t,r)=>(r&&r.tokenUsage&&(t.tokenUsage.completionTokens+=r.tokenUsage.completionTokens??0,t.tokenUsage.promptTokens+=r.tokenUsage.promptTokens??0,t.tokenUsage.totalTokens+=r.tokenUsage.totalTokens??0),t),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}}class ku extends Ln{constructor(e){super(e),Object.defineProperty(this,"promptLayerApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"plTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnPromptLayerId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.promptLayerApiKey=(e==null?void 0:e.promptLayerApiKey)??(typeof process<"u"?Nr==null?void 0:Nr.PROMPTLAYER_API_KEY:void 0),this.plTags=(e==null?void 0:e.plTags)??[],this.returnPromptLayerId=(e==null?void 0:e.returnPromptLayerId)??!1}async _generate(e,t,r){const s=Date.now();let i;Array.isArray(t)?i={stop:t}:t!=null&&t.timeout&&!t.signal?i={...t,signal:AbortSignal.timeout(t.timeout)}:i=t??{};const a=await super._generate(e,i,r),o=Date.now(),c=l=>{let h;if(l._getType()==="human")h={role:"user",content:l.content};else if(l._getType()==="ai")h={role:"assistant",content:l.content};else if(l._getType()==="function")h={role:"assistant",content:l.content};else if(l._getType()==="system")h={role:"system",content:l.content};else if(l._getType()==="generic")h={role:l.role,content:l.content};else throw new Error(`Got unknown type ${l}`);return h},u=(l,h)=>{const d={...this.invocationParams(),model:this.modelName};if(h!=null&&h.stop&&Object.keys(d).includes("stop"))throw new Error("`stop` found in both the input and default params.");return l.map(p=>c(p))};for(let l=0;l<a.generations.length;l+=1){const h=a.generations[l],d=u(e,i);let f;const p=[{content:h.text,role:Rt(h.message)}],b=await Sc(this.caller,"langchain.PromptLayerChatOpenAI",{...this._identifyingParams(),messages:d,stream:!1},this.plTags,p,s,o,this.promptLayerApiKey);this.returnPromptLayerId===!0&&(b.success===!0&&(f=b.request_id),(!h.generationInfo||typeof h.generationInfo!="object")&&(h.generationInfo={}),h.generationInfo.promptLayerRequestId=f)}return a}}const Su=Object.freeze(Object.defineProperty({__proto__:null,ChatOpenAI:Ln,PromptLayerChatOpenAI:ku},Symbol.toStringTag,{value:"Module"}));class ms{constructor(e){Object.defineProperty(this,"pageContent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.pageContent=e.pageContent?e.pageContent.toString():this.pageContent,this.metadata=e.metadata??{}}}class Pu extends z{parseResultWithPrompt(e,t,r){return this.parseResult(e,r)}async invoke(e,t){return typeof e=="string"?this._callWithConfig(async r=>this.parseResult([{text:r}]),e,{...t,runType:"parser"}):this._callWithConfig(async r=>this.parseResult([{message:r,text:r.content}]),e,{...t,runType:"parser"})}}class Tu extends Pu{parseResult(e,t){return this.parse(e[0].text,t)}async parseWithPrompt(e,t,r){return this.parse(e,r)}_type(){throw new Error("_type not implemented")}}class Ou extends Tu{async*_transform(e){for await(const t of e)typeof t=="string"?yield this.parseResult([{text:t}]):yield this.parseResult([{message:t,text:t.content}])}async*transform(e,t){yield*this._transformStreamWithConfig(e,this._transform.bind(this),{...t,runType:"parser"})}}class Ai extends Ou{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","schema","output_parser"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"StrOutputParser"}parse(e){return Promise.resolve(e)}getFormatInstructions(){return""}}class Iu extends z{constructor(e){super(e),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.callbacks=e==null?void 0:e.callbacks,this.tags=(e==null?void 0:e.tags)??[],this.metadata=(e==null?void 0:e.metadata)??{},this.verbose=(e==null?void 0:e.verbose)??!1}_getRelevantDocuments(e,t){throw new Error("Not implemented!")}async invoke(e,t){return this.getRelevantDocuments(e,t)}async getRelevantDocuments(e,t){const r=ru(t),s=await W.configure(r.callbacks,this.callbacks,r.tags,this.tags,r.metadata,this.metadata,{verbose:this.verbose}),i=await(s==null?void 0:s.handleRetrieverStart(this.toJSON(),e));try{const a=await this._getRelevantDocuments(e,i);return await(i==null?void 0:i.handleRetrieverEnd(a)),a}catch(a){throw await(i==null?void 0:i.handleRetrieverError(a)),a}}}class Ur extends Iu{static lc_name(){return"VectorStoreRetriever"}get lc_namespace(){return["langchain","retrievers","base"]}_vectorstoreType(){return this.vectorStore._vectorstoreType()}constructor(e){super(e),Object.defineProperty(this,"vectorStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"k",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(this,"searchType",{enumerable:!0,configurable:!0,writable:!0,value:"similarity"}),Object.defineProperty(this,"searchKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.vectorStore=e.vectorStore,this.k=e.k??this.k,this.searchType=e.searchType??this.searchType,this.filter=e.filter,e.searchType==="mmr"&&(this.searchKwargs=e.searchKwargs)}async _getRelevantDocuments(e,t){if(this.searchType==="mmr"){if(typeof this.vectorStore.maxMarginalRelevanceSearch!="function")throw new Error(`The vector store backing this retriever, ${this._vectorstoreType()} does not support max marginal relevance search.`);return this.vectorStore.maxMarginalRelevanceSearch(e,{k:this.k,filter:this.filter,...this.searchKwargs},t==null?void 0:t.getChild("vectorstore"))}return this.vectorStore.similaritySearch(e,this.k,this.filter,t==null?void 0:t.getChild("vectorstore"))}async addDocuments(e,t){return this.vectorStore.addDocuments(e,t)}}class Ru extends ke{constructor(e,t){super(t),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","vectorstores",this._vectorstoreType()]}),Object.defineProperty(this,"embeddings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.embeddings=e}async delete(e){throw new Error("Not implemented.")}async similaritySearch(e,t=4,r=void 0,s=void 0){return(await this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(e),t,r)).map(a=>a[0])}async similaritySearchWithScore(e,t=4,r=void 0,s=void 0){return this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(e),t,r)}static fromTexts(e,t,r,s){throw new Error("the Langchain vectorstore implementation you are using forgot to override this, please report a bug")}static fromDocuments(e,t,r){throw new Error("the Langchain vectorstore implementation you are using forgot to override this, please report a bug")}asRetriever(e,t,r,s,i,a){if(typeof e=="number")return new Ur({vectorStore:this,k:e,filter:t,tags:[...s??[],this._vectorstoreType()],metadata:i,verbose:a,callbacks:r});{const o={vectorStore:this,k:e==null?void 0:e.k,filter:e==null?void 0:e.filter,tags:[...(e==null?void 0:e.tags)??[],this._vectorstoreType()],metadata:e==null?void 0:e.metadata,verbose:e==null?void 0:e.verbose,callbacks:e==null?void 0:e.callbacks,searchType:e==null?void 0:e.searchType};return(e==null?void 0:e.searchType)==="mmr"?new Ur({...o,searchKwargs:e.searchKwargs}):new Ur({...o})}}}class Nn extends Ru{_vectorstoreType(){return"supabase"}constructor(e,t){super(e,t),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tableName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queryName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"upsertBatchSize",{enumerable:!0,configurable:!0,writable:!0,value:500}),this.client=t.client,this.tableName=t.tableName||"documents",this.queryName=t.queryName||"match_documents",this.filter=t.filter,this.upsertBatchSize=t.upsertBatchSize??this.upsertBatchSize}async addDocuments(e,t){const r=e.map(({pageContent:s})=>s);return this.addVectors(await this.embeddings.embedDocuments(r),e,t)}async addVectors(e,t,r){const s=e.map((a,o)=>({content:t[o].pageContent,embedding:a,metadata:t[o].metadata}));let i=[];for(let a=0;a<s.length;a+=this.upsertBatchSize){const o=s.slice(a,a+this.upsertBatchSize).map((u,l)=>r!=null&&r.ids?{id:r.ids[a+l],...u}:u),c=await this.client.from(this.tableName).upsert(o).select();if(c.error)throw new Error(`Error inserting: ${c.error.message} ${c.status} ${c.statusText}`);c.data&&(i=i.concat(c.data.map(u=>u.id)))}return i}async delete(e){const{ids:t}=e;for(const r of t)await this.client.from(this.tableName).delete().eq("id",r)}async similaritySearchVectorWithScore(e,t,r){if(r&&this.filter)throw new Error("cannot provide both `filter` and `this.filter`");const s=r??this.filter??{},i={query_embedding:e};let a;if(typeof s=="function")a=h=>s(h).limit(t);else if(typeof s=="object")i.filter=s,i.match_count=t,a=h=>h;else throw new Error("invalid filter type");const o=this.client.rpc(this.queryName,i),{data:c,error:u}=await a(o);if(u)throw new Error(`Error searching for documents: ${u.code} ${u.message} ${u.details}`);return c.map(h=>[new ms({metadata:h.metadata,pageContent:h.content}),h.similarity])}static async fromTexts(e,t,r,s){const i=[];for(let a=0;a<e.length;a+=1){const o=Array.isArray(t)?t[a]:t,c=new ms({pageContent:e[a],metadata:o});i.push(c)}return Nn.fromDocuments(i,r,s)}static async fromDocuments(e,t,r){const s=new this(t,r);return await s.addDocuments(e),s}static async fromExistingIndex(e,t){return new this(e,t)}}const Cu=(n,e)=>n.reduce((t,r,s)=>{const i=Math.floor(s/e),a=t[i]||[];return t[i]=a.concat([r]),t},[]);class ju{constructor(e){Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.caller=new br(e??{})}}class $u extends ju{constructor(e,t){var u,l;const r={maxConcurrency:2,...e};super(r),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"text-embedding-ada-002"}),Object.defineProperty(this,"batchSize",{enumerable:!0,configurable:!0,writable:!0,value:512}),Object.defineProperty(this,"stripNewLines",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let s=(r==null?void 0:r.openAIApiKey)??L("OPENAI_API_KEY");const i=(r==null?void 0:r.azureOpenAIApiKey)??L("AZURE_OPENAI_API_KEY");if(!i&&!s)throw new Error("OpenAI or Azure OpenAI API key not found");const a=(r==null?void 0:r.azureOpenAIApiInstanceName)??L("AZURE_OPENAI_API_INSTANCE_NAME"),o=((r==null?void 0:r.azureOpenAIApiEmbeddingsDeploymentName)||(r==null?void 0:r.azureOpenAIApiDeploymentName))??(L("AZURE_OPENAI_API_EMBEDDINGS_DEPLOYMENT_NAME")||L("AZURE_OPENAI_API_DEPLOYMENT_NAME")),c=(r==null?void 0:r.azureOpenAIApiVersion)??L("AZURE_OPENAI_API_VERSION");if(this.azureOpenAIBasePath=(r==null?void 0:r.azureOpenAIBasePath)??L("AZURE_OPENAI_BASE_PATH"),this.modelName=(r==null?void 0:r.modelName)??this.modelName,this.batchSize=(r==null?void 0:r.batchSize)??(i?1:this.batchSize),this.stripNewLines=(r==null?void 0:r.stripNewLines)??this.stripNewLines,this.timeout=r==null?void 0:r.timeout,this.azureOpenAIApiVersion=c,this.azureOpenAIApiKey=i,this.azureOpenAIApiInstanceName=a,this.azureOpenAIApiDeploymentName=o,this.azureOpenAIApiKey){if(!this.azureOpenAIApiInstanceName&&!this.azureOpenAIBasePath)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found");s=s??""}this.clientConfig={apiKey:s,baseURL:t==null?void 0:t.basePath,dangerouslyAllowBrowser:!0,defaultHeaders:(u=t==null?void 0:t.baseOptions)==null?void 0:u.headers,defaultQuery:(l=t==null?void 0:t.baseOptions)==null?void 0:l.params,...t}}async embedDocuments(e){const t=Cu(this.stripNewLines?e.map(a=>a.replace(/\n/g," ")):e,this.batchSize),r=t.map(a=>this.embeddingWithRetry({model:this.modelName,input:a})),s=await Promise.all(r),i=[];for(let a=0;a<s.length;a+=1){const o=t[a],{data:c}=s[a];for(let u=0;u<o.length;u+=1)i.push(c[u].embedding)}return i}async embedQuery(e){const{data:t}=await this.embeddingWithRetry({model:this.modelName,input:this.stripNewLines?e.replace(/\n/g," "):e});return t[0].embedding}async embeddingWithRetry(e){if(!this.client){const r={azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,baseURL:this.clientConfig.baseURL},s=pi(r),i={...this.clientConfig,baseURL:s,timeout:this.timeout,maxRetries:0};i.baseURL||delete i.baseURL,this.client=new D(i)}const t={};return this.azureOpenAIApiKey&&(t.headers={"api-key":this.azureOpenAIApiKey,...t.headers},t.query={"api-version":this.azureOpenAIApiVersion,...t.query}),this.caller.call(async()=>{try{return await this.client.embeddings.create(e,t)}catch(r){throw xi(r)}})}}const Lu=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>ce(()=>Promise.resolve().then(()=>wt),void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)};class Un extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class Nu extends Un{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Uu extends Un{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Du extends Un{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var ln;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(ln||(ln={}));var Mu=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(l){try{u(r.next(l))}catch(h){a(h)}}function c(l){try{u(r.throw(l))}catch(h){a(h)}}function u(l){l.done?i(l.value):s(l.value).then(o,c)}u((r=r.apply(n,e||[])).next())})};class Bu{constructor(e,{headers:t={},customFetch:r,region:s=ln.Any}={}){this.url=e,this.headers=t,this.region=s,this.fetch=Lu(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return Mu(this,void 0,void 0,function*(){try{const{headers:s,method:i,body:a}=t;let o={},{region:c}=t;c||(c=this.region),c&&c!=="any"&&(o["x-region"]=c);let u;a&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&(typeof Blob<"u"&&a instanceof Blob||a instanceof ArrayBuffer?(o["Content-Type"]="application/octet-stream",u=a):typeof a=="string"?(o["Content-Type"]="text/plain",u=a):typeof FormData<"u"&&a instanceof FormData?u=a:(o["Content-Type"]="application/json",u=JSON.stringify(a)));const l=yield this.fetch(`${this.url}/${e}`,{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},o),this.headers),s),body:u}).catch(p=>{throw new Nu(p)}),h=l.headers.get("x-relay-error");if(h&&h==="true")throw new Uu(l);if(!l.ok)throw new Du(l);let d=((r=l.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),f;return d==="application/json"?f=yield l.json():d==="application/octet-stream"?f=yield l.blob():d==="multipart/form-data"?f=yield l.formData():f=yield l.text(),{data:f,error:null}}catch(s){return{data:null,error:s}}})}}var zu=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},tt=zu();const qu=tt.fetch,Dn=tt.fetch.bind(tt),ki=tt.Headers,Fu=tt.Request,Vu=tt.Response,wt=Object.freeze(Object.defineProperty({__proto__:null,Headers:ki,Request:Fu,Response:Vu,default:Dn,fetch:qu},Symbol.toStringTag,{value:"Module"}));class Hu extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}}class Zu{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=Dn:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const r=this.fetch;let s=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{var a,o,c;let u=null,l=null,h=null,d=i.status,f=i.statusText;if(i.ok){if(this.method!=="HEAD"){const S=await i.text();S===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?l=S:l=JSON.parse(S))}const b=(a=this.headers.Prefer)===null||a===void 0?void 0:a.match(/count=(exact|planned|estimated)/),m=(o=i.headers.get("content-range"))===null||o===void 0?void 0:o.split("/");b&&m&&m.length>1&&(h=parseInt(m[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(l)&&(l.length>1?(u={code:"PGRST116",details:`Results contain ${l.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},l=null,h=null,d=406,f="Not Acceptable"):l.length===1?l=l[0]:l=null)}else{const b=await i.text();try{u=JSON.parse(b),Array.isArray(u)&&i.status===404&&(l=[],u=null,d=200,f="OK")}catch{i.status===404&&b===""?(d=204,f="No Content"):u={message:b}}if(u&&this.isMaybeSingle&&(!((c=u==null?void 0:u.details)===null||c===void 0)&&c.includes("0 rows"))&&(u=null,d=200,f="OK"),u&&this.shouldThrowOnError)throw new Hu(u)}return{error:u,data:l,count:h,status:d,statusText:f}});return this.shouldThrowOnError||(s=s.catch(i=>{var a,o,c;return{error:{message:`${(a=i==null?void 0:i.name)!==null&&a!==void 0?a:"FetchError"}: ${i==null?void 0:i.message}`,details:`${(o=i==null?void 0:i.stack)!==null&&o!==void 0?o:""}`,hint:"",code:`${(c=i==null?void 0:i.code)!==null&&c!==void 0?c:""}`},data:null,count:null,status:0,statusText:""}})),s.then(e,t)}}class Ku extends Zu{select(e){let t=!1;const r=(e??"*").split("").map(s=>/\s/.test(s)&&!t?"":(s==='"'&&(t=!t),s)).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:s,referencedTable:i=s}={}){const a=i?`${i}.order`:"order",o=this.url.searchParams.get(a);return this.url.searchParams.set(a,`${o?`${o},`:""}${e}.${t?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:r=t}={}){const s=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(s,`${e}`),this}range(e,t,{foreignTable:r,referencedTable:s=r}={}){const i=typeof s>"u"?"offset":`${s}.offset`,a=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(i,`${e}`),this.url.searchParams.set(a,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:s=!1,wal:i=!1,format:a="text"}={}){var o;const c=[e?"analyze":null,t?"verbose":null,r?"settings":null,s?"buffers":null,i?"wal":null].filter(Boolean).join("|"),u=(o=this.headers.Accept)!==null&&o!==void 0?o:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${a}; for="${u}"; options=${c};`,a==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}class Ze extends Ku{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const r=Array.from(new Set(t)).map(s=>typeof s=="string"&&new RegExp("[,()]").test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:s}={}){let i="";s==="plain"?i="pl":s==="phrase"?i="ph":s==="websearch"&&(i="w");const a=r===void 0?"":`(${r})`;return this.url.searchParams.append(e,`${i}fts${a}.${t}`),this}match(e){return Object.entries(e).forEach(([t,r])=>{this.url.searchParams.append(t,`eq.${r}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t,referencedTable:r=t}={}){const s=r?`${r}.or`:"or";return this.url.searchParams.append(s,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}}class Ju{constructor(e,{headers:t={},schema:r,fetch:s}){this.url=e,this.headers=t,this.schema=r,this.fetch=s}select(e,{head:t=!1,count:r}={}){const s=t?"HEAD":"GET";let i=!1;const a=(e??"*").split("").map(o=>/\s/.test(o)&&!i?"":(o==='"'&&(i=!i),o)).join("");return this.url.searchParams.set("select",a),r&&(this.headers.Prefer=`count=${r}`),new Ze({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:r=!0}={}){const s="POST",i=[];if(this.headers.Prefer&&i.push(this.headers.Prefer),t&&i.push(`count=${t}`),r||i.push("missing=default"),this.headers.Prefer=i.join(","),Array.isArray(e)){const a=e.reduce((o,c)=>o.concat(Object.keys(c)),[]);if(a.length>0){const o=[...new Set(a)].map(c=>`"${c}"`);this.url.searchParams.set("columns",o.join(","))}}return new Ze({method:s,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:s,defaultToNull:i=!0}={}){const a="POST",o=[`resolution=${r?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&o.push(this.headers.Prefer),s&&o.push(`count=${s}`),i||o.push("missing=default"),this.headers.Prefer=o.join(","),Array.isArray(e)){const c=e.reduce((u,l)=>u.concat(Object.keys(l)),[]);if(c.length>0){const u=[...new Set(c)].map(l=>`"${l}"`);this.url.searchParams.set("columns",u.join(","))}}return new Ze({method:a,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const r="PATCH",s=[];return this.headers.Prefer&&s.push(this.headers.Prefer),t&&s.push(`count=${t}`),this.headers.Prefer=s.join(","),new Ze({method:r,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t="DELETE",r=[];return e&&r.push(`count=${e}`),this.headers.Prefer&&r.unshift(this.headers.Prefer),this.headers.Prefer=r.join(","),new Ze({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}const Gu="1.13.0",Wu={"X-Client-Info":`postgrest-js/${Gu}`};class Mn{constructor(e,{headers:t={},schema:r,fetch:s}={}){this.url=e,this.headers=Object.assign(Object.assign({},Wu),t),this.schemaName=r,this.fetch=s}from(e){const t=new URL(`${this.url}/${e}`);return new Ju(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new Mn(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:r=!1,count:s}={}){let i;const a=new URL(`${this.url}/rpc/${e}`);let o;r?(i="HEAD",Object.entries(t).forEach(([u,l])=>{a.searchParams.append(u,`${l}`)})):(i="POST",o=t);const c=Object.assign({},this.headers);return s&&(c.Prefer=`count=${s}`),new Ze({method:i,url:a,headers:c,schema:this.schemaName,body:o,fetch:this.fetch,allowEmpty:!1})}}const Xu="2.9.3",Qu={"X-Client-Info":`realtime-js/${Xu}`},Yu="1.0.0",Si=1e4,el=1e3;var Ge;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(Ge||(Ge={}));var G;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(G||(G={}));var ne;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(ne||(ne={}));var hn;(function(n){n.websocket="websocket"})(hn||(hn={}));var je;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(je||(je={}));class Pi{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}class tl{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const s=t.getUint8(1),i=t.getUint8(2);let a=this.HEADER_LENGTH+2;const o=r.decode(e.slice(a,a+s));a=a+s;const c=r.decode(e.slice(a,a+i));a=a+i;const u=JSON.parse(r.decode(e.slice(a,e.byteLength)));return{ref:null,topic:o,event:c,payload:u}}}class Dr{constructor(e,t,r={},s=Si){this.channel=e,this.event=t,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var gs;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(gs||(gs={}));class ut{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},s=>{const{onJoin:i,onLeave:a,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=ut.syncState(this.state,s,i,a),this.pendingDiffs.forEach(c=>{this.state=ut.syncDiff(this.state,c,i,a)}),this.pendingDiffs=[],o()}),this.channel._on(r.diff,{},s=>{const{onJoin:i,onLeave:a,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=ut.syncDiff(this.state,s,i,a),o())}),this.onJoin((s,i,a)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:i,newPresences:a})}),this.onLeave((s,i,a)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:i,leftPresences:a})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,s){const i=this.cloneDeep(e),a=this.transformState(t),o={},c={};return this.map(i,(u,l)=>{a[u]||(c[u]=l)}),this.map(a,(u,l)=>{const h=i[u];if(h){const d=l.map(m=>m.presence_ref),f=h.map(m=>m.presence_ref),p=l.filter(m=>f.indexOf(m.presence_ref)<0),b=h.filter(m=>d.indexOf(m.presence_ref)<0);p.length>0&&(o[u]=p),b.length>0&&(c[u]=b)}else o[u]=l}),this.syncDiff(i,{joins:o,leaves:c},r,s)}static syncDiff(e,t,r,s){const{joins:i,leaves:a}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(i,(o,c)=>{var u;const l=(u=e[o])!==null&&u!==void 0?u:[];if(e[o]=this.cloneDeep(c),l.length>0){const h=e[o].map(f=>f.presence_ref),d=l.filter(f=>h.indexOf(f.presence_ref)<0);e[o].unshift(...d)}r(o,l,c)}),this.map(a,(o,c)=>{let u=e[o];if(!u)return;const l=c.map(h=>h.presence_ref);u=u.filter(h=>l.indexOf(h.presence_ref)<0),e[o]=u,s(o,u,c),u.length===0&&delete e[o]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const s=e[r];return"metas"in s?t[r]=s.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[r]=s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var $;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})($||($={}));const ys=(n,e,t={})=>{var r;const s=(r=t.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((i,a)=>(i[a]=rl(a,n,e,s),i),{})},rl=(n,e,t,r)=>{const s=e.find(o=>o.name===n),i=s==null?void 0:s.type,a=t[n];return i&&!r.includes(i)?Ti(i,a):dn(a)},Ti=(n,e)=>{if(n.charAt(0)==="_"){const t=n.slice(1,n.length);return al(e,t)}switch(n){case $.bool:return nl(e);case $.float4:case $.float8:case $.int2:case $.int4:case $.int8:case $.numeric:case $.oid:return sl(e);case $.json:case $.jsonb:return il(e);case $.timestamp:return ol(e);case $.abstime:case $.date:case $.daterange:case $.int4range:case $.int8range:case $.money:case $.reltime:case $.text:case $.time:case $.timestamptz:case $.timetz:case $.tsrange:case $.tstzrange:return dn(e);default:return dn(e)}},dn=n=>n,nl=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},sl=n=>{if(typeof n=="string"){const e=parseFloat(n);if(!Number.isNaN(e))return e}return n},il=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch(e){return console.log(`JSON parse error: ${e}`),n}return n},al=(n,e)=>{if(typeof n!="string")return n;const t=n.length-1,r=n[t];if(n[0]==="{"&&r==="}"){let i;const a=n.slice(1,t);try{i=JSON.parse("["+a+"]")}catch{i=a?a.split(","):[]}return i.map(o=>Ti(e,o))}return n},ol=n=>typeof n=="string"?n.replace(" ","T"):n;var _s;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(_s||(_s={}));var bs;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes"})(bs||(bs={}));var vs;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(vs||(vs={}));class Bn{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=G.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""}},t.config),this.timeout=this.socket.timeout,this.joinPush=new Dr(this,ne.join,this.params,this.timeout),this.rejoinTimer=new Pi(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=G.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=G.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=G.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=G.errored,this.rejoinTimer.scheduleTimeout())}),this._on(ne.reply,{},(s,i)=>{this._trigger(this._replyEventName(i),s)}),this.presence=new ut(this),this.broadcastEndpointURL=this._broadcastEndpointURL()}subscribe(e,t=this.timeout){var r,s;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:i,presence:a}}=this.params;this._onError(u=>e&&e("CHANNEL_ERROR",u)),this._onClose(()=>e&&e("CLOSED"));const o={},c={broadcast:i,presence:a,postgres_changes:(s=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(u=>u.filter))!==null&&s!==void 0?s:[]};this.socket.accessToken&&(o.access_token=this.socket.accessToken),this.updateJoinPayload(Object.assign({config:c},o)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",({postgres_changes:u})=>{var l;if(this.socket.accessToken&&this.socket.setAuth(this.socket.accessToken),u===void 0){e&&e("SUBSCRIBED");return}else{const h=this.bindings.postgres_changes,d=(l=h==null?void 0:h.length)!==null&&l!==void 0?l:0,f=[];for(let p=0;p<d;p++){const b=h[p],{filter:{event:m,schema:S,table:R,filter:A}}=b,j=u&&u[p];if(j&&j.event===m&&j.schema===S&&j.table===R&&j.filter===A)f.push(Object.assign(Object.assign({},b),{id:j.id}));else{this.unsubscribe(),e&&e("CHANNEL_ERROR",new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=f,e&&e("SUBSCRIBED");return}}).receive("error",u=>{e&&e("CHANNEL_ERROR",new Error(JSON.stringify(Object.values(u).join(", ")||"error")))}).receive("timeout",()=>{e&&e("TIMED_OUT")})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this._on(e,t,r)}async send(e,t={}){var r,s;if(!this._canPush()&&e.type==="broadcast"){const{event:i,payload:a}=e,o={method:"POST",headers:{apikey:(r=this.socket.apiKey)!==null&&r!==void 0?r:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:a}]})};try{return(await this._fetchWithTimeout(this.broadcastEndpointURL,o,(s=t.timeout)!==null&&s!==void 0?s:this.timeout)).ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var a,o,c;const u=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((c=(o=(a=this.params)===null||a===void 0?void 0:a.config)===null||o===void 0?void 0:o.broadcast)===null||c===void 0)&&c.ack)&&i("ok"),u.receive("ok",()=>i("ok")),u.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=G.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(ne.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(r=>{const s=new Dr(this,ne.leave,{},e);s.receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),s.send(),this._canPush()||s.trigger("ok",{})})}_broadcastEndpointURL(){let e=this.socket.endPoint;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"}async _fetchWithTimeout(e,t,r){const s=new AbortController,i=setTimeout(()=>s.abort(),r),a=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(i),a}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new Dr(this,e,t,r);return this._canPush()?s.send():(s.startTimeout(),this.pushBuffer.push(s)),s}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var s,i;const a=e.toLocaleLowerCase(),{close:o,error:c,leave:u,join:l}=ne;if(r&&[o,c,u,l].indexOf(a)>=0&&r!==this._joinRef())return;let d=this._onMessage(a,t,r);if(t&&!d)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(f=>{var p,b,m;return((p=f.filter)===null||p===void 0?void 0:p.event)==="*"||((m=(b=f.filter)===null||b===void 0?void 0:b.event)===null||m===void 0?void 0:m.toLocaleLowerCase())===a}).map(f=>f.callback(d,r)):(i=this.bindings[a])===null||i===void 0||i.filter(f=>{var p,b,m,S,R,A;if(["broadcast","presence","postgres_changes"].includes(a))if("id"in f){const j=f.id,se=(p=f.filter)===null||p===void 0?void 0:p.event;return j&&((b=t.ids)===null||b===void 0?void 0:b.includes(j))&&(se==="*"||(se==null?void 0:se.toLocaleLowerCase())===((m=t.data)===null||m===void 0?void 0:m.type.toLocaleLowerCase()))}else{const j=(R=(S=f==null?void 0:f.filter)===null||S===void 0?void 0:S.event)===null||R===void 0?void 0:R.toLocaleLowerCase();return j==="*"||j===((A=t==null?void 0:t.event)===null||A===void 0?void 0:A.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===a}).map(f=>{if(typeof d=="object"&&"ids"in d){const p=d.data,{schema:b,table:m,commit_timestamp:S,type:R,errors:A}=p;d=Object.assign(Object.assign({},{schema:b,table:m,commit_timestamp:S,eventType:R,new:{},old:{},errors:A}),this._getPayloadRecords(p))}f.callback(d,r)})}_isClosed(){return this.state===G.closed}_isJoined(){return this.state===G.joined}_isJoining(){return this.state===G.joining}_isLeaving(){return this.state===G.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const s=e.toLocaleLowerCase(),i={type:s,filter:t,callback:r};return this.bindings[s]?this.bindings[s].push(i):this.bindings[s]=[i],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(s=>{var i;return!(((i=s.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&Bn.isEqual(s.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(ne.close,{},e)}_onError(e){this._on(ne.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=G.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=ys(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=ys(e.columns,e.old_record)),t}}const cl=()=>{},ul=typeof WebSocket<"u";class ll{constructor(e,t){var r;this.accessToken=null,this.apiKey=null,this.channels=[],this.endPoint="",this.headers=Qu,this.params={},this.timeout=Si,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=cl,this.conn=null,this.sendBuffer=[],this.serializer=new tl,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this._resolveFetch=i=>{let a;return i?a=i:typeof fetch>"u"?a=(...o)=>ce(()=>Promise.resolve().then(()=>wt),void 0).then(({default:c})=>c(...o)):a=fetch,(...o)=>a(...o)},this.endPoint=`${e}/${hn.websocket}`,t!=null&&t.transport?this.transport=t.transport:this.transport=null,t!=null&&t.params&&(this.params=t.params),t!=null&&t.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const s=(r=t==null?void 0:t.params)===null||r===void 0?void 0:r.apikey;s&&(this.accessToken=s,this.apiKey=s),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:i=>[1e3,2e3,5e3,1e4][i-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(i,a)=>a(JSON.stringify(i)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Pi(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t==null?void 0:t.fetch)}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this._endPointURL(),void 0,{headers:this.headers});return}if(ul){this.conn=new WebSocket(this._endPointURL()),this.setupConnection();return}this.conn=new hl(this._endPointURL(),void 0,{close:()=>{this.conn=null}}),ce(()=>import("./browser-DlS-ZfD_.js").then(e=>e.b),__vite__mapDeps([])).then(({default:e})=>{this.conn=new e(this._endPointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case Ge.connecting:return je.Connecting;case Ge.open:return je.Open;case Ge.closing:return je.Closing;default:return je.Closed}}isConnected(){return this.connectionState()===je.Open}channel(e,t={config:{}}){const r=new Bn(`realtime:${e}`,t,this);return this.channels.push(r),r}push(e){const{topic:t,event:r,payload:s,ref:i}=e,a=()=>{this.encode(e,o=>{var c;(c=this.conn)===null||c===void 0||c.send(o)})};this.log("push",`${t} ${r} (${i})`,s),this.isConnected()?a():this.sendBuffer.push(a)}setAuth(e){this.accessToken=e,this.channels.forEach(t=>{e&&t.updateJoinPayload({access_token:e}),t.joinedOnce&&t._isJoined()&&t._push(ne.access_token,{access_token:e})})}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Yu}))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:r,event:s,payload:i,ref:a}=t;(a&&a===this.pendingHeartbeatRef||s===(i==null?void 0:i.type))&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${r} ${s} ${a&&"("+a+")"||""}`,i),this.channels.filter(o=>o._isMember(r)).forEach(o=>o._trigger(s,i,a)),this.stateChangeCallbacks.message.forEach(o=>o(t))})}_onConnOpen(){this.log("transport",`connected to ${this._endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs),this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(ne.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",s=new URLSearchParams(t);return`${e}${r}${s}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(el,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}}class hl{constructor(e,t,r){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=Ge.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=r.close}}class zn extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function q(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}class dl extends zn{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class ws extends zn{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var fl=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(l){try{u(r.next(l))}catch(h){a(h)}}function c(l){try{u(r.throw(l))}catch(h){a(h)}}function u(l){l.done?i(l.value):s(l.value).then(o,c)}u((r=r.apply(n,e||[])).next())})};const Oi=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>ce(()=>Promise.resolve().then(()=>wt),void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},pl=()=>fl(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield ce(()=>Promise.resolve().then(()=>wt),void 0)).Response:Response});var rt=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(l){try{u(r.next(l))}catch(h){a(h)}}function c(l){try{u(r.throw(l))}catch(h){a(h)}}function u(l){l.done?i(l.value):s(l.value).then(o,c)}u((r=r.apply(n,e||[])).next())})};const Mr=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),ml=(n,e)=>rt(void 0,void 0,void 0,function*(){const t=yield pl();n instanceof t?n.json().then(r=>{e(new dl(Mr(r),n.status||500))}).catch(r=>{e(new ws(Mr(r),r))}):e(new ws(Mr(n),n))}),gl=(n,e,t,r)=>{const s={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),t))};function Er(n,e,t,r,s,i){return rt(this,void 0,void 0,function*(){return new Promise((a,o)=>{n(t,gl(e,r,s,i)).then(c=>{if(!c.ok)throw c;return r!=null&&r.noResolveJson?c:c.json()}).then(c=>a(c)).catch(c=>ml(c,o))})})}function fn(n,e,t,r){return rt(this,void 0,void 0,function*(){return Er(n,"GET",e,t,r)})}function ve(n,e,t,r,s){return rt(this,void 0,void 0,function*(){return Er(n,"POST",e,r,s,t)})}function yl(n,e,t,r,s){return rt(this,void 0,void 0,function*(){return Er(n,"PUT",e,r,s,t)})}function Ii(n,e,t,r,s){return rt(this,void 0,void 0,function*(){return Er(n,"DELETE",e,r,s,t)})}var Q=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(l){try{u(r.next(l))}catch(h){a(h)}}function c(l){try{u(r.throw(l))}catch(h){a(h)}}function u(l){l.done?i(l.value):s(l.value).then(o,c)}u((r=r.apply(n,e||[])).next())})};const _l={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Es={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class bl{constructor(e,t={},r,s){this.url=e,this.headers=t,this.bucketId=r,this.fetch=Oi(s)}uploadOrUpdate(e,t,r,s){return Q(this,void 0,void 0,function*(){try{let i;const a=Object.assign(Object.assign({},Es),s),o=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(a.upsert)});typeof Blob<"u"&&r instanceof Blob?(i=new FormData,i.append("cacheControl",a.cacheControl),i.append("",r)):typeof FormData<"u"&&r instanceof FormData?(i=r,i.append("cacheControl",a.cacheControl)):(i=r,o["cache-control"]=`max-age=${a.cacheControl}`,o["content-type"]=a.contentType);const c=this._removeEmptyFolders(t),u=this._getFinalPath(c),l=yield this.fetch(`${this.url}/object/${u}`,Object.assign({method:e,body:i,headers:o},a!=null&&a.duplex?{duplex:a.duplex}:{})),h=yield l.json();return l.ok?{data:{path:c,id:h.Id,fullPath:h.Key},error:null}:{data:null,error:h}}catch(i){if(q(i))return{data:null,error:i};throw i}})}upload(e,t,r){return Q(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,s){return Q(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),a=this._getFinalPath(i),o=new URL(this.url+`/object/upload/sign/${a}`);o.searchParams.set("token",t);try{let c;const u=Object.assign({upsert:Es.upsert},s),l=Object.assign(Object.assign({},this.headers),{"x-upsert":String(u.upsert)});typeof Blob<"u"&&r instanceof Blob?(c=new FormData,c.append("cacheControl",u.cacheControl),c.append("",r)):typeof FormData<"u"&&r instanceof FormData?(c=r,c.append("cacheControl",u.cacheControl)):(c=r,l["cache-control"]=`max-age=${u.cacheControl}`,l["content-type"]=u.contentType);const h=yield this.fetch(o.toString(),{method:"PUT",body:c,headers:l}),d=yield h.json();return h.ok?{data:{path:i,fullPath:d.Key},error:null}:{data:null,error:d}}catch(c){if(q(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(e){return Q(this,void 0,void 0,function*(){try{let t=this._getFinalPath(e);const r=yield ve(this.fetch,`${this.url}/object/upload/sign/${t}`,{},{headers:this.headers}),s=new URL(this.url+r.url),i=s.searchParams.get("token");if(!i)throw new zn("No token returned by API");return{data:{signedUrl:s.toString(),path:e,token:i},error:null}}catch(t){if(q(t))return{data:null,error:t};throw t}})}update(e,t,r){return Q(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t){return Q(this,void 0,void 0,function*(){try{return{data:yield ve(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers}),error:null}}catch(r){if(q(r))return{data:null,error:r};throw r}})}copy(e,t){return Q(this,void 0,void 0,function*(){try{return{data:{path:(yield ve(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers})).Key},error:null}}catch(r){if(q(r))return{data:null,error:r};throw r}})}createSignedUrl(e,t,r){return Q(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),i=yield ve(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},r!=null&&r.transform?{transform:r.transform}:{}),{headers:this.headers});const a=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${a}`)},{data:i,error:null}}catch(s){if(q(s))return{data:null,error:s};throw s}})}createSignedUrls(e,t,r){return Q(this,void 0,void 0,function*(){try{const s=yield ve(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:s.map(a=>Object.assign(Object.assign({},a),{signedUrl:a.signedURL?encodeURI(`${this.url}${a.signedURL}${i}`):null})),error:null}}catch(s){if(q(s))return{data:null,error:s};throw s}})}download(e,t){return Q(this,void 0,void 0,function*(){const s=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),a=i?`?${i}`:"";try{const o=this._getFinalPath(e);return{data:yield(yield fn(this.fetch,`${this.url}/${s}/${o}${a}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(o){if(q(o))return{data:null,error:o};throw o}})}getPublicUrl(e,t){const r=this._getFinalPath(e),s=[],i=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&s.push(i);const o=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",c=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});c!==""&&s.push(c);let u=s.join("&");return u!==""&&(u=`?${u}`),{data:{publicUrl:encodeURI(`${this.url}/${o}/public/${r}${u}`)}}}remove(e){return Q(this,void 0,void 0,function*(){try{return{data:yield Ii(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(q(t))return{data:null,error:t};throw t}})}list(e,t,r){return Q(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},_l),t),{prefix:e||""});return{data:yield ve(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},r),error:null}}catch(s){if(q(s))return{data:null,error:s};throw s}})}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const vl="2.5.5",wl={"X-Client-Info":`storage-js/${vl}`};var Me=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(l){try{u(r.next(l))}catch(h){a(h)}}function c(l){try{u(r.throw(l))}catch(h){a(h)}}function u(l){l.done?i(l.value):s(l.value).then(o,c)}u((r=r.apply(n,e||[])).next())})};class El{constructor(e,t={},r){this.url=e,this.headers=Object.assign(Object.assign({},wl),t),this.fetch=Oi(r)}listBuckets(){return Me(this,void 0,void 0,function*(){try{return{data:yield fn(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(q(e))return{data:null,error:e};throw e}})}getBucket(e){return Me(this,void 0,void 0,function*(){try{return{data:yield fn(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(q(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return Me(this,void 0,void 0,function*(){try{return{data:yield ve(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(q(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return Me(this,void 0,void 0,function*(){try{return{data:yield yl(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(q(r))return{data:null,error:r};throw r}})}emptyBucket(e){return Me(this,void 0,void 0,function*(){try{return{data:yield ve(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(q(t))return{data:null,error:t};throw t}})}deleteBucket(e){return Me(this,void 0,void 0,function*(){try{return{data:yield Ii(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(q(t))return{data:null,error:t};throw t}})}}class xl extends El{constructor(e,t={},r){super(e,t,r)}from(e){return new bl(this.url,this.headers,e,this.fetch)}}const Al="2.36.0";let it="";typeof Deno<"u"?it="deno":typeof document<"u"?it="web":typeof navigator<"u"&&navigator.product==="ReactNative"?it="react-native":it="node";const kl={"X-Client-Info":`supabase-js-${it}/${Al}`};var Sl=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(l){try{u(r.next(l))}catch(h){a(h)}}function c(l){try{u(r.throw(l))}catch(h){a(h)}}function u(l){l.done?i(l.value):s(l.value).then(o,c)}u((r=r.apply(n,e||[])).next())})};const Pl=n=>{let e;return n?e=n:typeof fetch>"u"?e=Dn:e=fetch,(...t)=>e(...t)},Tl=()=>typeof Headers>"u"?ki:Headers,Ol=(n,e,t)=>{const r=Pl(t),s=Tl();return(i,a)=>Sl(void 0,void 0,void 0,function*(){var o;const c=(o=yield e())!==null&&o!==void 0?o:n;let u=new s(a==null?void 0:a.headers);return u.has("apikey")||u.set("apikey",n),u.has("Authorization")||u.set("Authorization",`Bearer ${c}`),r(i,Object.assign(Object.assign({},a),{headers:u}))})};function Il(n){return n.replace(/\/$/,"")}function Rl(n,e){const{db:t,auth:r,realtime:s,global:i}=n,{db:a,auth:o,realtime:c,global:u}=e;return{db:Object.assign(Object.assign({},a),t),auth:Object.assign(Object.assign({},o),r),realtime:Object.assign(Object.assign({},c),s),global:Object.assign(Object.assign({},u),i)}}function Cl(n){return Math.round(Date.now()/1e3)+n}function jl(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const e=Math.random()*16|0;return(n=="x"?e:e&3|8).toString(16)})}const re=()=>typeof document<"u",Te={tested:!1,writable:!1},lt=()=>{if(!re())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Te.tested)return Te.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),Te.tested=!0,Te.writable=!0}catch{Te.tested=!0,Te.writable=!1}return Te.writable};function Br(n){const e={},t=new URL(n);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((s,i)=>{e[i]=s})}catch{}return t.searchParams.forEach((r,s)=>{e[s]=r}),e}const Ri=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>ce(()=>Promise.resolve().then(()=>wt),void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},$l=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",Oe=async(n,e,t)=>{await n.setItem(e,JSON.stringify(t))},Pt=async(n,e)=>{const t=await n.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},zr=async(n,e)=>{await n.removeItem(e)};function Ll(n){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let t="",r,s,i,a,o,c,u,l=0;for(n=n.replace("-","+").replace("_","/");l<n.length;)a=e.indexOf(n.charAt(l++)),o=e.indexOf(n.charAt(l++)),c=e.indexOf(n.charAt(l++)),u=e.indexOf(n.charAt(l++)),r=a<<2|o>>4,s=(o&15)<<4|c>>2,i=(c&3)<<6|u,t=t+String.fromCharCode(r),c!=64&&s!=0&&(t=t+String.fromCharCode(s)),u!=64&&i!=0&&(t=t+String.fromCharCode(i));return t}class xr{constructor(){this.promise=new xr.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}xr.promiseConstructor=Promise;function xs(n){const e=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,t=n.split(".");if(t.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!e.test(t[1]))throw new Error("JWT is not valid: payload is not in base64url format");const r=t[1];return JSON.parse(Ll(r))}async function Nl(n){return await new Promise(e=>{setTimeout(()=>e(null),n)})}function Ul(n,e){return new Promise((r,s)=>{(async()=>{for(let i=0;i<1/0;i++)try{const a=await n(i);if(!e(i,null,a)){r(a);return}}catch(a){if(!e(i,a)){s(a);return}}})()})}function Dl(n){return("0"+n.toString(16)).substr(-2)}function Be(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let s="";for(let i=0;i<56;i++)s+=t.charAt(Math.floor(Math.random()*r));return s}return crypto.getRandomValues(e),Array.from(e,Dl).join("")}async function Ml(n){const t=new TextEncoder().encode(n),r=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(r);return Array.from(s).map(i=>String.fromCharCode(i)).join("")}function Bl(n){return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function ze(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const t=await Ml(n);return Bl(t)}class qn extends Error{constructor(e,t){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t}}function P(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class zl extends qn{constructor(e,t){super(e,t),this.name="AuthApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}function ql(n){return P(n)&&n.name==="AuthApiError"}class Ci extends qn{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Ue extends qn{constructor(e,t,r){super(e),this.name=t,this.status=r}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class qe extends Ue{constructor(){super("Auth session missing!","AuthSessionMissingError",400)}}class qr extends Ue{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500)}}class Tt extends Ue{constructor(e){super(e,"AuthInvalidCredentialsError",400)}}class Ot extends Ue{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class As extends Ue{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class pn extends Ue{constructor(e,t){super(e,"AuthRetryableFetchError",t)}}function Fr(n){return P(n)&&n.name==="AuthRetryableFetchError"}class Fl extends Ue{constructor(e,t,r){super(e,"AuthWeakPasswordError",t),this.reasons=r}}var Vl=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};const Ke=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),Hl=[502,503,504];async function ks(n){if(!$l(n))throw new pn(Ke(n),0);if(Hl.includes(n.status))throw new pn(Ke(n),n.status);let e;try{e=await n.json()}catch(t){throw new Ci(Ke(t),t)}throw typeof e=="object"&&e&&typeof e.weak_password=="object"&&e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.reasons.reduce((t,r)=>t&&typeof r=="string",!0)?new Fl(Ke(e),n.status,e.weak_password.reasons):new zl(Ke(e),n.status||500)}const Zl=(n,e,t,r)=>{const s={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),t))};async function T(n,e,t,r){var s;const i=Object.assign({},r==null?void 0:r.headers);r!=null&&r.jwt&&(i.Authorization=`Bearer ${r.jwt}`);const a=(s=r==null?void 0:r.query)!==null&&s!==void 0?s:{};r!=null&&r.redirectTo&&(a.redirect_to=r.redirectTo);const o=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",c=await Kl(n,e,t+o,{headers:i,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(c):{data:Object.assign({},c),error:null}}async function Kl(n,e,t,r,s,i){const a=Zl(e,r,s,i);let o;try{o=await n(t,a)}catch(c){throw console.error(c),new pn(Ke(c),0)}if(o.ok||await ks(o),r!=null&&r.noResolveJson)return o;try{return await o.json()}catch(c){await ks(c)}}function Ie(n){var e;let t=null;Xl(n)&&(t=Object.assign({},n),n.expires_at||(t.expires_at=Cl(n.expires_in)));const r=(e=n.user)!==null&&e!==void 0?e:n;return{data:{session:t,user:r},error:null}}function Ss(n){const e=Ie(n);return!e.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((t,r)=>t&&typeof r=="string",!0)&&(e.data.weak_password=n.weak_password),e}function we(n){var e;return{data:{user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function Jl(n){return{data:n,error:null}}function Gl(n){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:i}=n,a=Vl(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:i},c=Object.assign({},a);return{data:{properties:o,user:c},error:null}}function Wl(n){return n}function Xl(n){return n.access_token&&n.refresh_token&&n.expires_in}var Ql=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};class Yl{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=Ri(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await T(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(P(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await T(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:we})}catch(r){if(P(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=Ql(e,["options"]),s=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(s.new_email=r==null?void 0:r.newEmail,delete s.newEmail),await T(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:Gl,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(P(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await T(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:we})}catch(t){if(P(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,s,i,a,o,c;try{const u={nextPage:null,lastPage:0,total:0},l=await T(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(i=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:Wl});if(l.error)throw l.error;const h=await l.json(),d=(a=l.headers.get("x-total-count"))!==null&&a!==void 0?a:0,f=(c=(o=l.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&c!==void 0?c:[];return f.length>0&&(f.forEach(p=>{const b=parseInt(p.split(";")[0].split("=")[1].substring(0,1)),m=JSON.parse(p.split(";")[1].split("=")[1]);u[`${m}Page`]=b}),u.total=parseInt(d)),{data:Object.assign(Object.assign({},h),u),error:null}}catch(u){if(P(u))return{data:{users:[]},error:u};throw u}}async getUserById(e){try{return await T(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:we})}catch(t){if(P(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){try{return await T(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:we})}catch(r){if(P(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){try{return await T(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:we})}catch(r){if(P(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){try{const{data:t,error:r}=await T(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:t,error:r}}catch(t){if(P(t))return{data:null,error:t};throw t}}async _deleteFactor(e){try{return{data:await T(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(P(t))return{data:null,error:t};throw t}}}const ji="0.0.0",eh="http://localhost:9999",th="supabase.auth.token",rh={"X-Client-Info":`gotrue-js/${ji}`},Ps=10,nh={getItem:n=>lt()?globalThis.localStorage.getItem(n):null,setItem:(n,e)=>{lt()&&globalThis.localStorage.setItem(n,e)},removeItem:n=>{lt()&&globalThis.localStorage.removeItem(n)}};function Ts(n={}){return{getItem:e=>n[e]||null,setItem:(e,t)=>{n[e]=t},removeItem:e=>{delete n[e]}}}function sh(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const Fe={debug:!!(globalThis&&lt()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class $i extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class ih extends $i{}async function ah(n,e,t){Fe.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),Fe.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},e),await globalThis.navigator.locks.request(n,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async s=>{if(s){Fe.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,s.name);try{return await t()}finally{Fe.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,s.name)}}else{if(e===0)throw Fe.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new ih(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(Fe.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}})}sh();const oh={url:eh,storageKey:th,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:rh,flowType:"implicit",debug:!1},st=30*1e3,Os=3;async function Is(n,e,t){return await t()}class mt{constructor(e){var t,r;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=mt.nextInstanceID,mt.nextInstanceID+=1,this.instanceID>0&&re()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},oh),e);if(this.logDebugMessages=!!s.debug,typeof s.debug=="function"&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new Yl({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=Ri(s.fetch),this.lock=s.lock||Is,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,s.lock?this.lock=s.lock:re()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=ah:this.lock=Is,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?s.storage?this.storage=s.storage:lt()?this.storage=nh:(this.memoryStorage={},this.storage=Ts(this.memoryStorage)):(this.memoryStorage={},this.storage=Ts(this.memoryStorage)),re()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${ji}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){try{const e=re()?await this._isPKCEFlow():!1;if(this._debug("#_initialize()","begin","is PKCE flow",e),e||this.detectSessionInUrl&&this._isImplicitGrantFlow()){const{data:t,error:r}=await this._getSessionFromURL(e);if(r)return this._debug("#_initialize()","error detecting session from URL",r),(r==null?void 0:r.message)==="Identity is already linked"||(r==null?void 0:r.message)==="Identity is already linked to another user"?{error:r}:(await this._removeSession(),{error:r});const{session:s,redirectType:i}=t;return this._debug("#_initialize()","detected session in URL",s,"redirect type",i),await this._saveSession(s),setTimeout(async()=>{i==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",s):await this._notifyAllSubscribers("SIGNED_IN",s)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(e){return P(e)?{error:e}:{error:new Ci("Unexpected error during initialization",e)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signUp(e){var t,r,s;try{await this._removeSession();let i;if("email"in e){const{email:l,password:h,options:d}=e;let f=null,p=null;if(this.flowType==="pkce"){const b=Be();await Oe(this.storage,`${this.storageKey}-code-verifier`,b),f=await ze(b),p=b===f?"plain":"s256"}i=await T(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:d==null?void 0:d.emailRedirectTo,body:{email:l,password:h,data:(t=d==null?void 0:d.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken},code_challenge:f,code_challenge_method:p},xform:Ie})}else if("phone"in e){const{phone:l,password:h,options:d}=e;i=await T(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:l,password:h,data:(r=d==null?void 0:d.data)!==null&&r!==void 0?r:{},channel:(s=d==null?void 0:d.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken}},xform:Ie})}else throw new Tt("You must provide either an email or phone number and a password");const{data:a,error:o}=i;if(o||!a)return{data:{user:null,session:null},error:o};const c=a.session,u=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(i){if(P(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(e){try{await this._removeSession();let t;if("email"in e){const{email:i,password:a,options:o}=e;t=await T(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:Ss})}else if("phone"in e){const{phone:i,password:a,options:o}=e;t=await T(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:Ss})}else throw new Tt("You must provide either an email or phone number and a password");const{data:r,error:s}=t;return s?{data:{user:null,session:null},error:s}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new qr}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:s})}catch(t){if(P(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,r,s,i;return await this._removeSession(),await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){const t=await Pt(this.storage,`${this.storageKey}-code-verifier`),[r,s]=(t??"").split("/"),{data:i,error:a}=await T(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:Ie});return await zr(this.storage,`${this.storageKey}-code-verifier`),a?{data:{user:null,session:null,redirectType:null},error:a}:!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new qr}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:s??null}),error:a})}async signInWithIdToken(e){await this._removeSession();try{const{options:t,provider:r,token:s,access_token:i,nonce:a}=e,o=await T(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:s,access_token:i,nonce:a,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:Ie}),{data:c,error:u}=o;return u?{data:{user:null,session:null},error:u}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new qr}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:u})}catch(t){if(P(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,r,s,i,a;try{if(await this._removeSession(),"email"in e){const{email:o,options:c}=e;let u=null,l=null;if(this.flowType==="pkce"){const d=Be();await Oe(this.storage,`${this.storageKey}-code-verifier`,d),u=await ze(d),l=d===u?"plain":"s256"}const{error:h}=await T(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(t=c==null?void 0:c.data)!==null&&t!==void 0?t:{},create_user:(r=c==null?void 0:c.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},code_challenge:u,code_challenge_method:l},redirectTo:c==null?void 0:c.emailRedirectTo});return{data:{user:null,session:null},error:h}}if("phone"in e){const{phone:o,options:c}=e,{data:u,error:l}=await T(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(s=c==null?void 0:c.data)!==null&&s!==void 0?s:{},create_user:(i=c==null?void 0:c.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},channel:(a=c==null?void 0:c.channel)!==null&&a!==void 0?a:"sms"}});return{data:{user:null,session:null,messageId:u==null?void 0:u.message_id},error:l}}throw new Tt("You must provide either an email or phone number.")}catch(o){if(P(o))return{data:{user:null,session:null},error:o};throw o}}async verifyOtp(e){var t,r;try{e.type!=="email_change"&&e.type!=="phone_change"&&await this._removeSession();let s,i;"options"in e&&(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:a,error:o}=await T(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:s,xform:Ie});if(o)throw o;if(!a)throw new Error("An error occurred on token verification.");const c=a.session,u=a.user;return c!=null&&c.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(s){if(P(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(e){var t,r,s;try{await this._removeSession();let i=null,a=null;if(this.flowType==="pkce"){const o=Be();await Oe(this.storage,`${this.storageKey}-code-verifier`,o),i=await ze(o),a=o===i?"plain":"s256"}return await T(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((s=e==null?void 0:e.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:a}),headers:this.headers,xform:Jl})}catch(i){if(P(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new qe;const{error:s}=await T(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:s}})}catch(e){if(P(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{e.type!="email_change"&&e.type!="phone_change"&&await this._removeSession();const t=`${this.url}/resend`;if("email"in e){const{email:r,type:s,options:i}=e,{error:a}=await T(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:a}}else if("phone"in e){const{phone:r,type:s,options:i}=e,{data:a,error:o}=await T(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:a==null?void 0:a.message_id},error:o}}throw new Tt("You must provide either an email or phone number and a type")}catch(t){if(P(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,this._acquireLock(-1,async()=>this._useSession(async e=>e))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await r,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=t();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Pt(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at<=Date.now()/1e3:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r)return{data:{session:e},error:null};const{session:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await T(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:we}):await this._useSession(async t=>{var r,s;const{data:i,error:a}=t;if(a)throw a;return await T(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(s=(r=i.session)===null||r===void 0?void 0:r.access_token)!==null&&s!==void 0?s:void 0,xform:we})})}catch(t){if(P(t))return{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:s,error:i}=r;if(i)throw i;if(!s.session)throw new qe;const a=s.session;let o=null,c=null;if(this.flowType==="pkce"&&e.email!=null){const h=Be();await Oe(this.storage,`${this.storageKey}-code-verifier`,h),o=await ze(h),c=h===o?"plain":"s256"}const{data:u,error:l}=await T(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:o,code_challenge_method:c}),jwt:a.access_token,xform:we});if(l)throw l;return a.user=u.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),{data:{user:a.user},error:null}})}catch(r){if(P(r))return{data:{user:null},error:r};throw r}}_decodeJWT(e){return xs(e)}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new qe;const t=Date.now()/1e3;let r=t,s=!0,i=null;const a=xs(e.access_token);if(a.exp&&(r=a.exp,s=r<=t),s){const{session:o,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!o)return{data:{user:null,session:null},error:null};i=o}else{const{data:o,error:c}=await this._getUser(e.access_token);if(c)throw c;i={access_token:e.access_token,refresh_token:e.refresh_token,user:o.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if(P(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:a,error:o}=t;if(o)throw o;e=(r=a.session)!==null&&r!==void 0?r:void 0}if(!(e!=null&&e.refresh_token))throw new qe;const{session:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(P(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e){try{if(!re())throw new Ot("No browser detected.");if(this.flowType==="implicit"&&!this._isImplicitGrantFlow())throw new Ot("Not a valid implicit grant flow url.");if(this.flowType=="pkce"&&!e)throw new As("Not a valid PKCE flow url.");const t=Br(window.location.href);if(e){if(!t.code)throw new As("No code detected.");const{data:R,error:A}=await this._exchangeCodeForSession(t.code);if(A)throw A;const j=new URL(window.location.href);return j.searchParams.delete("code"),window.history.replaceState(window.history.state,"",j.toString()),{data:{session:R.session,redirectType:null},error:null}}if(t.error||t.error_description||t.error_code)throw new Ot(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});const{provider_token:r,provider_refresh_token:s,access_token:i,refresh_token:a,expires_in:o,expires_at:c,token_type:u}=t;if(!i||!o||!a||!u)throw new Ot("No session defined in URL");const l=Math.round(Date.now()/1e3),h=parseInt(o);let d=l+h;c&&(d=parseInt(c));const f=d-l;f*1e3<=st&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${f}s, should have been closer to ${h}s`);const p=d-h;l-p>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",p,d,l):l-p<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clok for skew",p,d,l);const{data:b,error:m}=await this._getUser(i);if(m)throw m;const S={provider_token:r,provider_refresh_token:s,access_token:i,expires_in:h,expires_at:d,refresh_token:a,token_type:u,user:b.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:S,redirectType:t.type},error:null}}catch(t){if(P(t))return{data:{session:null,redirectType:null},error:t};throw t}}_isImplicitGrantFlow(){const e=Br(window.location.href);return!!(re()&&(e.access_token||e.error_description))}async _isPKCEFlow(){const e=Br(window.location.href),t=await Pt(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:s,error:i}=t;if(i)return{error:i};const a=(r=s.session)===null||r===void 0?void 0:r.access_token;if(a){const{error:o}=await this.admin.signOut(a,e);if(o&&!(ql(o)&&(o.status===404||o.status===401)))return{error:o}}return e!=="others"&&(await this._removeSession(),await zr(this.storage,`${this.storageKey}-code-verifier`),await this._notifyAllSubscribers("SIGNED_OUT",null)),{error:null}})}onAuthStateChange(e){const t=jl(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,s;try{const{data:{session:i},error:a}=t;if(a)throw a;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,t={}){let r=null,s=null;if(this.flowType==="pkce"){const i=Be();await Oe(this.storage,`${this.storageKey}-code-verifier`,`${i}/PASSWORD_RECOVERY`),r=await ze(i),s=i===r?"plain":"s256"}try{return await T(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(P(i))return{data:null,error:i};throw i}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(P(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:r,error:s}=await this._useSession(async i=>{var a,o,c,u,l;const{data:h,error:d}=i;if(d)throw d;const f=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(a=e.options)===null||a===void 0?void 0:a.redirectTo,scopes:(o=e.options)===null||o===void 0?void 0:o.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await T(this.fetch,"GET",f,{headers:this.headers,jwt:(l=(u=h.session)===null||u===void 0?void 0:u.access_token)!==null&&l!==void 0?l:void 0})});if(s)throw s;return re()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),{data:{provider:e.provider,url:r==null?void 0:r.url},error:null}}catch(r){if(P(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,s;const{data:i,error:a}=t;if(a)throw a;return await T(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(s=(r=i.session)===null||r===void 0?void 0:r.access_token)!==null&&s!==void 0?s:void 0})})}catch(t){if(P(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return await Ul(async s=>(await Nl(s*200),this._debug(t,"refreshing attempt",s),await T(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Ie})),(s,i,a)=>a&&a.error&&Fr(a.error)&&Date.now()+(s+1)*200-r<st)}catch(r){if(this._debug(t,"error",r),P(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),re()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const r=await Pt(this.storage,this.storageKey);if(this._debug(t,"session from storage",r),!this._isValidSession(r)){this._debug(t,"session is not valid"),r!==null&&await this._removeSession();return}const s=Math.round(Date.now()/1e3),i=((e=r.expires_at)!==null&&e!==void 0?e:1/0)<s+Ps;if(this._debug(t,`session has${i?"":" not"} expired with margin of ${Ps}s`),i){if(this.autoRefreshToken&&r.refresh_token){const{error:a}=await this._callRefreshToken(r.refresh_token);a&&(console.error(a),Fr(a)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",a),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){this._debug(t,"error",r),console.error(r);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new qe;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new xr;const{data:i,error:a}=await this._refreshAccessToken(e);if(a)throw a;if(!i.session)throw new qe;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const o={session:i.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(i){if(this._debug(s,"error",i),P(i)){const a={session:null,error:i};return Fr(i)||(await this._removeSession(),await this._notifyAllSubscribers("SIGNED_OUT",null)),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(a),a}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(i),i}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,r=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],a=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(e,t)}catch(c){i.push(c)}});if(await Promise.all(a),i.length>0){for(let o=0;o<i.length;o+=1)console.error(i[o]);throw i[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),await Oe(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await zr(this.storage,this.storageKey)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&re()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),st);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((r.expires_at*1e3-e)/st);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${st}ms, refresh threshold is ${Os} ticks`),s<=Os&&await this._callRefreshToken(r.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof $i)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!re()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const s=[`provider=${encodeURIComponent(t)}`];if(r!=null&&r.redirectTo&&s.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&s.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const i=Be();await Oe(this.storage,`${this.storageKey}-code-verifier`,i);const a=await ze(i),o=i===a?"plain":"s256";this._debug("PKCE","code verifier",`${i.substring(0,5)}...`,"code challenge",a,"method",o);const c=new URLSearchParams({code_challenge:`${encodeURIComponent(a)}`,code_challenge_method:`${encodeURIComponent(o)}`});s.push(c.toString())}if(r!=null&&r.queryParams){const i=new URLSearchParams(r.queryParams);s.push(i.toString())}return r!=null&&r.skipBrowserRedirect&&s.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:s,error:i}=t;return i?{data:null,error:i}:await T(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(P(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,s;const{data:i,error:a}=t;if(a)return{data:null,error:a};const{data:o,error:c}=await T(this.fetch,"POST",`${this.url}/factors`,{body:{friendly_name:e.friendlyName,factor_type:e.factorType,issuer:e.issuer},headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token});return c?{data:null,error:c}:(!((s=o==null?void 0:o.totp)===null||s===void 0)&&s.qr_code&&(o.totp.qr_code=`data:image/svg+xml;utf-8,${o.totp.qr_code}`),{data:o,error:null})})}catch(t){if(P(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:s,error:i}=t;if(i)return{data:null,error:i};const{data:a,error:o}=await T(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token});return o?{data:null,error:o}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),{data:a,error:o})})}catch(t){if(P(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:s,error:i}=t;return i?{data:null,error:i}:await T(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(P(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const r=(e==null?void 0:e.factors)||[],s=r.filter(i=>i.factor_type==="totp"&&i.status==="verified");return{data:{all:r,totp:s},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,r;const{data:{session:s},error:i}=e;if(i)return{data:null,error:i};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const a=this._decodeJWT(s.access_token);let o=null;a.aal&&(o=a.aal);let c=o;((r=(t=s.user.factors)===null||t===void 0?void 0:t.filter(h=>h.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(c="aal2");const l=a.amr||[];return{data:{currentLevel:o,nextLevel:c,currentAuthenticationMethods:l},error:null}}))}}mt.nextInstanceID=0;class ch extends mt{constructor(e){super(e)}}var uh=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(l){try{u(r.next(l))}catch(h){a(h)}}function c(l){try{u(r.throw(l))}catch(h){a(h)}}function u(l){l.done?i(l.value):s(l.value).then(o,c)}u((r=r.apply(n,e||[])).next())})};const lh={headers:kl},hh={schema:"public"},dh={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},fh={};class ph{constructor(e,t,r){var s,i,a,o,c,u,l,h;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const d=Il(e);this.realtimeUrl=`${d}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${d}/auth/v1`,this.storageUrl=`${d}/storage/v1`,this.functionsUrl=`${d}/functions/v1`;const f=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,p={db:hh,realtime:fh,auth:Object.assign(Object.assign({},dh),{storageKey:f}),global:lh},b=Rl(r??{},p);this.storageKey=(i=(s=b.auth)===null||s===void 0?void 0:s.storageKey)!==null&&i!==void 0?i:"",this.headers=(o=(a=b.global)===null||a===void 0?void 0:a.headers)!==null&&o!==void 0?o:{},this.auth=this._initSupabaseAuthClient((c=b.auth)!==null&&c!==void 0?c:{},this.headers,(u=b.global)===null||u===void 0?void 0:u.fetch),this.fetch=Ol(t,this._getAccessToken.bind(this),(l=b.global)===null||l===void 0?void 0:l.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},b.realtime)),this.rest=new Mn(`${d}/rest/v1`,{headers:this.headers,schema:(h=b.db)===null||h===void 0?void 0:h.schema,fetch:this.fetch}),this._listenForAuthEvents()}get functions(){return new Bu(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new xl(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return uh(this,void 0,void 0,function*(){const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,storageKey:i,flowType:a,debug:o},c,u){const l={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new ch({url:this.authUrl,headers:Object.assign(Object.assign({},l),c),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,flowType:a,debug:o,fetch:u})}_initRealtimeClient(e){return new ll(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r==null?void 0:r.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?(this.realtime.setAuth(r??null),this.changedAccessToken=r):e==="SIGNED_OUT"&&(this.realtime.setAuth(this.supabaseKey),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const mh=(n,e,t)=>new ph(n,e,t),gh="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",yh=new $u({openAIApiKey:gh}),_h="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFka3NxZWJteXN4dmt6cWZoYWJwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTA5OTcyODQsImV4cCI6MjAyNjU3MzI4NH0.zYm_XohdhU59b9B69xTsf6hsv10yW42e6E7wX7yI2uw",bh="https://qdksqebmysxvkzqfhabp.supabase.co",vh=mh(bh,_h),wh=new Nn(yh,{client:vh,tableName:"documents",queryName:"match_documents"}),Eh=wh.asRetriever();function xh(n){return n.map(e=>e.pageContent).join(`

`)}function Ah(n){return n.map((e,t)=>t%2===0?`Human: ${e}`:`AI: ${e}`).join(`
`)}document.addEventListener("submit",n=>{n.preventDefault(),$h()});const kh="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",Li=new Ln({openAIApiKey:kh}),Sh=`Given some conversation history (if any) and a question, convert the question to a standalone question. 
conversation history: {conv_history}
question: {question} 
standalone question:`,Ph=xe.fromTemplate(Sh),Th=`You are a helpful and enthusiastic support bot who can answer a given question about Scrimba based on the context provided and the conversation history. Try to find the answer in the context. If the answer is not given in the context, find the answer in the conversation history if possible. If you really don't know the answer, say "I'm sorry, I don't know the answer to that." And direct the questioner to email help@scrimba.com. Don't try to make up an answer. Always speak as if you were chatting to a friend.
context: {context}
conversation history: {conv_history}
question: {question}
answer: `,Oh=xe.fromTemplate(Th),Ih=Ph.pipe(Li).pipe(new Ai),Rh=Ee.from([n=>n.standalone_question,Eh,xh]),Ch=Oh.pipe(Li).pipe(new Ai),jh=Ee.from([{standalone_question:Ih,original_input:new hu},{context:Rh,question:({original_input:n})=>n.question,conv_history:({original_input:n})=>n.conv_history},Ch]),Vr=[];async function $h(){const n=document.getElementById("user-input"),e=document.getElementById("chatbot-conversation-container"),t=n.value;n.value="";const r=document.createElement("div");r.classList.add("speech","speech-human"),e.appendChild(r),r.textContent=t,e.scrollTop=e.scrollHeight;const s=await jh.invoke({question:t,conv_history:Ah(Vr)});Vr.push(t),Vr.push(s);const i=document.createElement("div");i.classList.add("speech","speech-ai"),e.appendChild(i),i.textContent=s,e.scrollTop=e.scrollHeight}export{fu as B,xe as P,yu as c,kn as g,Ei as r};
